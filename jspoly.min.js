/*
JSPoly 
This is a Javascript translation of the Boost Polygon Library written in C++. 

Author  : Ruwan J Egodagamage (japzi)
Version : 0.0.4l
Date    : 6/22/2017
License : Boost Software License - Version 1.0 - August 17th, 2003

Contributors : rodovich, ahinz, gensym, nevernormal1

*/

/*
THE BOOST.POLYGON LIBRARY 
Version : 1_64_0

Boost Software License - Version 1.0 - August 17th, 2003

Permission is hereby granted, free of charge, to any person or organization
obtaining a copy of the software and accompanying documentation covered by
this license (the "Software") to use, reproduce, display, distribute,
execute, and transmit the Software, and to prepare derivative works of the
Software, and to permit third-parties to whom the Software is furnished to
do so, all subject to the following:

The copyright notices in the Software and this entire statement, including
the above license grant, this restriction and the following disclaimer,
must be included in all copies of the Software, in whole or in part, and
all derivative works of the Software, unless such copies or derivative
works are solely in the form of machine-executable object code generated by
a source language processor.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT
SHALL THE COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE
FOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN CONTRACT, TORT OR OTHERWISE,
ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
DEALINGS IN THE SOFTWARE.

*/

(function(){var t,e,n,i,r,o,s,_,l,u,p,h,a,c,f,y,v,d,x,g,w,m,E,b,T,q,M,O,R,S,I,N,A,P,L,j,k,G,C,z,D,U,F,J,Y,H,B,V,W,K,Z,X,Q,$,tt,et,nt,it,rt,ot,st,_t,lt,ut,pt,ht,at,ct,ft,yt,vt,dt,xt,gt,wt,mt,Et,bt,Tt,qt,Mt,Ot,Rt,St,It,Nt,At,Pt,Lt,jt,kt,Gt,Ct,zt,Dt,Ut,Ft,Jt,Yt,Ht,Bt,Vt,Wt,Kt,Zt,Xt,Qt,$t,te=function(t,e){function n(){this.constructor=t}for(var i in e)ee.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},ee={}.hasOwnProperty;l=1e-5,p=0,h=1,S=0,R=1,O=2,q=8,M=9,T=3,b=31,C=function(t,e){return t>>T===e},v=0,a=1,y=0,E=1,r=0,o=1,m=0,u=1,d=0,g=1,c=0,A=1,P=0,_=1,I=2,x=3,w=2,s=4,N=5,Y=0,B=1,Ht=2,f=32,e=5,t=31,n=1,i=2,"undefined"!=typeof module&&null!==module&&(module.exports={EPSILON:l,GEOMETRY_CATEGORY_POINT:p,GEOMETRY_CATEGORY_SEGMENT:h,SOURCE_CATEGORY_SINGLE_POINT:S,SOURCE_CATEGORY_SEGMENT_START_POINT:R,SOURCE_CATEGORY_SEGMENT_END_POINT:O,SOURCE_CATEGORY_INITIAL_SEGMENT:q,SOURCE_CATEGORY_REVERSE_SEGMENT:M,SOURCE_CATEGORY_GEOMETRY_SHIFT:T,SOURCE_CATEGORY_BITMASK:b,belongs:C,LOW:v,HIGH:a,LEFT:y,RIGHT:E,CLOCKWISE:r,COUNTERCLOCKWISE:o,REVERSE:m,FORWARD:u,NEGATIVE:d,POSITIVE:g,HORIZONTAL:c,VERTICAL:A,WEST:P,EAST:_,SOUTH:I,NORTH:x,PROXIMAL:w,DOWN:s,UP:N,clockwise_winding:Y,counterclockwise_winding:B,unknown_winding:Ht,IS_INVERSE:f,BITS_SHIFT:e,BITS_MASK:t,BIT_IS_LINEAR:n,BIT_IS_PRIMARY:i}),"undefined"!=typeof require&&null!==require&&(qt=require("./constants"),v=qt.LOW,c=qt.HORIZONTAL,P=qt.WEST),W=function(){function t(e){void 0!==e?"object"==typeof e?e instanceof t?this.val_=e.val_:e instanceof K?this.val_=1&e.to_int():e instanceof Z&&(this.val_=1&e.to_int()):"number"==typeof e&&(this.val_=e):this.val_=v}return t.prototype.val_=v,t.prototype.assign=function(t){this.val_=t.val_},t.prototype.equals=function(t){return Math.abs(this.val_-t.val_)<l},t.prototype.to_int=function(){return this.val_},t.prototype.backward=function(){return Math.abs(this.val_-v)<l?this.val_=a:this.val_=v,this},t.prototype.get_sign=function(){return 2*this.val_-1},t}(),vt=function(){function t(e){void 0!==e?"object"==typeof e?e instanceof t?this.val_=e.val_:e instanceof K&&(this.val_=e.to_int()>>1):"number"==typeof e&&(this.val_=e):this.val_=c}return t.prototype.val_=c,t.prototype.assign=function(t){this.val_=t.val_},t.prototype.equals=function(t){return Math.abs(this.val_-t.val_)<l},t.prototype.to_int=function(){return this.val_},t.prototype.turn_90=function(){Math.abs(this.val_-c)<l?this.val_=A:this.val_=c},t.prototype.get_perpendicular=function(){var e;return e=new t(this),e.turn_90(),e},t.prototype.get_direction=function(t){return new K((val_<<1)+t.to_int())},t}(),K=function(){function t(e){void 0!==e?"object"==typeof e?e instanceof t?this.val_=e.val_:e instanceof t&&(this.val_=1&e.to_int()):"number"==typeof e&&(this.val_=e):this.val_=P}return t.prototype.val_=P,t.prototype.assign=function(t){return this.val_=t.val_},t.prototype.equals=function(t){return Math.abs(this.val_-t.val_)<l},t.prototype.lessThan=function(t){return this.val_<t.val_},t.prototype.lessThanEqual=function(t){return this.val_<=t.val_},t.prototype.greaterThan=function(t){return this.val_>t.val_},t.prototype.greaterThanEqual=function(t){return this.val_>=t.val_},t.prototype.to_int=function(){return this.val_},t.prototype.backward=function(){var e;return e=new t,e.val_=1^this.val_,e},t.prototype.turn=function(e){var n;return n=new t,n.val_=3^this.val_^this.val_>>1^e.to_int(),n},t.prototype.left=function(){return this.turn(a)},t.prototype.right=function(){return this.turn(v)},t.prototype.is_positive=function(){return 1&this.val_},t.prototype.is_negative=function(){return!this.is_positive()},t.prototype.get_sign=function(){return(this.is_positive()<<1)-1},t}(),dt=function(){function t(e){void 0!==e?"object"==typeof e?e instanceof t?this.val_=e.val_:e instanceof vt?this.val_=e.to_int():e instanceof K?this.val_=e.to_int()>>1:e instanceof Z&&(this.val_=e.to_int()>>1):"number"==typeof e&&(this.val_=e):this.val_=c}return t.prototype.val_=c,t.prototype.assign=function(t){this.val_=t.val_},t.prototype.equals=function(t){return Math.abs(this.val_-t.val_)<l},t.prototype.to_int=function(){return this.val_},t.prototype.get_direction=function(){throw new Error("orientation.get_direction, not implemented")},t}(),Z=function(){function t(e){void 0!==e?"object"==typeof e?e instanceof t?this.val_=e.val_:e instanceof K&&(this.val_=e.to_int()):"number"==typeof e&&(this.val_=e):this.val_=P}return t.prototype.val_=P,t.prototype.assign=function(t){this.val_=t.val_},t.prototype.equals=function(t){return Math.abs(this.val_-t.val_)<l},t.prototype.lessThan=function(t){return this.val_<t.val_},t.prototype.lessThanEqual=function(t){return this.val_<=t.val_},t.prototype.greaterThan=function(t){return this.val_>t.val_},t.prototype.greaterThanEqual=function(t){return this.val_>=t.val_},t.prototype.to_int=function(){return this.val_},t.prototype.backward=function(){return new t(1^this.val_)},t.prototype.is_positive=function(){return 1&this.val_},t.prototype.is_negative=function(){return!this.is_positive()},t.prototype.get_sign=function(){return(this.is_positive()<<1)-1},t}(),ht=function(){function t(t,e){null==e&&(e=null),this._owningList=t,this._value=e}return t.prototype.attr=[],t.prototype._owningList=null,t.prototype._prev=null,t.prototype._next=null,t.prototype._value=null,t.prototype.next=function(t){return void 0!==t?(this._next=t,this):this._next},t.prototype.prev=function(t){return void 0!==t?(this._prev=t,this):this._prev},t.prototype.owningList=function(t){return void 0!==t?(this._owningList=t,this):this._owningList},t.prototype.isFirst=function(){return null==this._prev},t.prototype.value=function(t){return void 0!==t?(this._value=t,this):this._value},t.prototype.clearConnections=function(){return this._prev=null,this._next=null,!0},t}(),pt=function(){function t(t,e,n){var i,r,o,s,_,l;if(null==t)return this._last=new ht(this),this;if(t instanceof Array){for(this._last=new ht(this),l=null!=e?e:0,i=null!=n?n:t.length,r=o=s=l,_=i;_>=s?_>o:o>_;r=_>=s?++o:--o)this.push(t[r]);return this}throw new Error("TODO: Implement create for these parameters")}return t.prototype._first=null,t.prototype._last=null,t.prototype._length=0,t.prototype.swap=function(t,e){var n,i,r,o;if(!this.contains(t)||!this.contains(e))throw new Error("items should belong to this list");if(t===this.end()||e===this.end())throw new Error("swapping reserved @end item is not allowed");i=t.prev(),n=t.next(),o=e.prev(),r=e.next(),t===o&&e===n?(t.prev(e),t.next(r),e.next(t),e.prev(i),null!=i&&i.next(e),null!=r&&r.prev(t)):t===r&&e===i?(t.next(e),t.prev(o),e.prev(t),e.next(n),null!=o&&o.next(t),null!=n&&n.prev(e)):(t.prev(o),e.next(n),t.next(r),e.prev(i),null!=i&&i.next(e),null!=n&&n.prev(e),null!=r&&r.prev(t),null!=o&&o.next(t)),null===t.prev()&&(this._first=t),null===e.prev()&&(this._first=e)},t.prototype.sort=function(t){var e,n,i;if(e=this.begin(),null!=e&&null!=e.next())for(;e!==this.end().prev();){for(n=e.next();n!==this.end();)t(e.value(),n.value())?n=n.next():(i=n.next(),this.swap(e,n),e=n,n=i);e=e.next()}},t.prototype.jsSort=function(t){var e,n,i,r,o,s,_;for(o=function(e,n){return t(e.value(),n.value())?-1:1},e=[],r=this.begin();null!=r;)null!=r.value()&&e.push(r),r=r.next();if(e.sort(o),this._first=e[0],this._last=e[e.length-1],null!=this._first&&this._first.prev(null),null!=this._last&&this._last.next(null),e.length>0){for(_=[],n=i=0,s=e.length-1;s>=0?s>=i:i>=s;n=s>=0?++i:--i)e[n].next(e[n+1]),null!=e[n+1]?_.push(e[n+1].prev(e[n])):_.push(void 0);return _}},t.prototype.print=function(){var t,e;for(t=this.begin(),e="as is: [";t!==this.end();)e+=t.value(),t=t.next(),e+=t!==this.end()?", ":"";for(e+="] reverse: [",t=this.end().prev();null!=t;)e+=t.value(),t=t.prev(),e+=null!=t?", ":"";e+="]",console.log(e)},t.prototype.to_json=function(){return{TODO:"list"}},t.prototype.unique=function(e){var n,i,r,o;if(0===this._length)return null;for(r=new t,o=new t,r.push(this.end().prev().value()),i=this.end().prev().value(),n=this.end().prev().prev();null!==n;)e(i,n.value())||(r.push(n.value()),i=n.value()),n=n.prev();for(n=r.end().prev();null!==n;)o.push(n.value()),n=n.prev();return o},t.prototype.clear=function(){return this._first=null,this._length=0},t.prototype.contains=function(t){return null!=t&&t.owningList()===this},t.prototype.erase=function(t){var e,n;if(null!=t&&!this.contains(t))throw new Error("item is null or not part of this list");return n=t.prev(),e=t.next(),null!=e&&e.prev(n),null!=n&&n.next(e),null==n&&(this._first=e),t.clearConnections(),t.owningList(null),this._length--,null},t.prototype.insert=function(t,e){var n,i;if(null!=t&&!this.contains(t))throw new Error("item1 is null or not part of this list");return e instanceof ht?(i=this.end().prev(),n=this.end(),null!=t&&(i=t.prev(),n=t),null!=e&&(e.next(n),e.prev(i),null!=n&&n.prev(e),null!=i&&i.next(e),null==i&&(this._first=e),this._length++),e):this.insert(t,new ht(this,e))},t.prototype.push=function(t){return this.insert(null,t)},t.prototype.begin=function(){return this._first},t.prototype.beginValue=function(){if(null!=this._first)return this._first.value();throw new Error("List is empty")},t.prototype.end=function(){return this._last},t.prototype.size=function(){return this._length},t.prototype.empty=function(){return this._length<=0},t.prototype.concat=function(t){throw new Error("List concat is not implemented")},t.prototype.at=function(t){var e,n;for(n=this.begin(),e=0;n!==this.end&&e<this._length;){if(e===t)return n;e++,n=n.next()}throw new Error("Index out of bound")},t}(),L=function(){function t(t){var e;if(null==(null!=t?t.strategy:void 0))throw"Must pass options.strategy, a strategy";if(null==(null!=t?t.comparator:void 0))throw"Must pass options.comparator, a comparator";this.priv=new t.strategy(t),this.length=(null!=t&&null!=(e=t.initialValues)?e.length:void 0)||0}return t.prototype.queue=function(t){return this.length++,void this.priv.queue(t)},t.prototype.dequeue=function(t){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},t.prototype.peek=function(t){if(!this.length)throw"Empty queue";return this.priv.peek()},t.prototype.clear=function(){return this.length=0,this.priv.clear()},t.prototype.empty=function(){return 0===this.length},t.prototype.print=function(){return this.priv.print()},t.prototype.to_json=function(){return this.priv.to_json()},t}(),z=function(t,e,n){var i,r,o;for(r=0,i=t.length;i>r;)o=r+i>>>1,n(t[o],e)?r=o+1:i=o;return r},j=function(){function t(t){var e;this.options=t,this.comparator=this.options.comparator,this.data=(null!=(e=this.options.initialValues)?e.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return t.prototype.queue=function(t){var e;return e=z(this.data,t,this.comparator),void this.data.splice(e,0,t)},t.prototype.dequeue=function(){return this.data.pop()},t.prototype.peek=function(){return this.data[this.data.length-1]},t.prototype.clear=function(){return void(this.data.length=0)},t.prototype.print=function(){var t,e;for(t=this.data.length-1,e="";t>=0;)null!=this.data[t].value&&null!=this.data[t].value().first&&null!=this.data[t].value().first.print&&(e+=this.data[t].value().first.print()+"\n"),t--;return e},t.prototype.to_json=function(){var t,e;for(e=[],t=this.data.length-1;t>=0;)null!=this.data[t].value&&null!=this.data[t].value().first&&null!=this.data[t].value().first.to_json&&e.push(this.data[t].value().first.to_json()),t--;return e},t}(),bt=function(t){function e(t){t||(t={}),t.strategy||(t.strategy=j),t.comparator||(t.comparator=function(t,e){return(t||0)-(e||0)}),e.__super__.constructor.call(this,t)}return te(e,t),e}(L),yt=function(){function t(t){if(this.c_list_=new pt,this.c_=new bt({comparator:function(e,n){return t(e.value(),n.value())}}),null==t)throw"comparator is not provided for ordered queue"}return t.prototype.c_list_=null,t.prototype.c_=null,t.prototype.empty=function(){return this.c_.empty()},t.prototype.top=function(){return this.c_.peek().value()},t.prototype.pop=function(){var t;return t=this.c_.peek(),this.c_.dequeue(),this.c_list_.erase(t)},t.prototype.push=function(t){return this.c_list_.push(t),this.c_.queue(this.c_list_.end().prev()),this.c_list_.end().prev().value()},t.prototype.clear=function(){return this.c_.clear(),this.c_list_.clear()},t.prototype.size=function(){return this.c_list_.size()},t.prototype.print=function(){return this.c_.print()},t.prototype.to_json=function(){return this.c_.to_json()},t}(),ft=function(){function t(t,e,n){null==e&&(e=null),null==n&&(n=null),this._owningMap=t,this._key=e,this._value=n}return t.prototype.attr=[],t.prototype._owningMap=null,t.prototype._prev=null,t.prototype._next=null,t.prototype._key=null,t.prototype._value=null,t.prototype.next=function(t){return void 0!==t?(this._next=t,this):this._next},t.prototype.prev=function(t){return void 0!==t?(this._prev=t,this):this._prev},t.prototype.owningMap=function(t){return void 0!==t?(this._owningMap=t,this):this._owningMap},t.prototype.isFirst=function(){return null==this._prev},t.prototype.key=function(t){return void 0!==t?(this._key=t,this):this._key},t.prototype.value=function(t){return void 0!==t?(this._value=t,this):this._value},t.prototype.clearConnections=function(){return this._prev=null,this._next=null,!0},t}(),ct=function(){function t(t){if(this._comparator=t,null==t)throw new Error("comparator should be defined for the map");this._last=new ft(this)}return t.prototype._first=null,t.prototype._last=null,t.prototype._length=0,t.prototype.insertBefore=function(t,e){var n,i;return i=this._last.prev(),n=this._last,null!=t&&(i=t.prev(),n=t),e.next(n),e.prev(i),null!=n&&n.prev(e),null!=i&&i.next(e),null==i&&(this._first=e),this._length++,e},t.prototype.insert=function(t,e){var n,i,r,o;if(t instanceof ft){for(i=t,n=this.begin();n!==this.end()&&null!==n;){if(i.key()===n.key())return n.value(i.value()),n;if(this._comparator(i.key(),n.key()))return this.insertBefore(n,i);n=n.next()}return this.insertBefore(null,i)}return r=t,o=e,this.insert(new ft(this,r,o))},t.prototype.lowerBound=function(t){var e;for(e=this.begin();e!==this.end();){if(!this._comparator(e.key(),t))return e;e=e.next()}return this.end()},t.prototype.swap=function(t,e){var n,i,r,o;if(!this.contains(t)||!this.contains(e))throw new Error("items should belong to this list");if(t===this.end()||e===this.end())throw new Error("swapping reserved @end item is not allowed");i=t.prev(),n=t.next(),o=e.prev(),r=e.next(),t===o&&e===n?(t.prev(e),t.next(r),e.next(t),e.prev(i),null!=i&&i.next(e),null!=r&&r.prev(t)):t===r&&e===i?(t.next(e),t.prev(o),e.prev(t),e.next(n),null!=o&&o.next(t),null!=n&&n.prev(e)):(t.prev(o),e.next(n),t.next(r),e.prev(i),null!=i&&i.next(e),null!=n&&n.prev(e),null!=r&&r.prev(t),null!=o&&o.next(t)),null===t.prev()&&(this._first=t),null===e.prev()&&(this._first=e)},t.prototype.print=function(){var t,e;for(t=this.begin(),e="as is: [";t!==this.end();)e+=JSON.stringify(t.key()),t=t.next(),e+=t!==this.end()?", ":"";for(e+="] reverse: [",t=this.end().prev();null!=t;)e+=JSON.stringify(t.key()),t=t.prev(),e+=null!=t?", ":"";e+="]",console.log(e)},t.prototype.clear=function(){return this._first=null,this._last.prev(null),this._length=0},t.prototype.contains=function(t){return null!=t&&t.owningMap()===this},t.prototype.erase=function(t){var e,n;if(null!=t&&!this.contains(t))throw new Error("item is null or not part of this list");return n=t.prev(),e=t.next(),null!=e&&e.prev(n),null!=n&&n.next(e),null==n&&(this._first=e),t.clearConnections(),t.owningMap(null),this._length--,null},t.prototype.begin=function(){return this._first},t.prototype.end=function(){return this._last},t.prototype.size=function(){return this._length},t.prototype.empty=function(){return this._length<=0},t.prototype.at=function(t){var e,n;for(n=this.begin(),e=0;n!==this.end()&&e<this._length;){if(e===t)return n;e++,n=n.next()}throw new Error("Index out of bound")},t}(),"undefined"!=typeof module&&null!==module&&(module.exports={list:pt,ordered_queue:yt,ordered_map:ct,list_item:ht}),ot=function(t){return t>0},rt=function(t){return 0>t},_t=function(t){return 0===t},"undefined"!=typeof module&&null!==module&&(module.exports={is_neg:rt,is_pos:ot,is_zero:_t}),"undefined"!=typeof require&&null!==require&&(l=require("./constants").EPSILON,Mt=require("./voronoi_structures"),Gt=Mt.site_event,D=Mt.circle_event,gt=Mt.point_2d,Ot=require("./voronoi_ctypes"),_t=Ot.is_zero,rt=Ot.is_neg,ot=Ot.is_pos),Yt=function(t){return t>0?Math.floor(t):Math.ceil(t)},Jt=function(t){return Yt(t)},nt=Math.sqrt,st=function(t,e){return null!=e?Math.abs(t.x()-e.x())<l:st(t.point0(),t.point1())},jt=function(t,e,n,i){return t*i-e*n},xt={},xt.RIGHT=-1,xt.COLLINEAR=0,xt.LEFT=1,xt.eval=function(t,e,n,i){var r,o,s,_;return null!=i?xt.eval(jt(t,e,n,i)):null!=n?(r=Yt(t.x())-Yt(e.x()),o=Yt(e.x())-Yt(n.x()),s=Yt(t.y())-Yt(e.y()),_=Yt(e.y())-Yt(n.y()),xt.eval(jt(r,s,o,_))):_t(t)?xt.COLLINEAR:rt(t)?xt.RIGHT:xt.LEFT},wt=function(t,e){return Math.abs(t.x()-e.x())<l?t.y()<e.y():t.x()<e.x()},Q=function(t,e){if("site_event"===t.eventType()&&"site_event"===e.eventType())return Math.abs(t.x0()-e.x0())>l?t.x0()<e.x0():t.is_segment()?st(e)?st(t)?t.y0()<e.y0()&&Math.abs(t.y0()-e.y0())>l:!1:st(t)?!0:Math.abs(t.y0()-e.y0())>l?t.y0()<e.y0():xt.eval(t.point1(),t.point0(),e.point1())===xt.LEFT:e.is_segment()?st(e)?t.y0()<e.y0()||Math.abs(t.y0()-e.y0())<l:!0:t.y0()<e.y0()&&Math.abs(t.y0()-e.y0())>l;if("site_event"===t.eventType()&&"circle_event"===e.eventType())return t.x0()<e.lower_x()&&Math.abs(t.x0()-e.lower_x())>l;if("circle_event"===t.eventType()&&"site_event"===e.eventType())return t.lower_x()<e.x0()&&Math.abs(t.lower_x()-e.x0())>l;if("circle_event"===t.eventType()&&"circle_event"===e.eventType())return Math.abs(t.lower_x()-e.lower_x())>l?t.lower_x()<e.lower_x()&&Math.abs(t.lower_x()-e.lower_x())>l:t.y()<e.y()&&Math.abs(t.y()-e.y())>l;throw new Error("event_comparison_predicate should never reach here!")},lt={LESS:-1,UNDEFINED:0,MORE:1},X=function(t,e,n){return t.is_segment()?e.is_segment()?Ft(t,e,n):Tt(e,t,n,!0):e.is_segment()?Tt(t,e,n,!1):Et(t,e,n)},Et=function(t,e,n){var i,r,o,s;if(o=t.point0(),s=e.point0(),o.x()>s.x()){if(n.y()<=o.y())return!1}else{if(!(o.x()<s.x()))return o.y()+s.y()<2*n.y();if(n.y()>=s.y())return!0}return i=tt(t,n),r=tt(e,n),r>i},Tt=function(t,e,n,i){var r,o,s,_;return s=$(t,e,n,i),s!==lt.UNDEFINED?s===lt.LESS:(r=tt(t,n),o=et(e,n),_=i^o>r,1===_)},Ft=function(t,e,n){var i,r;return t.sorted_index()===e.sorted_index()?xt.eval(t.point0(),t.point1(),n)===xt.LEFT:(i=et(t,n),r=et(e,n),r>i)},tt=function(t,e){var n,i;return n=t.x()-e.x(),i=t.y()-e.y(),(n*n+i*i)/(2*n)},et=function(t,e){var n,i,r,o,s;return st(t)?(t.x()-e.x())/2:(o=t.point0(),s=t.point1(),n=s.x()-o.x(),i=s.y()-o.y(),r=Math.sqrt(n*n+i*i),r=rt(i)?(r-i)/(n*n):1/(i+r),r*jt(Yt(s.x())-Yt(o.x()),Yt(s.y())-Yt(o.y()),Yt(e.x())-Yt(o.x()),Yt(e.y())-Yt(o.y())))},$=function(t,e,n,i){var r,o,s,_,u,p,h,a,c,f;return f=t.point0(),c=e.point0(),a=e.point1(),xt.eval(c,a,n)!==xt.RIGHT?e.is_inverse()?lt.MORE:lt.LESS:(s=n.x()-f.x(),_=n.y()-f.y(),r=a.x()-c.x(),o=a.y()-c.y(),st(e)?n.y()<f.y()&&!i?lt.MORE:n.y()>f.y()&&i?lt.LESS:lt.UNDEFINED:(h=xt.eval(Yt(a.x())-Yt(c.x()),Yt(a.y())-Yt(c.y()),Yt(n.x())-Yt(f.x()),Yt(n.y())-Yt(f.y())),h===xt.LEFT?e.is_inverse()?i?lt.UNDEFINED:lt.MORE:i?lt.LESS:lt.UNDEFINED:(u=r*(_+s)*(_-s),p=2*o*s*_,Math.abs(u-p)>l&&u>p^i?i?lt.LESS:lt.MORE:lt.UNDEFINED)))},at=function(t,e){var n,i,r,o,s,_,u,p,h;return i=function(t){return t.left_site().sorted_index()>t.right_site().sorted_index()?t.left_site():t.right_site()},n=function(t){return wt(t.point0(),t.point1())?t.point0():t.point1()},r=function(t,e){return null==e&&(e=!0),t.left_site().sorted_index()===t.right_site().sorted_index()?{first:t.left_site().y0(),second:0}:t.left_site().sorted_index()>t.right_site().sorted_index()?!e&&t.left_site().is_segment()&&st(t.left_site())?{first:t.left_site().y0(),second:1}:{first:t.left_site().y1(),second:1}:{first:t.right_site().y0(),second:-1}},_=i(t),u=i(e),o=n(_),s=n(u),Math.abs(o.x()-s.x())<l?_.sorted_index()===u.sorted_index()?(p=r(t),h=r(e),p.first<h.first||p.first===h.first&&p.second<h.second):_.sorted_index()<u.sorted_index()?(p=r(t,!1),h=r(e,!0),p.first!==h.first?p.first<h.first:_.is_segment()?!1:p.second<0):(p=r(t,!0),h=r(e,!1),p.first!==h.first?p.first<h.first:u.is_segment()?!0:h.second>0):o.x()<s.x()?X(t.left_site(),t.right_site(),s):o.x()>s.x()?!X(e.left_site(),e.right_site(),o):void 0},U={ppp:function(t,e,n){return xt.eval(t.point0(),e.point0(),n.point0())===xt.RIGHT},pps:function(t,e,n,i){var r,o;if(2===i)return!n.point0().equals(t.point0())||!n.point1().equals(e.point0());if(r=xt.eval(t.point0(),e.point0(),n.point0()),o=xt.eval(t.point0(),e.point0(),n.point1()),1===i&&t.x0()>=e.x0()){if(r!==xt.RIGHT)return!1}else if(3===i&&e.x0()>=t.x0()){if(o!==xt.RIGHT)return!1}else if(r!==xt.RIGHT&&o!==xt.RIGHT)return!1;return!0},pss:function(t,e,n,i){if(e.sorted_index()===n.sorted_index())return!1;if(2===i){if(!e.is_inverse()&&n.is_inverse())return!1;if(e.is_inverse()===n.is_inverse()&&xt.eval(e.point0(),t.point0(),n.point1())!==xt.RIGHT)return!1}return!0},sss:function(t,e,n){return t.sorted_index()!==e.sorted_index()&&e.sorted_index()!==n.sorted_index()}},Ct={eval1:function(t,e){return t instanceof Array?t[0]*Math.sqrt(e[0]):t*Math.sqrt(e)},eval2:function(t,e,n,i){return t instanceof Array?Ct.eval2(t[0],e[0],t[1],e[1]):Ct.eval1(t,e)+Ct.eval1(n,i)},eval3:function(t,e,n,i,r,o){return t instanceof Array?Ct.eval3(t[0],e[0],t[1],e[1],t[2],e[2]):Ct.eval2(t,e,n,i)+Ct.eval1(r,o)},eval4:function(t,e,n,i,r,o,s,_){return t instanceof Array?Ct.eval4(t[0],e[0],t[1],e[1],t[2],e[2],t[3],e[3]):Ct.eval2(t,e,n,i)+Ct.eval2(r,o,s,_)}},Dt=function(t,e){throw new Error("sqrt_expr_evaluator_pss4 should never be called")},Ut=function(t,e){return t[3]+t[0]*Math.sqrt(e[0])+t[1]*Math.sqrt(e[1])+t[2]*Math.sqrt(e[3]*(Math.sqrt(e[0]*e[1])+e[2]))},zt=function(t,e){throw new Error("sqrt_expr_evaluator_pss3 should never be called")},F={ppp:function(t,e,n,i,r,o,s){var _,l,u,p,h,a,c,f,y,v,d,x,g;null==r&&(r=!0),null==o&&(o=!0),null==s&&(s=!0),u=[],p=[],x=[],g=[],u[0]=Yt(t.x())-Yt(e.x()),u[1]=Yt(e.x())-Yt(n.x()),u[2]=Yt(t.x())-Yt(n.x()),p[0]=Yt(t.y())-Yt(e.y()),p[1]=Yt(e.y())-Yt(n.y()),p[2]=Yt(t.y())-Yt(n.y()),x[0]=Yt(t.x())+Yt(e.x()),x[1]=Yt(e.x())+Yt(n.x()),g[0]=Yt(t.y())+Yt(e.y()),g[1]=Yt(e.y())+Yt(n.y()),h=.5/Jt(u[0]*p[1]-u[1]*p[0]),f=u[0]*x[0]+p[0]*g[0],y=u[1]*x[1]+p[1]*g[1],(r||s)&&(_=f*p[1]-y*p[0],i.x(_*h),s&&(d=(u[0]*u[0]+p[0]*p[0])*(u[1]*u[1]+p[1]*p[1])*(u[2]*u[2]+p[2]*p[2]),v=nt(d),rt(i.x())?(c=_*_-d,a=c*h/(_+v),i.lower_x(a)):rt(h)?i.lower_x(i.x()-v*h):i.lower_x(i.x()+v*h))),o&&(l=y*u[0]-f*u[1],i.y(l*h))},pps:function(t,e,n,i,r,o,s,_){var l,u,p,h,a,c,f,y,v,d,x,g,w,m,E,b,T,q,M,O;return null==o&&(o=!0),null==s&&(s=!0),null==_&&(_=!0),p=[],h=[],x=Yt(n.y1())-Yt(n.y0()),g=Yt(n.x0())-Yt(n.x1()),m=x*x+g*g,M=Yt(e.y())-Yt(t.y()),O=Yt(t.x())-Yt(e.x()),b=Yt(t.x())+Yt(e.x()),T=Yt(t.y())+Yt(e.y()),q=x*M+g*O,a=M*g-O*x,f=Yt(n.y1())-Yt(t.y()),y=Yt(t.x())-Yt(n.x1()),l=x*y-g*f,f=Yt(n.y1())-Yt(e.y()),y=Yt(e.x())-Yt(n.x1()),u=x*y-g*f,E=l+u,_t(a)?(w=q*q-E*E,a=q*E,p[0]=a*b*2+w*M,h[0]=m,p[1]=a*E*2+w*q,h[1]=1,p[2]=a*T*2+w*O,v=1/a,o&&r.x(.25*p[0]*v),s&&r.y(.25*p[2]*v),void(_&&r.lower_x(.25*Ct.eval2(p,h)*v/nt(m)))):(c=(q*q+a*a)*l*u*4,d=1/a,d*=d,(o||_)&&(p[0]=b*a*a+q*E*M,h[0]=1,p[1]=2===i?-M:M,h[1]=c,o&&r.x(.5*Ct.eval2(p,h)*d)),(s||_)&&(p[2]=T*a*a+q*E*O,h[2]=1,p[3]=2===i?-O:O,h[3]=c,s&&r.y(.5*Ct.eval2(p[2],h[2],p[3],h[3])*d)),_?(h[0]=h[0]*m,h[1]=h[1]*m,p[2]=E*(a*a+q*q),h[2]=1,p[3]=2===i?-q:q,h[3]=c,r.lower_x(.5*Ct.eval4(p,h)*d/nt(m))):void 0)},pss:function(t,e,n,i,r,o,s,_){var l,u,p,h,a,c,f,y,v,d,x,g,w,m,E,b,T,q,M,O,R,S;return null==o&&(o=!0),null==s&&(s=!0),null==_&&(_=!0),l=[],u=[],p=[],h=[],a=[],M=e.point1(),T=e.point0(),O=n.point0(),q=n.point1(),l[0]=Yt(T.x())-Yt(M.x()),u[0]=Yt(T.y())-Yt(M.y()),l[1]=Yt(q.x())-Yt(O.x()),u[1]=Yt(q.y())-Yt(O.y()),b=l[1]*u[0]-l[0]*u[1],_t(b)?(d=2*Jt(l[0]*l[0]+u[0]*u[0]),p[0]=u[0]*(Yt(O.x())-Yt(M.x()))-l[0]*(Yt(O.y())-Yt(M.y())),x=l[0]*(Yt(t.y())-Yt(M.y()))-u[0]*(Yt(t.x())-Yt(M.x())),g=u[0]*(Yt(t.x())-Yt(O.x()))-l[0]*(Yt(t.y())-Yt(O.y())),a[0]=x*g,a[1]=1,s&&(h[0]=u[0]*(2===i?2:-2),h[1]=l[0]*l[0]*(Yt(M.y())+Yt(O.y()))-l[0]*u[0]*(Yt(M.x())+Yt(O.x())-2*Yt(t.x()))+u[0]*u[0]*(2*Yt(t.y())),f=Ct.eval2(h,a),r.y(f/d)),void((o||_)&&(h[0]=l[0]*(2===i?2:-2),h[1]=u[0]*u[0]*(Yt(M.x())+Yt(O.x()))-l[0]*u[0]*(Yt(M.y())+Yt(O.y())-2*Yt(t.y()))+l[0]*l[0]*(2*Yt(t.x())),o&&(c=Ct.eval2(h,a),r.x(c/d)),_&&(h[2]=rt(p[0])?-p[0]:p[0],a[2]=l[0]*l[0]+u[0]*u[0],E=Ct.eval3(h,a),r.lower_x(E/d))))):(p[0]=u[0]*T.x()-l[0]*T.y(),p[1]=l[1]*q.y()-u[1]*q.x(),w=l[0]*p[1]+l[1]*p[0],m=u[0]*p[1]+u[1]*p[0],x=w-b*t.x(),g=m-b*t.y(),_t(x)&&_t(g)?(d=b,c=w/d,f=m/d,r.x(c),r.y(f),void r.lower_x(c)):(R=(2===i?1:-1)*(rt(b)?1:-1),h[0]=l[1]*-x+u[1]*-g,h[1]=l[0]*-x+u[0]*-g,h[2]=R,h[3]=0,a[0]=l[0]*l[0]+u[0]*u[0],a[1]=l[1]*l[1]+u[1]*u[1],a[2]=l[0]*l[1]+u[0]*u[1],a[3]=(l[0]*g-u[0]*x)*(l[1]*g-u[1]*x)*-2,S=Ut(h,a),d=S*b,s&&(h[0]=u[1]*(x*x+g*g)-m*(x*l[1]+g*u[1]),h[1]=u[0]*(x*x+g*g)-m*(x*l[0]+g*u[0]),h[2]=m*R,v=Ut(h,a),r.y(v/d)),(o||_)&&(h[0]=l[1]*(x*x+g*g)-w*(x*l[1]+g*u[1]),h[1]=l[0]*(x*x+g*g)-w*(x*l[0]+g*u[0]),h[2]=w*R,o&&(y=Ut(h,a),r.x(y/d)),_)?(h[3]=b*(x*x+g*g)*(rt(S)?-1:1),E=Ut(h,a),r.lower_x(E/d)):void 0))},sss:function(t,e,n,i,r,o,s){var _,l,u,p,h,a,c,f,y,v,d,x,g,w,m,E;for(null==r&&(r=!0),null==o&&(o=!0),null==s&&(s=!0),_=[],l=[],u=[],p=[],h=[],_[0]=Yt(t.x1())-Yt(t.x0()),_[1]=Yt(e.x1())-Yt(e.x0()),_[2]=Yt(n.x1())-Yt(n.x0()),l[0]=Yt(t.y1())-Yt(t.y0()),l[1]=Yt(e.y1())-Yt(e.y0()),l[2]=Yt(n.y1())-Yt(n.y0()),u[0]=Yt(t.x0())*Yt(t.y1())-Yt(t.y0())*Yt(t.x1()),u[1]=Yt(e.x0())*Yt(e.y1())-Yt(e.y0())*Yt(e.x1()),u[2]=Yt(n.x0())*Yt(n.y1())-Yt(n.y0())*Yt(n.x1()),y=x=0;3>x;y=++x)h[y]=_[y]*_[y]+l[y]*l[y];for(y=w=0;3>w;y=++w)v=(y+1)%3,d=(y+2)%3,p[y]=_[v]*l[d]-_[d]*l[v];if(f=Ct.eval3(p,h),o){for(y=m=0;3>m;y=++m)v=(y+1)%3,d=(y+2)%3,p[y]=l[v]*u[d]-l[d]*u[v];c=Ct.eval3(p,h),i.y(c/f)}if(r||s){for(p[3]=0,y=E=0;3>E;y=++E)v=(y+1)%3,d=(y+2)%3,p[y]=_[v]*u[d]-_[d]*u[v],s&&(p[3]=p[3]+p[y]*l[y]);if(r&&(a=Ct.eval3(p,h),i.x(a/f)),s)return h[3]=1,g=Ct.eval4(p,h),i.lower_x(g/f)}}},ut={ppp:function(t,e,n,i){throw new Error("lazy_circle_formation_functor should never get called, disabled")},pps:function(t,e,n,i,r){throw new Error("lazy_circle_formation_functor should never get called, disabled")},pss:function(t,e,n,i,r){throw new Error("lazy_circle_formation_functor should never get called, disabled")},sss:function(t,e,n,i){throw new Error("lazy_circle_formation_functor should never get called, disabled")}},J=function(t,e,n,i){var r;if(r=function(t,e){var n,i;return e.is_segment()&&st(e)?(n=e.is_inverse()?e.y1():e.y0(),i=e.is_inverse()?e.y0():e.y1(),n-t.y()>l||t.y()-i>l):!1},t.is_segment())if(e.is_segment())if(n.is_segment()){if(!U.sss(t,e,n))return!1;F.sss(t,e,n,i)}else{if(!U.pss(n,t,e,3))return!1;F.pss(n,t,e,3,i)}else if(n.is_segment()){if(!U.pss(e,t,n,2))return!1;F.pss(e,t,n,2,i)}else{if(!U.pps(e,n,t,1))return!1;F.pps(e,n,t,1,i)}else if(e.is_segment())if(n.is_segment()){if(!U.pss(t,e,n,1))return!1;F.pss(t,e,n,1,i)}else{if(!U.pps(t,n,e,2))return!1;F.pps(t,n,e,2,i)}else if(n.is_segment()){if(!U.pps(t,e,n,3))return!1;F.pps(t,e,n,3,i)}else{if(!U.ppp(t,e,n))return!1;F.ppp(t,e,n,i)}return r(i,t)||r(i,e)||r(i,n)?!1:!0},"undefined"!=typeof module&&null!==module&&(module.exports={node_comparison_predicate:at,distance_predicate:X,event_comparison_predicate:Q,point_comparison_predicate:wt,circle_formation_predicate:J,is_vertical:st}),"undefined"!=typeof require&&null!==require&&(Rt=require("./constants"),l=Rt.EPSILON,b=Rt.SOURCE_CATEGORY_BITMASK,f=Rt.IS_INVERSE),gt=function(){function t(e,n){null!=e?"object"==typeof e?e instanceof t&&(this.x_=e.x_,this.y_=e.y_):"number"==typeof e&&(this.x_=e,this.y_=n):(this.x_=0,this.y_=0)}return t.prototype.x_=0,t.prototype.y_=0,t.prototype.assign=function(t){this.x_=t.x_,this.y_=t.y_},t.prototype.equals=function(t){return Math.abs(this.x_-t.x_)<l&&Math.abs(this.y_-t.y_)<l},t.prototype.print=function(){return"("+this.x_+", "+this.y_+")"},t.prototype.x=function(){return this.x_},t.prototype.y=function(){return this.y_},t}(),Gt=function(){function t(e,n,i,r){if(null!=e)if("object"==typeof e){if(e instanceof gt)null!=n?(this.point0_=new gt(e),this.point1_=new gt(n)):(this.point0_=new gt(e),this.point1_=new gt(e));else if(e instanceof t)return this.point0_=new gt(e.point0()),this.point1_=new gt(e.point1()),this.sorted_index_=e.sorted_index_,this.flags_=e.flags_,void(this.initial_index_=e.initial_index_)}else"number"==typeof e&&(null!=i?(this.point0_=new gt(e,n),this.point1_=new gt(i,r)):(this.point0_=new gt(e,n),this.point1_=new gt(e,n)));else this.point0_=new gt(0,0),this.point1_=new gt(0,0);this.sorted_index_=0,this.flags_=0}return t.prototype.point0_=null,t.prototype.point1_=null,t.prototype.sorted_index_=0,t.prototype.initial_index_=0,t.prototype.flags_=0,t.prototype.eventType=function(){return"site_event"},t.prototype.equals=function(t){return this.point0_.equals(t.point0_)&&this.point1_.equals(t.point1_)},t.prototype.x=function(){return this.point0_.x()},t.prototype.y=function(){return this.point0_.y()},t.prototype.x0=function(){return this.point0_.x()},t.prototype.y0=function(){return this.point0_.y()},t.prototype.x1=function(){return this.point1_.x()},t.prototype.y1=function(){return this.point1_.y()},t.prototype.point0=function(){return this.point0_},t.prototype.point1=function(){return this.point1_},t.prototype.sorted_index=function(t){return void 0!==t?(this.sorted_index_=t,this):this.sorted_index_},t.prototype.initial_index=function(t){return void 0!==t?(this.initial_index_=t,this):this.initial_index_},t.prototype.is_inverse=function(){return(this.flags_&f)>0},t.prototype.inverse=function(){var t;return t=this.point1_,this.point1_=new gt(this.point0_),this.point0_=new gt(t),this.flags_^=f,this},t.prototype.source_category=function(t){return void 0!==t?(this.flags_|=t,this):this.flags_&b},t.prototype.is_point=function(){return this.point0_.equals(this.point1_)},t.prototype.is_segment=function(){return!this.is_point()},t.prototype.print=function(){return"site_event { p0: "+this.point0_.print()+", p1: "+this.point1_.print()+", params: s-"+this.sorted_index_+" i-"+this.initial_index_+" f-"+this.flags_+" }"},t.prototype.to_json=function(){return{p0:{x:this.point0_.x(),y:this.point0_.y()},p1:{x:this.point1_.x(),y:this.point1_.y()},params:"s-"+this.sorted_index_+" i-"+this.initial_index_+" f-"+this.flags_}},t}(),D=function(){function t(t,e,n){null!=t&&(this.center_x_=t,this.center_y_=e,this.lower_x_=n,this.is_active=!0)}return t.prototype.center_x_=0,t.prototype.center_y_=0,t.prototype.lower_x_=0,t.prototype.is_active_=!0,t.prototype.eventType=function(){return"circle_event"},t.prototype.x=function(t){return void 0!==t?(this.center_x_=t,this):this.center_x_},t.prototype.y=function(t){return void 0!==t?(this.center_y_=t,this):this.center_y_},t.prototype.lower_x=function(t){return void 0!==t?(this.lower_x_=t,this):this.lower_x_},t.prototype.lower_y=function(){return this.center_y_},t.prototype.is_active=function(){return this.is_active_},t.prototype.deactivate=function(){return this.is_active_=!1,this},t.prototype.print=function(){return"circle_event { c_x: "+this.center_x_+" c_y: "+this.center_y_+" lower_x: "+this.lower_x_+" is_active: "+this.is_active_+" }"},t.prototype.to_json=function(){return{c_x:this.center_x_,c_y:this.center_y_,lower_x_:this.lower_x_,is_active_:this.is_active_}},t}(),G=function(){function t(t,e){null!=e?(this.left_site_=new Gt(t),this.right_site_=new Gt(e)):(this.left_site_=new Gt(t),this.right_site_=new Gt(t))}return t.prototype.left_site_=null,t.prototype.right_site_=null,t.prototype.left_site=function(t){return void 0!==t?(this.left_site_=t,this):this.left_site_},t.prototype.right_site=function(t){return void 0!==t?(this.right_site_=t,this):this.right_site_},t.prototype.print=function(){return"beach_node_key { left_site: "+this.left_site_.print()+" right_site: "+this.right_site_.print()+" }"},t.prototype.to_json=function(){
return{left_site:this.left_site_.to_json(),right_site:this.right_site_.to_json()}},t}(),k=function(){function t(t){this.circle_event_=null,this.edge_=t}return t.prototype.circle_event_=null,t.prototype.edge_=null,t.prototype.circle_event=function(t){return void 0!==t?(this.circle_event_=t,this):this.circle_event_},t.prototype.edge=function(t){return void 0!==t?(this.edge_=t,this):this.edge_},t.prototype.print=function(){return"beach_line_node_data { circle_event: "+(null!==this.circle_event_?this.circle_event_.print():"NULL ")+" edge: TODO}"},t.prototype.to_json=function(){return{circle_event:null!==this.circle_event_?this.circle_event_.to_json():null,edge:"TODO"}},t}(),"undefined"!=typeof module&&null!==module&&(module.exports={beach_line_node_data:k,beach_line_node_key:G,circle_event:D,site_event:Gt,point_2d:gt}),"undefined"!=typeof require&&null!==require&&(St=require("./constants"),n=St.BIT_IS_LINEAR,i=St.BIT_IS_PRIMARY,l=St.EPSILON,e=St.BITS_SHIFT),Wt=function(){function n(t,e){this.source_index_=t,this.incident_edge_=null,this.color_=e}return n.prototype.source_index_=0,n.prototype.incident_edge_=null,n.prototype.color_=0,n.prototype.contains_point=function(){var t;return t=this.source_category(),C(t,p)},n.prototype.contains_segment=function(){var t;return t=this.source_category(),C(t,h)},n.prototype.source_index=function(){return this.source_index_},n.prototype.source_category=function(){return this.color_&b},n.prototype.is_generate=function(){return null===this.incident_edge_},n.prototype.incident_edge=function(t){return void 0!==t?void(this.incident_edge_=t):this.incident_edge_},n.prototype.color=function(n){return void 0!==n?(this.color_&=t,void(this.color_|=n<<e)):this.color_>>e},n}(),Qt=function(){function n(t,e){this.x_=t,this.y_=e,this.incident_edge_=null,this.color_=0}return n.prototype.x_=0,n.prototype.y_=0,n.prototype.x=function(){return this.x_},n.prototype.y=function(){return this.y_},n.prototype.is_degenerate=function(){return null===this.incident_edge_},n.prototype.incident_edge=function(t){return void 0!==t?void(this.incident_edge_=t):this.incident_edge_},n.prototype.color=function(n){return void 0!==n?(this.color_&=t,void(this.color_|=n<<e)):this.color_>>e},n}(),Xt=function(){function r(t,e){t&&(this.color_|=n),e&&(this.color_|=i)}return r.prototype.cell_=null,r.prototype.vertex_=null,r.prototype.twin_=null,r.prototype.next_=null,r.prototype.prev_=null,r.prototype.color_=0,r.prototype.cell=function(t){return void 0!==t?void(this.cell_=t):this.cell_},r.prototype.vertex0=function(t){return void 0!==t?void(this.vertex_=t):this.vertex_},r.prototype.vertex1=function(){return this.twin_.vertex0()},r.prototype.twin=function(t){return void 0!==t?void(this.twin_=t):this.twin_},r.prototype.next=function(t){return void 0!==t?void(this.next_=t):this.next_},r.prototype.prev=function(t){return void 0!==t?void(this.prev_=t):this.prev_},r.prototype.rot_next=function(){return this.prev_.twin()},r.prototype.rot_prev=function(){return this.twin_.next()},r.prototype.is_finite=function(){return null!=this.vertex0()&&null!=this.vertex1()},r.prototype.is_infinite=function(){return null==this.vertex0()||null==this.vertex1()},r.prototype.is_linear=function(){return(this.color_&n)>0},r.prototype.is_curved=function(){return 0===(this.color_&n)},r.prototype.is_primary=function(){return(this.color_&i)>0},r.prototype.is_secondary=function(){return 0===(this.color_&i)},r.prototype.color=function(n){return void 0!==n?(this.color_&=t,void(this.color_|=n<<e)):this.color_>>e},r.prototype.prev_primary=function(){var t;for(t=this.prev_;null!=t?t.is_secondary():void 0;)t=t.twin().prev();return t!==this.twin_?t:void 0},r.prototype.next_primary=function(){var t;for(t=this.next_;null!=t?t.is_secondary():void 0;)t=t.twin().next();return t!==this.twin_?t:void 0},r}(),Bt=function(t,e){return Math.abs(t.x()-e.x())<l&&Math.abs(t.y()-e.y())<l},Zt=function(){function t(){this.cells_=[],this.vertices_=[],this.edges_=[]}return t.prototype.cells_=[],t.prototype.vertices_=[],t.prototype.edges_=[],t.prototype.clear=function(){return this.cells_=[],this.vertices_=[],this.edges_=[]},t.prototype.cells=function(){return this.cells_},t.prototype.vertices=function(){return this.vertices_},t.prototype.edges=function(){return this.edges_},t.prototype.num_cells=function(){return this.cells_.length},t.prototype.num_edges=function(){return this.edges_.length},t.prototype.num_vertices=function(){return this.vertices_.length},t.prototype._reserve=function(t){},t.prototype._process_single_site=function(t){return this.cells_.push(new Wt(t.initial_index(),t.source_category()))},t.prototype._insert_new_edge=function(t,e,n,i,r){var o,s,_,l,u,p,h,a,c,f,y,v,d,x,g,w,m;return null==n?(d=t,x=e,w=d.sorted_index(),m=x.sorted_index(),a=this.is_linear_edge(d,x),c=this.is_primary_edge(d,x),this.edges_.push(new Xt(a,c)),l=this.edges_[this.edges_.length-1],this.edges_.push(new Xt(a,c)),p=this.edges_[this.edges_.length-1],0===this.cells_.length&&this.cells_.push(new Wt(d.initial_index(),d.source_category())),this.cells_.push(new Wt(x.initial_index(),x.source_category())),l.cell(this.cells_[w]),p.cell(this.cells_[m]),l.twin(p),p.twin(l),{first:l,second:p}):(d=t,g=e,o=n,s=i,_=r,u=s,h=_,this.vertices_.push(new Qt(o.x(),o.y())),v=this.vertices_[this.vertices_.length-1],u.vertex0(v),h.vertex0(v),a=this.is_linear_edge(d,g),c=this.is_primary_edge(d,g),this.edges_.push(new Xt(a,c)),f=this.edges_[this.edges_.length-1],f.cell(this.cells_[d.sorted_index()]),this.edges_.push(new Xt(a,c)),y=this.edges_[this.edges_.length-1],y.cell(this.cells_[g.sorted_index()]),f.twin(y),y.twin(f),y.vertex0(v),u.prev(f),f.next(u),u.twin().next(h),h.prev(u.twin()),h.twin().next(y),y.prev(h.twin()),{first:f,second:y})},t.prototype._build=function(){var t,e,n,i,r,o,s,_,l,u,p,h,a,c,f,y,v,d,x,g,w,m,E,b,T,q,M;for(p=0,l=u=0,x=this.edges_.length;x>u;l=u+=2)q=this.edges_[l].vertex0(),M=this.edges_[l].vertex1(),null!=q&&null!=M&&Bt(q,M)?this.remove_edge(this.edges_[l]):(l!==p&&(p=l,n=this.edges_[p],i=this.edges_[p+1],n.twin(i),i.twin(n),null!=n.prev()&&(n.prev().next(n),i.next().prev(i)),null!=i.prev()&&(n.next().prev(n),i.prev().next(i))),p+=2);for(this.edges_.splice(p,this.edges_.length-p-1),g=this.edges_,y=0,c=g.length;c>y;y++)r=g[y],r.cell().incident_edge(r),null!=r.vertex0()&&r.vertex0().incident_edge(r);if(h=0,this.vertices_.length>0)for(l=v=0,w=this.vertices_.length-1;w>=0?w>v:v>w;l=w>=0?++v:--v)if(null!=this.vertices_[l].incident_edge()){if(l!==h)for(this.vertices_[h]=this.vertices_[l],T=this.vertices_[h],e=T.incident_edge();;)if(e.vertex0(T),e=e.rot_next(),e===T.incident_edge())break;++h}if(this.vertices_.splice(h,this.vertices_.length-h-1),0===this.vertices_.length){if(0!==this.edges_.length){for(_=0,o=this.edges_[_],o.next(o),o.prev(o),++_,o=this.edges_[_],++_;_<=this.edges_.length-1;)s=this.edges_[_],++_,o.next(s),o.prev(s),s.next(o),s.prev(o),o=this.edges_[_],++_;return o.next(o),o.prev(o)}for(m=this.cells_,E=[],d=0,f=m.length;f>d;d++)if(t=m[d],!t.is_degenerate()){for(a=t.incident_edge();null!=a.prev()&&(a=a.prev(),a!==t.incident_edge()););if(null==a.prev()){for(b=t.incident_edge();null!=b.next();)b=b.next();a.prev(b),E.push(b.next(a))}}return E}},t.prototype.is_primary_edge=function(t,e){var n,i;return n=t.is_segment(),i=e.is_segment(),n&&!i?!t.point0().equals(e.point0())&&!t.point1().equals(e.point0()):!n&&i?!e.point0().equals(t.point0())&&!e.point1().equals(t.point0()):!0},t.prototype.is_linear_edge=function(t,e){return this.is_primary_edge(t,e)?!(t.is_segment()^e.is_segment()):!0},t.prototype.remove_edge=function(t){var e,n,i,r,o,s,_,l;for(l=t.vertex0(),_=t.twin().rot_next();_!==t.twin();)_.vertex0(l),_=_.rot_next();return e=t,r=t.twin(),i=e.rot_prev(),n=e.rot_next(),s=r.rot_prev(),o=r.rot_next(),n.twin().next(s),s.prev(n.twin()),i.prev(o.twin()),o.twin().next(i)},t}(),"undefined"!=typeof module&&null!==module&&(module.exports={voronoi_diagram:Zt}),"undefined"!=typeof require&&null!==require&&(It=require("./constants"),S=It.SOURCE_CATEGORY_SINGLE_POINT,R=It.SOURCE_CATEGORY_SEGMENT_START_POINT,O=It.SOURCE_CATEGORY_SEGMENT_END_POINT,M=It.SOURCE_CATEGORY_REVERSE_SEGMENT,q=It.SOURCE_CATEGORY_INITIAL_SEGMENT,Nt=require("./collections"),yt=Nt.ordered_queue,ct=Nt.ordered_map,pt=Nt.list,At=require("./voronoi_predicates"),at=At.node_comparison_predicate,wt=At.point_comparison_predicate,Q=At.event_comparison_predicate,J=At.circle_formation_predicate,st=At.is_vertical,Pt=require("./voronoi_structures"),Gt=Pt.site_event,D=Pt.circle_event,gt=Pt.point_2d,G=Pt.beach_line_node_key,k=Pt.beach_line_node_data),Vt=function(){function t(){this.index_=0,this.circle_events_=new yt(this.event_comparison),this.end_points_=new yt(this.end_point_comparison),this.beach_line_=new ct(at),this.site_events_=new pt}return t.prototype.event_comparison=function(t,e){return Q(e.first,t.first)},t.prototype.end_point_comparison=function(t,e){return wt(e.first,t.first)},t.prototype.point_comparison_=function(t,e){return wt(t,e)},t.prototype.site_events_=null,t.prototype.site_event_iterator_=null,t.prototype.end_points_=null,t.prototype.circle_events_=null,t.prototype.beach_line_=null,t.prototype.index_=0,t.prototype.insert_point=function(t,e){var n;return n=new Gt(t,e),this.site_events_.push(n),n.initial_index(this.index_),n.source_category(S),this.index_++},t.prototype.insert_segment=function(t,e,n,i){var r,o,s,_,l;return r=new gt(t,e),_=new Gt(r),this.site_events_.push(_),_.initial_index(this.index_),_.source_category(R),o=new gt(n,i),l=new Gt(o),this.site_events_.push(l),l.initial_index(this.index_),l.source_category(O),s=null,this.point_comparison_(r,o)?(s=new Gt(r,o),this.site_events_.push(s),s.source_category(q)):(s=new Gt(o,r),this.site_events_.push(s),s.source_category(M)),s.initial_index(this.index_),this.index_++},t.prototype.print_beachline=function(){var t,e;for(e="beach_line: \n",t=this.beach_line_.begin();t!==this.beach_line_.end();)e+="    ",e+=t.key().print(),e+="  -  ",null!=t.value()&&(e+=t.value().print()),e+="\n",t=t.next();return e+="\n"},t.prototype.print_site_events=function(){var t,e;for(e="site_events:\n",t=this.site_events_.begin();t!==this.site_events_.end();)e+=t===this.site_event_iterator_?" >> ":"    ",e+=t.value().print(),t===this.site_event_iterator_&&(e+=" << "),t=t.next(),e+="\n";return e+="\n"},t.prototype.print_current_end_point_top=function(){var t;return t="end_points("+this.end_points_.size()+"):\n",this.end_points_.size()>0&&(t+="    ",t+=this.end_points_.top().first.print(),t+="  -  ",t+=this.end_points_.top().second.key().print(),t+="\n"),t},t.prototype.print_circle_events=function(){return"circle_events: \n"+this.circle_events_.print()},t.prototype.site_events_to_json=function(){var t,e,n;for(e=[],n=this.site_events_.begin();n!==this.site_events_.end();)t=n.value().to_json(),t.current=n===this.site_event_iterator_,e.push(t),n=n.next();return e},t.prototype.beachline_to_json=function(){var t,e,n;if(e=[],0===this.beach_line_.size())return e;for(n=this.beach_line_.begin();n!==this.beach_line_.end();)t={},t.key=n.key().to_json(),t.value=null!=n.value()?n.value().to_json():null,n=n.next(),e.push(t);return e},t.prototype.generate_iteration_json_node=function(t){return{iteration:t,beachline:this.beachline_to_json(),site_events:this.site_events_to_json(),circle_events:this.circle_events_.to_json()}},t.prototype.construct=function(t,e){var n;for(null==e&&(e=null),t._reserve(this.site_events_.size()),this.init_sites_queue(),null!=e&&e.push(this.generate_iteration_json_node("AFTER init_sites_queue")),this.init_beach_line(t),null!=e&&e.push(this.generate_iteration_json_node("AFTER init_beach_line")),n=0;!this.circle_events_.empty()||this.site_event_iterator_!==this.site_events_.end();)for(n++,this.circle_events_.empty()?(this.process_site_event(t),null!=e&&e.push(this.generate_iteration_json_node("AFTER top process_site_event ITERATION: "+n))):this.site_event_iterator_===this.site_events_.end()?(this.process_circle_event(t),null!=e&&e.push(this.generate_iteration_json_node("AFTER top process_circle_event ITERATION: "+n))):Q(this.site_event_iterator_.value(),this.circle_events_.top().first)?(this.process_site_event(t),null!=e&&e.push(this.generate_iteration_json_node("AFTER bottom process_site_event ITERATION: "+n))):(this.process_circle_event(t),null!=e&&e.push(this.generate_iteration_json_node("AFTER bottom process_circle_event ITERATION: "+n)));!this.circle_events_.empty()&&!this.circle_events_.top().first.is_active();)this.circle_events_.pop(),null!=e&&e.push(this.generate_iteration_json_node("AFTER circle_events_.pop() ITERATION: "+n));return this.beach_line_.clear(),t._build()},t.prototype.clear=function(){return this.index_=0,this.site_events_.clear()},t.prototype.init_sites_queue=function(){var t,e,n;for(this.site_events_.jsSort(Q),this.site_events_=this.site_events_.unique(function(t,e){return t.equals(e)}),t=e=0,n=this.site_events_.size();n>=0?n>e:e>n;t=n>=0?++e:--e)this.site_events_.at(t).value().sorted_index(t);this.site_event_iterator_=this.site_events_.begin()},t.prototype.init_beach_line=function(t){var e;if(!this.site_events_.empty())if(1===this.site_events_.size())t._process_single_site(this.site_events_.begin().value()),this.site_event_iterator_=this.site_event_iterator_.next();else{for(e=0;this.site_event_iterator_!==this.site_events_.end()&&st(this.site_event_iterator_.value().point0(),this.site_events_.begin().value().point0())&&st(this.site_event_iterator_.value());)this.site_event_iterator_=this.site_event_iterator_.next(),++e;1===e?this.init_beach_line_default(t):this.init_beach_line_collinear_sites(t)}},t.prototype.init_beach_line_default=function(t){var e,n;e=this.site_events_.begin(),n=this.site_events_.begin(),n=n.next(),this.insert_new_arc(e.value(),e.value(),n.value(),this.beach_line_.end(),t),this.site_event_iterator_=this.site_event_iterator_.next()},t.prototype.init_beach_line_collinear_sites=function(t){var e,n,i,r;for(n=this.site_events_.begin(),i=this.site_events_.begin(),i=i.next();i!==this.site_event_iterator_;)r=new G(n.value(),i.value()),e=t._insert_new_edge(n.value(),i.value()).first,this.beach_line_.insert(r,new k(e)),n=n.next(),i=i.next()},t.prototype.deactivate_circle_event=function(t){null!=t.circle_event()&&(t.circle_event().deactivate(),t.circle_event(null))},t.prototype.process_site_event=function(t){var e,n,i,r,o,s,_,l,u,p,h,a;if(a=this.site_event_iterator_.value(),n=this.site_event_iterator_.next(),a.is_segment())for(;n!==this.site_events_.end()&&n.value().is_segment()&&n.value().point0().equals(a.point0());)n=n.next();else for(;!this.end_points_.empty()&&this.end_points_.top().first.equals(a.point0());)e=this.end_points_.top().second,this.end_points_.pop(),this.beach_line_.erase(e);for(r=new G(this.site_event_iterator_.value()),s=this.beach_line_.lowerBound(r);this.site_event_iterator_!==n;)a=this.site_event_iterator_.value(),i=s,s===this.beach_line_.end()?(i=i.prev(),u=i.key().right_site(),s=this.insert_new_arc(u,u,a,s,t),this.activate_circle_event(i.key().left_site(),i.key().right_site(),a,s)):s===this.beach_line_.begin()?(u=s.key().left_site(),i=this.insert_new_arc(u,u,a,s,t),a.is_segment()&&a.inverse(),this.activate_circle_event(a,s.key().left_site(),s.key().right_site(),s),s=i):(h=s.key().left_site(),l=s.key().right_site(),this.deactivate_circle_event(s.value()),i=i.prev(),p=i.key().right_site(),_=i.key().left_site(),o=this.insert_new_arc(p,h,a,s,t),this.activate_circle_event(_,p,a,o),a.is_segment()&&a.inverse(),this.activate_circle_event(a,h,l,s),s=o),this.site_event_iterator_=this.site_event_iterator_.next()},t.prototype.process_circle_event=function(t){var e,n,i,r,o,s,_,l,u,p;r=this.circle_events_.top(),i=r.first,o=r.second,s=o,l=o.key().right_site(),n=o.value().edge(),o=o.prev(),e=o.value().edge(),_=o.key().left_site(),!_.is_segment()&&l.is_segment()&&l.point1().equals(_.point0())&&l.inverse(),o.key().right_site(l),o.value().edge(t._insert_new_edge(_,l,i,e,n).first),this.beach_line_.erase(s),s=o,this.circle_events_.pop(),o!==this.beach_line_.begin()&&(this.deactivate_circle_event(o.value()),o=o.prev(),u=o.key().left_site(),this.activate_circle_event(u,_,l,s)),s=s.next(),s!==this.beach_line_.end()&&(this.deactivate_circle_event(s.value()),p=s.key().right_site(),this.activate_circle_event(_,l,p,s))},t.prototype.insert_new_arc=function(t,e,n,i,r){var o,s,_,l;return s=new G(t,n),l=new G(n,e),n.is_segment()&&l.left_site().inverse(),o=r._insert_new_edge(e,n),i=this.beach_line_.insert(l,new k(o.second)),n.is_segment()&&(_=new G(n,n),_.right_site().inverse(),i=this.beach_line_.insert(_,new k(null)),this.end_points_.push({first:n.point1(),second:i})),i=this.beach_line_.insert(s,new k(o.first))},t.prototype.activate_circle_event=function(t,e,n,i){var r,o;r=new D,J(t,e,n,r)&&(o=this.circle_events_.push({first:r,second:i}),i.value().circle_event(o.first))},t.prototype.test_end_points_datastructure=function(){var t,e,n,i,r;for(t={},e=new gt(2,3),n=new gt(3,1),i=new gt(2,2),this.end_points_.push({first:e,second:t}),this.end_points_.push({first:n,second:t}),this.end_points_.push({first:i,second:t}),console.log("### test_end_points_datastructure ###"),console.log("    expected: (2, 2), (2, 3), (3, 1) ordering"),r=[];!this.end_points_.empty();)console.log("    "+this.end_points_.top().first.print()),r.push(this.end_points_.pop());return r},t}(),"undefined"!=typeof module&&null!==module&&(module.exports={voronoi_builder:Vt}),mt=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.x=0,t.prototype.y=0,t.prototype.assign=function(t){return this.x=t.x,this.y=t.y},t.prototype.equals=function(t){return Math.abs(t.x-this.x)<l&&Math.abs(t.y-this.y)<l},t.prototype.get=function(t){return t===c?this.x:this.y},t.prototype.set=function(t,e){t===c?this.x=e:this.y=e},t.prototype.lessThan=function(t){return this.x<t.x||Math.abs(this.x-t.x)<l&&this.y<t.y},t.prototype.lessThanEqual=function(t){return lessThan(t)},t.prototype.greaterThan=function(t){return!lessThan(t)},t.prototype.greaterTHanEqual=function(t){return!lessThan(t)},t}(),"undefined"!=typeof module&&null!==module&&(module.exports={point_data:mt}),kt=function(){function t(t,e){this.lowPt=t,this.highPt=e}return t.prototype.lowPt=null,t.prototype.highPt=null,t.prototype.assign=function(t){return this.lowPt=mt(t.lowPt.x,t.lowPt.y),this.highPt=mt(t.highPt.x,t.highPt.y)},t.prototype.equals=function(t){return this.lowPt.equals(t.lowPt)&&this.highPt.equals(t.hightPt)},t.prototype.get=function(t){return t===v?this.lowPt:this.highPt},t.prototype.set=function(t,e){return t===v?this.lowPt.assign(e):this.highPt.assign(e)},t.prototype.low=function(){return this.lowPt},t.prototype.high=function(){return this.highPt},t.prototype.lessThan=function(t){return this.lowPt.equals(t.lowPt)?this.highPt.lessThan(t.highPt):this.lowPt.lessThan(t.lowPt)},t.prototype.lessThanEqual=function(t){return lessThan(t)},t.prototype.greaterThan=function(t){return!lessThan(t)},t.prototype.greaterThanEqual=function(t){return!lessThan(t)},t}(),"undefined"!=typeof module&&null!==module&&(module.exports={segment_data:kt}),"undefined"!=typeof require&&null!==require&&(Vt=require("./voronoi_builder").voronoi_builder,mt=require("./point_data").point_data,kt=require("./segment_data").segment_data),it=function(t,e){var n,i,r,o;if(t instanceof mt)return e.insert_point(t.x,t.y);if(t instanceof kt)return e.insert_segment(t.low().x,t.low().y,t.high().x,t.high().y);if(Array.isArray(t)){for(o=[],i=0,r=t.length;r>i;i++)n=t[i],o.push(it(n,e));return o}},H=function(t,e,n){var i;return null==n&&(n=null),i=new Vt,it(t,i),i.construct(e,n)},H=function(t,e,n,i){var r;return null==i&&(i=null),r=new Vt,it(t,r),it(e,r),r.construct(n,i)},"undefined"!=typeof module&&null!==module&&(module.exports={construct_voronoi:H}),"undefined"!=typeof require&&null!==require&&(Yt=require("./voronoi_predicates").static_cast_int),$t=function(){function t(){}return t.prototype.cast=Yt,t.prototype.discretize=function(t,e,n,i){var r,o,s,_,l,u,p,h,a,c,f,y,v,d,x,g,w,m,E,b,T,q;if(b=this.cast(e.high().x)-this.cast(e.low().x),T=this.cast(e.high().y)-this.cast(e.low().y),q=b*b+T*T,w=q*this.get_point_projection(i[0],e),g=q*this.get_point_projection(i[1],e),d=this.cast(t.x)-this.cast(e.low().x),x=this.cast(t.y)-this.cast(e.low().y),m=b*d+T*x,E=b*x-T*d,0===E)return _="Invalid parabola detected: \npoint: "+JSON.stringify(t)+"\nsegment: "+JSON.stringify(e)+"\ndiscretization: "+JSON.stringify(i),void console.error(_);for(p=i[1],i.pop(),v=[],v.unshift(g),r=w,o=this.parabola_y(r,m,E),h=n*n*q;v.length>0;)f=v[0],y=this.parabola_y(f,m,E),a=(y-o)/(f-r)*E+m,c=this.parabola_y(a,m,E),s=(y-o)*(a-r)-(f-r)*(c-o),s=s*s/((y-o)*(y-o)+(f-r)*(f-r)),h>=s?(v.shift(),l=(b*f-T*y)/q+this.cast(e.low().x),u=(b*y+T*f)/q+this.cast(e.low().y),i.push(new mt(l,u)),r=f,o=y):v.unshift(a);return i[i.length-1]=p},t.prototype.discretize2=function(t,e,n,i){var r,o,s,_,l,u,p,h,a,c,f,y,v,d,x,g,w,m,E,b,T,q,M,O,R,S;if(O=this.cast(e.high().x)-this.cast(e.low().x),R=this.cast(e.high().y)-this.cast(e.low().y),S=O*O+R*R,E=S*this.get_point_projection(i[0],e),g=S*this.get_point_projection(i[1],e),v=this.cast(t.x)-this.cast(e.low().x),d=this.cast(t.y)-this.cast(e.low().y),q=O*v+R*d,M=O*d-R*v,0===M)return _="Invalid parabola detected: \npoint: "+JSON.stringify(t)+"\nsegment: "+JSON.stringify(e)+"\ndiscretization: "+JSON.stringify(i),void console.error(_);if(T=E>g,m=Math.min(E,g),w=Math.max(E,g),s=n*Math.sqrt(S),x=[],q>=m&&w>=q){for(r=q,o=M/2;r>m;)x.unshift({x:r,y:o}),o+=s,r=this.parabola_x_low(o,q,M);for(r=q,o=M/2,l=!0;w>r;)l||x.push({x:r,y:o}),o+=s,r=this.parabola_x_high(o,q,M),l=!1}else if(m>q)for(r=m,o=this.parabola_y(r,q,M),l=!0;w>r;)l||x.push({x:r,y:o}),o+=s,r=this.parabola_x_high(o,q,M),l=!1;else if(q>w)for(r=m,o=this.parabola_y(r,q,M),l=!0;w>r&&(l||x.push({x:r,y:o}),o-=s,!(M/2>o));)r=this.parabola_x_low(o,q,M),l=!1;for(a=i[1],i.pop(),T&&x.reverse(),h=0,c=x.length;c>h;h++)b=x[h],f=b.x,y=b.y,u=(O*f-R*y)/S+this.cast(e.low().x),p=(O*y+R*f)/S+this.cast(e.low().y),i.push(new mt(u,p));return i.push(a)},t.prototype.discretize_central_angle=function(t,e,n,i){var r,o,s,_,l,u,p,h,a,c,f,y,v,d,x,g,w,m,E,b,T,q,M,O,R,S,I,N,A;if(M=this.cast(e.high().x)-this.cast(e.low().x),O=this.cast(e.high().y)-this.cast(e.low().y),R=M*M+O*O,b=R*this.get_point_projection(i[0],e),E=R*this.get_point_projection(i[1],e),w=this.cast(t.x)-this.cast(e.low().x),m=this.cast(t.y)-this.cast(e.low().y),T=M*w+O*m,q=M*m-O*w,0===q)return p="Invalid parabola detected: \npoint: "+JSON.stringify(t)+"\nsegment: "+JSON.stringify(e)+"\ndiscretization: "+JSON.stringify(i),void console.error(p);for(c=i[1],i.pop(),g=[],g.unshift(E),_=b,l=this.parabola_y(_,T,q),o=T,s=q;g.length>0;)d=g[0],x=this.parabola_y(d,T,q),y=(x-l)/(d-_)*q+T,v=this.parabola_y(y,T,q),S=d-o,I=x-s,N=_-o,A=l-s,f=Math.sqrt((S*S+I*I)*(N*N+A*A)),0===f?(console.error("Division by zero!"),r=0):(u=(S*N+I*A)/f,r=Math.acos(u)),n>=r?(g.shift(),h=(M*d-O*x)/R+this.cast(e.low().x),a=(M*x+O*d)/R+this.cast(e.low().y),i.push(new mt(h,a)),_=d,l=x):g.unshift(y);return i[i.length-1]=c},t.prototype.discretize_point_point=function(t,e,n,i){var r,o,s,_,l,u,p,h,a,c,f,y;for(u=function(t,e,n,i){var r,o;return r=t-n,o=e-i,Math.sqrt(r*r+o*o)},p=i[1],i.pop(),y=[],y.unshift(p),r=i[0].x,o=i[0].y;y.length>0;)c=y[0].x,f=y[0].y,h=(r+c)/2,a=(o+f)/2,s=u(r,o,t.x,t.y),_=u(h,a,t.x,t.y),l=u(c,f,t.x,t.y),Math.abs(s-l)<=n&&Math.abs(s-_)<=n?(y.shift(),i.push(new mt(c,f)),r=c,o=f):y.unshift({x:h,y:a});return i.push(p)},t.prototype.parabola_y=function(t,e,n){return((t-e)*(t-e)+n*n)/(n+n)},t.prototype.parabola_x_low=function(t,e,n){var i,r;return r=2*n*t-n*n,0>r?(console.error("can't discretisize! trying to get a square root of a negative number !!"),null):(i=Math.sqrt(r),e-i)},t.prototype.parabola_x_high=function(t,e,n){var i,r;return r=2*n*t-n*n,0>r?(console.error("can't discretisize! trying to get a square root of a negative number !!"),null):(i=Math.sqrt(r),e+i)},t.prototype.get_point_projection=function(t,e){var n,i,r,o,s,_;return r=this.cast(e.high().x)-this.cast(e.low().x),o=this.cast(e.high().y)-this.cast(e.low().y),n=t.x-this.cast(e.low().x),i=t.y-this.cast(e.low().y),s=r*r+o*o,_=r*n+o*i,_/s},t}(),Kt=function(){function t(t,e,n,i){this.path=t,this.holes=e,this.filtering_angle=n,this.debug_flags=i}return t.prototype.showErrorAndDumpData=function(t){var e;return e="Invalid medial axis detected!\n",null!=t&&(e+="Possible cause: "+t+"\n"),e+="Input data: \n",e+="  path: "+JSON.stringify(this.path)+"\n",e+="  holes: "+JSON.stringify(this.holes)+"\n",e+="  filtering_angle: "+JSON.stringify(this.filtering_angle)+"\n",e+="  debug_flags: "+JSON.stringify(this.debug_flags)+"\n",console.error(e)},t.prototype.isNaNEdge=function(t){return isNaN(t.vertex0().x())||isNaN(t.vertex0().y())||isNaN(t.vertex1().x())||isNaN(t.vertex1().y())?(this.showErrorAndDumpData("Self intersecting polygon?"),!0):!1},t.prototype.isInvalidPrimaryEdge=function(t){return t.is_primary()&&null!=t.vertex0()&&null!=t.vertex1()?!1:(this.showErrorAndDumpData("Not a primary edge"),!0)},t}(),V=function(){function t(){}return t.prototype.equal_points=function(t,e){return Math.abs(t.x-e.x)<l&&Math.abs(t.y-e.y)<l},t.prototype.input_data=function(t){var e,n,i,r,o,s;for(s="",e=n=0,o=t.length-1;o>=0?o>n:n>o;e=o>=0?++n:--n)i=t[e],r=t[e+1],s+="addTwoPoints("+Math.round(i.x)+", "+Math.round(i.y)+", "+Math.round(r.x)+", "+Math.round(r.y)+", points, segments);\n";return this.equal_points(t[0],t[t.length-1])||(i=t[t.length-1],r=t[0],s+="addTwoPoints("+Math.round(i.x)+", "+Math.round(i.y)+", "+Math.round(r.x)+", "+Math.round(r.y)+", points, segments);\n"),s},t.prototype.generate=function(t,e){var n,i,r,o;for(o="",o+=this.input_data(t),n=0,i=e.length;i>n;n++)r=e[n],o+=this.input_data(r);return o},t}(),"undefined"!=typeof module&&null!==module&&(module.exports={cppgen:V}),"undefined"!=typeof require&&null!==require&&(Lt=require("./constants"),l=Lt.EPSILON,S=Lt.SOURCE_CATEGORY_SINGLE_POINT,V=require("./cppgen"),mt=require("./point_data").point_data,kt=require("./segment_data").segment_data,Zt=require("./voronoi_diagram").voronoi_diagram,H=require("./voronoi").construct_voronoi),this.JSPoly={points_:[],segments_:[],colors:{unclassified:11,secondary:1,outer_primary:2,inner_primary:3,hole_primary:4},parabola_discretization_method:{ERROR_2D:0,RADIUS:1,CENTRAL_ANGLE:2},point_in_poly:function(t,e){var n,i,r,o,s;for(i=!1,n=0,r=e.length-1;n<e.length;)o=e[n],s=e[r],o.y-t.y>l!=s.y-t.y>l&&(s.x-o.x)*(t.y-o.y)/(s.y-o.y)+o.x-t.x>l&&(i=!i),r=n++;return i},clear:function(){return this.points_=[],this.segments_=[]},equals:function(t,e){return Math.abs(t-e)<l},equal_points:function(t,e){return this.equals(t.x,e.x)&&this.equals(t.y,e.y)},generate_points_and_segments:function(t,e){var n,i,r,o,s,_,l,u,p,h;if(s=[],h=[],0===t.length)return{points:s,segments:h};for(n=i=0,u=t.length-1;u>=0?u>i:i>u;n=u>=0?++i:--i)_=t[n],l=t[n+1],r=new mt(_.x,_.y),o=new mt(l.x,l.y),r.is_hole=e,o.is_hole=e,s.push(r),p=new kt(r,o),p.is_hole=e,h.push(p);return this.equal_points(t[0],t[t.length-1])||(_=t[t.length-1],l=t[0],r=new mt(_.x,_.y),o=new mt(l.x,l.y),r.is_hole=e,o.is_hole=e,s.push(r),p=new kt(r,o),p.is_hole=e,h.push(p)),{points:s,segments:h}},construct_voronoi_diagram_for_rounded_data:function(t,e,n){var i,r,o,s,_;for(null==n&&(n=null),this.clear(),s=this.generate_points_and_segments(t,!1),this.points_=this.points_.concat(s.points),this.segments_=this.segments_.concat(s.segments),r=0,o=e.length;o>r;r++)i=e[r],s=this.generate_points_and_segments(i,!0),this.points_=this.points_.concat(s.points),this.segments_=this.segments_.concat(s.segments);return _=new Zt,H(this.points_,this.segments_,_,n),_},construct_voronoi_diagram:function(t,e,n){var i;return null==n&&(n=null),i=this.round_input_data(t,e),t=i.boundary,e=i.holes,this.construct_voronoi_diagram_for_rounded_data(t,e,n)},construct_voronoi_diagram_with_edge_classification:function(t,e,n){var i,r;return null==n&&(n=null),i=this.round_input_data(t,e),t=i.boundary,e=i.holes,r=this.construct_voronoi_diagram_for_rounded_data(t,e),this.classify_edges(r,t,e,n),r},create_edge_json_data_for_testing:function(t){var e,n,i,r,o,s,_;for(i=[],_=t.edges(),r=0,o=_.length;o>r;r++)n=_[r],e={},e.is_finite=n.is_finite(),e.is_infinite=n.is_infinite(),e.is_primary=n.is_primary(),e.is_secondary=n.is_secondary(),e.is_linear=n.is_linear(),e.is_curved=n.is_curved(),null===n.vertex0()?e.vertex0=null:(s={},s.x=n.vertex0().x(),s.y=n.vertex0().y(),e.vertex0=s),null===n.vertex1()?e.vertex1=null:(s={},s.x=n.vertex1().x(),s.y=n.vertex1().y(),e.vertex1=s),e.color=n.color(),i.push(e);return i},retrieve_point:function(t){var e,n;return n=t.source_index(),e=t.source_category(),e===S?this.points_[n]:(n-=this.points_.length,e===R?this.segments_[n].low():this.segments_[n].high())},retrieve_segment:function(t){var e;return e=t.source_index()-this.points_.length,this.segments_[e]},get_cells_angle:function(t){var e,n,i;return e=function(t,e,n){var i;return i=(t.x-e.x)*(n.x-e.x)+(n.y-e.y)*(t.y-e.y),Math.acos(i/(Math.hypot(t.x-e.x,t.y-e.y)*Math.hypot(n.x-e.x,n.y-e.y)))},t.cell().contains_point()||t.twin().cell().contains_point()?null:(n=this.retrieve_segment(t.cell()),i=this.retrieve_segment(t.twin().cell()),n.low().equals(i.low())?e(n.high(),n.low(),i.high()):n.high().equals(i.low())?e(n.low(),n.high(),i.high()):n.low().equals(i.high())?e(n.high(),n.low(),i.low()):n.high().equals(i.high())?e(n.low(),n.high(),i.low()):null)},distance_to_point:function(t,e){return Math.hypot(t.x-e.x,t.y-e.y)},distance_to_segment:function(t,e){var n,i,r,o;return n=e.low().x,r=e.low().y,i=e.high().x,o=e.high().y,Math.abs((o-r)*t.x-(i-n)*t.y+i*r-o*n)/Math.hypot(r-o,n-i)},create_output_segments:function(t,e,n,i,r,o,s,_){var l,u,p,h,a,c,f,y,v,d,x,g,w,m,E;if(null==o&&(o=.1),null==s&&(s=this.parabola_discretization_method.ERROR_2D),null==_&&(_=-1),w=[],w.push(new mt(t.vertex0().x(),t.vertex0().y())),w.push(new mt(t.vertex1().x(),t.vertex1().y())),t.is_curved())for(f=t.cell().contains_point()?this.retrieve_point(t.cell()):this.retrieve_point(t.twin().cell()),m=t.cell().contains_point()?this.retrieve_segment(t.twin().cell()):this.retrieve_segment(t.cell()),s===this.parabola_discretization_method.RADIUS?i||(new $t).discretize2(f,m,o,w):s===this.parabola_discretization_method.ERROR_2D?i||(new $t).discretize(f,m,o,w):s===this.parabola_discretization_method.CENTRAL_ANGLE&&(i||(new $t).discretize_central_angle(f,m,o,w)),u=0,p=w.length;p>u;u++)g=w[u],g.radius=this.distance_to_point(f,g),r&&(g.sites=[{type:"point",site:{x:f.x,y:f.y}},{type:"segment",site:{x1:m.low().x,y1:m.low().y,x2:m.high().x,y2:m.high().y}}]);else if(t.cell().contains_point()&&t.twin().cell().contains_point())for(f=this.retrieve_point(t.cell()),-1!==_&&(new $t).discretize_point_point(f,m,_,w),a=0,h=w.length;h>a;a++)g=w[a],g.radius=this.distance_to_point(f,g),r&&(y=this.retrieve_point(t.twin().cell()),g.sites=[{type:"point",site:{x:f.x,y:f.y}},{type:"point",site:{x:y.x,y:y.y}}]);else{if(t.cell().contains_point()||t.twin().cell().contains_point())return!1;m=this.retrieve_segment(t.cell()),w[0].radius=this.distance_to_segment(w[0],m),w[1].radius=this.distance_to_segment(w[1],m),r&&(E=this.retrieve_segment(t.twin().cell()),w[0].sites=[{type:"segment",site:{x1:m.low().x,y1:m.low().y,x2:m.high().x,y2:m.high().y}},{type:"segment",site:{x1:E.low().x,y1:E.low().y,x2:E.high().x,y2:E.high().y}}],w[1].sites=[{type:"segment",site:{x1:m.low().x,y1:m.low().y,x2:m.high().x,y2:m.high().y}},{type:"segment",site:{x1:E.low().x,y1:E.low().y,x2:E.high().x,y2:E.high().y}}])}for(d=w[0],l=c=1,x=w.length;x>=1?x>c:c>x;l=x>=1?++c:--c)v=w[l],n.push({point0:{x:d.x,y:d.y,radius:d.radius},point1:{x:v.x,y:v.y,radius:v.radius},sites:r?d.sites:void 0}),d=v;return!0},cppgen:V,colorPrimaryEdges:function(t,e,n,i){var r,o,s,_;for(_=[t],s=0,null!=n&&i({twinEdges:_.length,iteration:s});_.length>0&&!(null!=n&&s>n);){for(o=_[0],_.splice(0,1),s++,null!=n&&i({twinEdges:_.length,iteration:s}),o.color(e),r=o.next_primary();r!==o&&null!=r&&r.color()===this.colors.unclassified&&(r.twin().color()===this.colors.unclassified&&_.unshift(r.twin()),
!(null!=n&&s>n));)r.color(e),r=r.next_primary(),s++,null!=n&&i({twinEdges:_.length,iteration:s});_=_.filter(function(t){return t.color()===JSPoly.colors.unclassified})}null!=n&&i({twinEdges:_.length,iteration:s})},get_non_border_point:function(t){var e,n,i,r,o;if(o=function(t){return{x:t.x(),y:t.y()}},n=o(t.vertex0()),i=o(t.vertex1()),t.cell().contains_point()){if(e=this.retrieve_point(t.cell()),!this.equal_points(n,e))return n}else if(r=this.retrieve_segment(t.cell()),!this.equal_points(n,r.low())&&!this.equal_points(n,r.high()))return n;return i},classify_edges:function(t,e,n,i,r,o){var s,_,l,u,p,h,a,c,f,y,v,d,x,g,w,m;for(null==i&&(i=new Kt([],[])),null==r&&(r=null),null==o&&(o=function(){}),m=[],w=t.edges(),_=0,l=w.length;l>_;_++)s=w[_],s.is_primary()?s.is_infinite()?s.color(this.colors.outer_primary):(s.color(this.colors.unclassified),m.push(s)):s.color(this.colors.secondary);for(x=[].concat([e],n),y={x:0,y:0},d=[y],a=0,u=x.length;u>a;a++)if(v=x[a],0!==v.length){for(c=0,p=v.length;p>c;c++)g=v[c],d.push(g);this.equal_points(v[0],v[v.length-1])||d.push(v[0]),d.push(y)}for(f=0,h=m.length;h>f;f++)s=m[f],s.color()!==this.colors.inner_primary&&(g=this.get_non_border_point(s),this.point_in_poly(g,d)&&(s.color(this.colors.inner_primary),s.twin().color(this.colors.inner_primary)));return t.edges()},dump:function(t,e,n){return null==n&&(n=""),console.error(n+JSON.stringify({boundary:t,holes:e}))},round_input_data:function(t,e){return{boundary:t.map(function(t){return{x:Math.round(t.x),y:Math.round(t.y)}}),holes:e.map(function(t){return t.map(function(t){return{x:Math.round(t.x),y:Math.round(t.y)}})})}},construct_medial_axis:function(t,e,n,i,r,o,s){var _,l,u,p,h,a,c,f,y,v,d,x,g,w,m,E,b,T,q,M,O,R,S,I;for(null==n&&(n=.1),null==i&&(i=this.parabola_discretization_method.CENTRAL_ANGLE),null==r&&(r=3*Math.PI/4),null==o&&(o=-1),null==s&&(s={no_parabola:!1,show_sites:!1}),l=new Kt(t,e,r,s),m=s.no_parabola,R=s.show_sites,O=this.round_input_data(t,e),t=O.boundary,e=O.holes,I=this.construct_voronoi_diagram_for_rounded_data(t,e),h=this.classify_edges(I,t,e,l).filter(function(t){return t.color()===JSPoly.colors.inner_primary}),v=!1,T=[],h=function(){var t,e,n;for(n=[],t=0,e=h.length;e>t;t++)u=h[t],this.equals(u.vertex0().x(),u.vertex1().x())&&this.equals(u.vertex0().y(),u.vertex1().y())||n.push(u);return n}.call(this),p=new Set(h);p.size>0;){for(d=0,x=T.length;x>d;d++)b=T[d],p["delete"](b.twin());if(0===p.size)break;for(a=p.values(),c=a.next(),u=c.value;!c.done;){for(y=c.value,M=y.prev();null!=M&&M.is_secondary()&&M!==y;)M=M.twin().prev();if(!p.has(M)){u=y;break}c=a.next()}for(;p.has(u);){for(T.push(u),_=u.next(),E=u;null!=_&&_.is_secondary()&&E!==_;)_=_.twin().next();p["delete"](u),u=_}}for(f=T.filter(function(t){var e;return e=JSPoly.get_cells_angle(t),null!=e&&e>r?!1:!0}),q=[],w=0,g=f.length;g>w;w++)if(u=f[w],u.color()===this.colors.inner_primary){if(l.isInvalidPrimaryEdge(u)||l.isNaNEdge(u))return this.dump(t,e,"Medial axis generation failed: found an edge either invalid primary or values containing NaN \n"),[];if(!(this.equals(u.vertex0().x(),u.vertex1().x())&&this.equals(u.vertex0().y(),u.vertex1().y())||(S=this.create_output_segments(u,I,q,m,R,n,i,o))))return this.dump(t,e,"Medial axis generation failed: invalid edge found, the edge should be either curved or linear \n"),[]}return q}},"undefined"!=typeof module&&null!==module&&(module.exports={jspoly:this.JSPoly})}).call(this);