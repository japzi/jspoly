/*
JSPoly 
This is a Javascript translation of the Boost Polygon Library written in C++.
For 128-bit big integer support this library uses JSBN library from Tom Wu.

Author  : Ruwan J Egodagamage (japzi)
Version : 1.0.1
Date    : 3/22/2018
License : Boost Software License - Version 1.0 - August 17th, 2003

Contributors : rodovich, ahinz, gensym, nevernormal1

*/

/*
THE BOOST.POLYGON LIBRARY 
Version : 1_64_0

Boost Software License - Version 1.0 - August 17th, 2003

Permission is hereby granted, free of charge, to any person or organization
obtaining a copy of the software and accompanying documentation covered by
this license (the "Software") to use, reproduce, display, distribute,
execute, and transmit the Software, and to prepare derivative works of the
Software, and to permit third-parties to whom the Software is furnished to
do so, all subject to the following:

The copyright notices in the Software and this entire statement, including
the above license grant, this restriction and the following disclaimer,
must be included in all copies of the Software, in whole or in part, and
all derivative works of the Software, unless such copies or derivative
works are solely in the form of machine-executable object code generated by
a source language processor.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT
SHALL THE COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE
FOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN CONTRACT, TORT OR OTHERWISE,
ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
DEALINGS IN THE SOFTWARE.

*/

/*
The jsbn library is a fast, portable implementation of large-number math in pure JavaScript

Copyright (c) 2003-2005  Tom Wu
All Rights Reserved.

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS-IS" AND WITHOUT WARRANTY OF ANY KIND, 
EXPRESS, IMPLIED OR OTHERWISE, INCLUDING WITHOUT LIMITATION, ANY 
WARRANTY OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.  

IN NO EVENT SHALL TOM WU BE LIABLE FOR ANY SPECIAL, INCIDENTAL,
INDIRECT OR CONSEQUENTIAL DAMAGES OF ANY KIND, OR ANY DAMAGES WHATSOEVER
RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER OR NOT ADVISED OF
THE POSSIBILITY OF DAMAGE, AND ON ANY THEORY OF LIABILITY, ARISING OUT
OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

In addition, the following condition applies:

All redistributions must retain an intact copy of this copyright notice
and disclaimer.
*/

function BigInteger(t,i,r){null!=t&&("number"==typeof t?this.fromNumber(t,i,r):null==i&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,i))}function nbi(){return new BigInteger(null)}function am1(t,i,r,e,n,o){for(;--o>=0;){var s=i*this[t++]+r[e]+n;n=Math.floor(s/67108864),r[e++]=67108863&s}return n}function am2(t,i,r,e,n,o){for(var s=32767&i,h=i>>15;--o>=0;){var p=32767&this[t],u=this[t++]>>15,a=h*p+u*s;p=s*p+((32767&a)<<15)+r[e]+(1073741823&n),n=(p>>>30)+(a>>>15)+h*u+(n>>>30),r[e++]=1073741823&p}return n}function am3(t,i,r,e,n,o){for(var s=16383&i,h=i>>14;--o>=0;){var p=16383&this[t],u=this[t++]>>14,a=h*p+u*s;p=s*p+((16383&a)<<14)+r[e]+n,n=(p>>28)+(a>>14)+h*u,r[e++]=268435455&p}return n}function int2char(t){return BI_RM.charAt(t)}function intAt(t,i){var r=BI_RC[t.charCodeAt(i)];return null==r?-1:r}function bnpCopyTo(t){for(var i=this.t-1;i>=0;--i)t[i]=this[i];t.t=this.t,t.s=this.s}function bnpFromInt(t){this.t=1,this.s=0>t?-1:0,t>0?this[0]=t:-1>t?this[0]=t+this.DV:this.t=0}function nbv(t){var i=nbi();return i.fromInt(t),i}function bnpFromString(t,i){var r;if(16==i)r=4;else if(8==i)r=3;else if(256==i)r=8;else if(2==i)r=1;else if(32==i)r=5;else{if(4!=i)return void this.fromRadix(t,i);r=2}this.t=0,this.s=0;for(var e=t.length,n=!1,o=0;--e>=0;){var s=8==r?255&t[e]:intAt(t,e);0>s?"-"==t.charAt(e)&&(n=!0):(n=!1,0==o?this[this.t++]=s:o+r>this.DB?(this[this.t-1]|=(s&(1<<this.DB-o)-1)<<o,this[this.t++]=s>>this.DB-o):this[this.t-1]|=s<<o,o+=r,o>=this.DB&&(o-=this.DB))}8==r&&0!=(128&t[0])&&(this.s=-1,o>0&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),n&&BigInteger.ZERO.subTo(this,this)}function bnpClamp(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t}function bnToString(t){if(this.s<0)return"-"+this.negate().toString(t);var i;if(16==t)i=4;else if(8==t)i=3;else if(2==t)i=1;else if(32==t)i=5;else{if(4!=t)return this.toRadix(t);i=2}var r,e=(1<<i)-1,n=!1,o="",s=this.t,h=this.DB-s*this.DB%i;if(s-->0)for(h<this.DB&&(r=this[s]>>h)>0&&(n=!0,o=int2char(r));s>=0;)i>h?(r=(this[s]&(1<<h)-1)<<i-h,r|=this[--s]>>(h+=this.DB-i)):(r=this[s]>>(h-=i)&e,0>=h&&(h+=this.DB,--s)),r>0&&(n=!0),n&&(o+=int2char(r));return n?o:"0"}function bnNegate(){var t=nbi();return BigInteger.ZERO.subTo(this,t),t}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(t){var i=this.s-t.s;if(0!=i)return i;var r=this.t;if(i=r-t.t,0!=i)return this.s<0?-i:i;for(;--r>=0;)if(0!=(i=this[r]-t[r]))return i;return 0}function nbits(t){var i,r=1;return 0!=(i=t>>>16)&&(t=i,r+=16),0!=(i=t>>8)&&(t=i,r+=8),0!=(i=t>>4)&&(t=i,r+=4),0!=(i=t>>2)&&(t=i,r+=2),0!=(i=t>>1)&&(t=i,r+=1),r}function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(t,i){var r;for(r=this.t-1;r>=0;--r)i[r+t]=this[r];for(r=t-1;r>=0;--r)i[r]=0;i.t=this.t+t,i.s=this.s}function bnpDRShiftTo(t,i){for(var r=t;r<this.t;++r)i[r-t]=this[r];i.t=Math.max(this.t-t,0),i.s=this.s}function bnpLShiftTo(t,i){var r,e=t%this.DB,n=this.DB-e,o=(1<<n)-1,s=Math.floor(t/this.DB),h=this.s<<e&this.DM;for(r=this.t-1;r>=0;--r)i[r+s+1]=this[r]>>n|h,h=(this[r]&o)<<e;for(r=s-1;r>=0;--r)i[r]=0;i[s]=h,i.t=this.t+s+1,i.s=this.s,i.clamp()}function bnpRShiftTo(t,i){i.s=this.s;var r=Math.floor(t/this.DB);if(r>=this.t)return void(i.t=0);var e=t%this.DB,n=this.DB-e,o=(1<<e)-1;i[0]=this[r]>>e;for(var s=r+1;s<this.t;++s)i[s-r-1]|=(this[s]&o)<<n,i[s-r]=this[s]>>e;e>0&&(i[this.t-r-1]|=(this.s&o)<<n),i.t=this.t-r,i.clamp()}function bnpSubTo(t,i){for(var r=0,e=0,n=Math.min(t.t,this.t);n>r;)e+=this[r]-t[r],i[r++]=e&this.DM,e>>=this.DB;if(t.t<this.t){for(e-=t.s;r<this.t;)e+=this[r],i[r++]=e&this.DM,e>>=this.DB;e+=this.s}else{for(e+=this.s;r<t.t;)e-=t[r],i[r++]=e&this.DM,e>>=this.DB;e-=t.s}i.s=0>e?-1:0,-1>e?i[r++]=this.DV+e:e>0&&(i[r++]=e),i.t=r,i.clamp()}function bnpMultiplyTo(t,i){var r=this.abs(),e=t.abs(),n=r.t;for(i.t=n+e.t;--n>=0;)i[n]=0;for(n=0;n<e.t;++n)i[n+r.t]=r.am(0,e[n],i,n,0,r.t);i.s=0,i.clamp(),this.s!=t.s&&BigInteger.ZERO.subTo(i,i)}function bnpSquareTo(t){for(var i=this.abs(),r=t.t=2*i.t;--r>=0;)t[r]=0;for(r=0;r<i.t-1;++r){var e=i.am(r,i[r],t,2*r,0,1);(t[r+i.t]+=i.am(r+1,2*i[r],t,2*r+1,e,i.t-r-1))>=i.DV&&(t[r+i.t]-=i.DV,t[r+i.t+1]=1)}t.t>0&&(t[t.t-1]+=i.am(r,i[r],t,2*r,0,1)),t.s=0,t.clamp()}function bnpDivRemTo(t,i,r){var e=t.abs();if(!(e.t<=0)){var n=this.abs();if(n.t<e.t)return null!=i&&i.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=nbi());var o=nbi(),s=this.s,h=t.s,p=this.DB-nbits(e[e.t-1]);p>0?(e.lShiftTo(p,o),n.lShiftTo(p,r)):(e.copyTo(o),n.copyTo(r));var u=o.t,a=o[u-1];if(0!=a){var f=a*(1<<this.F1)+(u>1?o[u-2]>>this.F2:0),b=this.FV/f,g=(1<<this.F1)/f,l=1<<this.F2,m=r.t,c=m-u,v=null==i?nbi():i;for(o.dlShiftTo(c,v),r.compareTo(v)>=0&&(r[r.t++]=1,r.subTo(v,r)),BigInteger.ONE.dlShiftTo(u,v),v.subTo(o,o);o.t<u;)o[o.t++]=0;for(;--c>=0;){var B=r[--m]==a?this.DM:Math.floor(r[m]*b+(r[m-1]+l)*g);if((r[m]+=o.am(0,B,r,c,0,u))<B)for(o.dlShiftTo(c,v),r.subTo(v,r);r[m]<--B;)r.subTo(v,r)}null!=i&&(r.drShiftTo(u,i),s!=h&&BigInteger.ZERO.subTo(i,i)),r.t=u,r.clamp(),p>0&&r.rShiftTo(p,r),0>s&&BigInteger.ZERO.subTo(r,r)}}}function bnMod(t){var i=nbi();return this.abs().divRemTo(t,null,i),this.s<0&&i.compareTo(BigInteger.ZERO)>0&&t.subTo(i,i),i}function Classic(t){this.m=t}function cConvert(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t}function cRevert(t){return t}function cReduce(t){t.divRemTo(this.m,null,t)}function cMulTo(t,i,r){t.multiplyTo(i,r),this.reduce(r)}function cSqrTo(t,i){t.squareTo(i),this.reduce(i)}function bnpInvDigit(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var i=3&t;return i=i*(2-(15&t)*i)&15,i=i*(2-(255&t)*i)&255,i=i*(2-((65535&t)*i&65535))&65535,i=i*(2-t*i%this.DV)%this.DV,i>0?this.DV-i:-i}function Montgomery(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function montConvert(t){var i=nbi();return t.abs().dlShiftTo(this.m.t,i),i.divRemTo(this.m,null,i),t.s<0&&i.compareTo(BigInteger.ZERO)>0&&this.m.subTo(i,i),i}function montRevert(t){var i=nbi();return t.copyTo(i),this.reduce(i),i}function montReduce(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var i=0;i<this.m.t;++i){var r=32767&t[i],e=r*this.mpl+((r*this.mph+(t[i]>>15)*this.mpl&this.um)<<15)&t.DM;for(r=i+this.m.t,t[r]+=this.m.am(0,e,t,i,0,this.m.t);t[r]>=t.DV;)t[r]-=t.DV,t[++r]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function montSqrTo(t,i){t.squareTo(i),this.reduce(i)}function montMulTo(t,i,r){t.multiplyTo(i,r),this.reduce(r)}function bnpIsEven(){return 0==(this.t>0?1&this[0]:this.s)}function bnpExp(t,i){if(t>4294967295||1>t)return BigInteger.ONE;var r=nbi(),e=nbi(),n=i.convert(this),o=nbits(t)-1;for(n.copyTo(r);--o>=0;)if(i.sqrTo(r,e),(t&1<<o)>0)i.mulTo(e,n,r);else{var s=r;r=e,e=s}return i.revert(r)}function bnModPowInt(t,i){var r;return r=256>t||i.isEven()?new Classic(i):new Montgomery(i),this.exp(t,r)}function bnClone(){var t=nbi();return this.copyTo(t),t}function bnIntValue(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnByteValue(){return 0==this.t?this.s:this[0]<<24>>24}function bnShortValue(){return 0==this.t?this.s:this[0]<<16>>16}function bnpChunkSize(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function bnSigNum(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function bnpToRadix(t){if(null==t&&(t=10),0==this.signum()||2>t||t>36)return"0";var i=this.chunkSize(t),r=Math.pow(t,i),e=nbv(r),n=nbi(),o=nbi(),s="";for(this.divRemTo(e,n,o);n.signum()>0;)s=(r+o.intValue()).toString(t).substr(1)+s,n.divRemTo(e,n,o);return o.intValue().toString(t)+s}function bnpFromRadix(t,i){this.fromInt(0),null==i&&(i=10);for(var r=this.chunkSize(i),e=Math.pow(i,r),n=!1,o=0,s=0,h=0;h<t.length;++h){var p=intAt(t,h);0>p?"-"==t.charAt(h)&&0==this.signum()&&(n=!0):(s=i*s+p,++o>=r&&(this.dMultiply(e),this.dAddOffset(s,0),o=0,s=0))}o>0&&(this.dMultiply(Math.pow(i,o)),this.dAddOffset(s,0)),n&&BigInteger.ZERO.subTo(this,this)}function bnpFromNumber(t,i,r){if("number"==typeof i)if(2>t)this.fromInt(1);else for(this.fromNumber(t,r),this.testBit(t-1)||this.bitwiseTo(BigInteger.ONE.shiftLeft(t-1),op_or,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(i);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(BigInteger.ONE.shiftLeft(t-1),this);else{var e=new Array,n=7&t;e.length=(t>>3)+1,i.nextBytes(e),n>0?e[0]&=(1<<n)-1:e[0]=0,this.fromString(e,256)}}function bnToByteArray(){var t=this.t,i=new Array;i[0]=this.s;var r,e=this.DB-t*this.DB%8,n=0;if(t-->0)for(e<this.DB&&(r=this[t]>>e)!=(this.s&this.DM)>>e&&(i[n++]=r|this.s<<this.DB-e);t>=0;)8>e?(r=(this[t]&(1<<e)-1)<<8-e,r|=this[--t]>>(e+=this.DB-8)):(r=this[t]>>(e-=8)&255,0>=e&&(e+=this.DB,--t)),0!=(128&r)&&(r|=-256),0==n&&(128&this.s)!=(128&r)&&++n,(n>0||r!=this.s)&&(i[n++]=r);return i}function bnEquals(t){return 0==this.compareTo(t)}function bnMin(t){return this.compareTo(t)<0?this:t}function bnMax(t){return this.compareTo(t)>0?this:t}function bnpBitwiseTo(t,i,r){var e,n,o=Math.min(t.t,this.t);for(e=0;o>e;++e)r[e]=i(this[e],t[e]);if(t.t<this.t){for(n=t.s&this.DM,e=o;e<this.t;++e)r[e]=i(this[e],n);r.t=this.t}else{for(n=this.s&this.DM,e=o;e<t.t;++e)r[e]=i(n,t[e]);r.t=t.t}r.s=i(this.s,t.s),r.clamp()}function op_and(t,i){return t&i}function bnAnd(t){var i=nbi();return this.bitwiseTo(t,op_and,i),i}function op_or(t,i){return t|i}function bnOr(t){var i=nbi();return this.bitwiseTo(t,op_or,i),i}function op_xor(t,i){return t^i}function bnXor(t){var i=nbi();return this.bitwiseTo(t,op_xor,i),i}function op_andnot(t,i){return t&~i}function bnAndNot(t){var i=nbi();return this.bitwiseTo(t,op_andnot,i),i}function bnNot(){for(var t=nbi(),i=0;i<this.t;++i)t[i]=this.DM&~this[i];return t.t=this.t,t.s=~this.s,t}function bnShiftLeft(t){var i=nbi();return 0>t?this.rShiftTo(-t,i):this.lShiftTo(t,i),i}function bnShiftRight(t){var i=nbi();return 0>t?this.lShiftTo(-t,i):this.rShiftTo(t,i),i}function lbit(t){if(0==t)return-1;var i=0;return 0==(65535&t)&&(t>>=16,i+=16),0==(255&t)&&(t>>=8,i+=8),0==(15&t)&&(t>>=4,i+=4),0==(3&t)&&(t>>=2,i+=2),0==(1&t)&&++i,i}function bnGetLowestSetBit(){for(var t=0;t<this.t;++t)if(0!=this[t])return t*this.DB+lbit(this[t]);return this.s<0?this.t*this.DB:-1}function cbit(t){for(var i=0;0!=t;)t&=t-1,++i;return i}function bnBitCount(){for(var t=0,i=this.s&this.DM,r=0;r<this.t;++r)t+=cbit(this[r]^i);return t}function bnTestBit(t){var i=Math.floor(t/this.DB);return i>=this.t?0!=this.s:0!=(this[i]&1<<t%this.DB)}function bnpChangeBit(t,i){var r=BigInteger.ONE.shiftLeft(t);return this.bitwiseTo(r,i,r),r}function bnSetBit(t){return this.changeBit(t,op_or)}function bnClearBit(t){return this.changeBit(t,op_andnot)}function bnFlipBit(t){return this.changeBit(t,op_xor)}function bnpAddTo(t,i){for(var r=0,e=0,n=Math.min(t.t,this.t);n>r;)e+=this[r]+t[r],i[r++]=e&this.DM,e>>=this.DB;if(t.t<this.t){for(e+=t.s;r<this.t;)e+=this[r],i[r++]=e&this.DM,e>>=this.DB;e+=this.s}else{for(e+=this.s;r<t.t;)e+=t[r],i[r++]=e&this.DM,e>>=this.DB;e+=t.s}i.s=0>e?-1:0,e>0?i[r++]=e:-1>e&&(i[r++]=this.DV+e),i.t=r,i.clamp()}function bnAdd(t){var i=nbi();return this.addTo(t,i),i}function bnSubtract(t){var i=nbi();return this.subTo(t,i),i}function bnMultiply(t){var i=nbi();return this.multiplyTo(t,i),i}function bnSquare(){var t=nbi();return this.squareTo(t),t}function bnDivide(t){var i=nbi();return this.divRemTo(t,i,null),i}function bnRemainder(t){var i=nbi();return this.divRemTo(t,null,i),i}function bnDivideAndRemainder(t){var i=nbi(),r=nbi();return this.divRemTo(t,i,r),new Array(i,r)}function bnpDMultiply(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function bnpDAddOffset(t,i){if(0!=t){for(;this.t<=i;)this[this.t++]=0;for(this[i]+=t;this[i]>=this.DV;)this[i]-=this.DV,++i>=this.t&&(this[this.t++]=0),++this[i]}}function NullExp(){}function nNop(t){return t}function nMulTo(t,i,r){t.multiplyTo(i,r)}function nSqrTo(t,i){t.squareTo(i)}function bnPow(t){return this.exp(t,new NullExp)}function bnpMultiplyLowerTo(t,i,r){var e=Math.min(this.t+t.t,i);for(r.s=0,r.t=e;e>0;)r[--e]=0;var n;for(n=r.t-this.t;n>e;++e)r[e+this.t]=this.am(0,t[e],r,e,0,this.t);for(n=Math.min(t.t,i);n>e;++e)this.am(0,t[e],r,e,0,i-e);r.clamp()}function bnpMultiplyUpperTo(t,i,r){--i;var e=r.t=this.t+t.t-i;for(r.s=0;--e>=0;)r[e]=0;for(e=Math.max(i-this.t,0);e<t.t;++e)r[this.t+e-i]=this.am(i-e,t[e],r,0,0,this.t+e-i);r.clamp(),r.drShiftTo(1,r)}function Barrett(t){this.r2=nbi(),this.q3=nbi(),BigInteger.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function barrettConvert(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var i=nbi();return t.copyTo(i),this.reduce(i),i}function barrettRevert(t){return t}function barrettReduce(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)}function barrettSqrTo(t,i){t.squareTo(i),this.reduce(i)}function barrettMulTo(t,i,r){t.multiplyTo(i,r),this.reduce(r)}function bnModPow(t,i){var r,e,n=t.bitLength(),o=nbv(1);if(0>=n)return o;r=18>n?1:48>n?3:144>n?4:768>n?5:6,e=8>n?new Classic(i):i.isEven()?new Barrett(i):new Montgomery(i);var s=new Array,h=3,p=r-1,u=(1<<r)-1;if(s[1]=e.convert(this),r>1){var a=nbi();for(e.sqrTo(s[1],a);u>=h;)s[h]=nbi(),e.mulTo(a,s[h-2],s[h]),h+=2}var f,b,g=t.t-1,l=!0,m=nbi();for(n=nbits(t[g])-1;g>=0;){for(n>=p?f=t[g]>>n-p&u:(f=(t[g]&(1<<n+1)-1)<<p-n,g>0&&(f|=t[g-1]>>this.DB+n-p)),h=r;0==(1&f);)f>>=1,--h;if((n-=h)<0&&(n+=this.DB,--g),l)s[f].copyTo(o),l=!1;else{for(;h>1;)e.sqrTo(o,m),e.sqrTo(m,o),h-=2;h>0?e.sqrTo(o,m):(b=o,o=m,m=b),e.mulTo(m,s[f],o)}for(;g>=0&&0==(t[g]&1<<n);)e.sqrTo(o,m),b=o,o=m,m=b,--n<0&&(n=this.DB-1,--g)}return e.revert(o)}function bnGCD(t){var i=this.s<0?this.negate():this.clone(),r=t.s<0?t.negate():t.clone();if(i.compareTo(r)<0){var e=i;i=r,r=e}var n=i.getLowestSetBit(),o=r.getLowestSetBit();if(0>o)return i;for(o>n&&(o=n),o>0&&(i.rShiftTo(o,i),r.rShiftTo(o,r));i.signum()>0;)(n=i.getLowestSetBit())>0&&i.rShiftTo(n,i),(n=r.getLowestSetBit())>0&&r.rShiftTo(n,r),i.compareTo(r)>=0?(i.subTo(r,i),i.rShiftTo(1,i)):(r.subTo(i,r),r.rShiftTo(1,r));return o>0&&r.lShiftTo(o,r),r}function bnpModInt(t){if(0>=t)return 0;var i=this.DV%t,r=this.s<0?t-1:0;if(this.t>0)if(0==i)r=this[0]%t;else for(var e=this.t-1;e>=0;--e)r=(i*r+this[e])%t;return r}function bnModInverse(t){var i=t.isEven();if(this.isEven()&&i||0==t.signum())return BigInteger.ZERO;for(var r=t.clone(),e=this.clone(),n=nbv(1),o=nbv(0),s=nbv(0),h=nbv(1);0!=r.signum();){for(;r.isEven();)r.rShiftTo(1,r),i?(n.isEven()&&o.isEven()||(n.addTo(this,n),o.subTo(t,o)),n.rShiftTo(1,n)):o.isEven()||o.subTo(t,o),o.rShiftTo(1,o);for(;e.isEven();)e.rShiftTo(1,e),i?(s.isEven()&&h.isEven()||(s.addTo(this,s),h.subTo(t,h)),s.rShiftTo(1,s)):h.isEven()||h.subTo(t,h),h.rShiftTo(1,h);r.compareTo(e)>=0?(r.subTo(e,r),i&&n.subTo(s,n),o.subTo(h,o)):(e.subTo(r,e),i&&s.subTo(n,s),h.subTo(o,h))}return 0!=e.compareTo(BigInteger.ONE)?BigInteger.ZERO:h.compareTo(t)>=0?h.subtract(t):h.signum()<0?(h.addTo(t,h),h.signum()<0?h.add(t):h):h}function bnIsProbablePrime(t){var i,r=this.abs();if(1==r.t&&r[0]<=lowprimes[lowprimes.length-1]){for(i=0;i<lowprimes.length;++i)if(r[0]==lowprimes[i])return!0;return!1}if(r.isEven())return!1;for(i=1;i<lowprimes.length;){for(var e=lowprimes[i],n=i+1;n<lowprimes.length&&lplim>e;)e*=lowprimes[n++];for(e=r.modInt(e);n>i;)if(e%lowprimes[i++]==0)return!1}return r.millerRabin(t)}function bnpMillerRabin(t){var i=this.subtract(BigInteger.ONE),r=i.getLowestSetBit();if(0>=r)return!1;var e=i.shiftRight(r);t=t+1>>1,t>lowprimes.length&&(t=lowprimes.length);for(var n=nbi(),o=0;t>o;++o){n.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var s=n.modPow(e,this);if(0!=s.compareTo(BigInteger.ONE)&&0!=s.compareTo(i)){for(var h=1;h++<r&&0!=s.compareTo(i);)if(s=s.modPowInt(2,this),0==s.compareTo(BigInteger.ONE))return!1;if(0!=s.compareTo(i))return!1}}return!0}var isNode=!1;"undefined"!=typeof module&&module.exports&&(isNode=!0);var navigatorAppName;if(isNode){var nav="chrome";navigatorAppName="Netscape"}else{var nav=navigator.userAgent.toString().toLowerCase();navigatorAppName=navigator.appName}var dbits,canary=0xdeadbeefcafe,j_lm=15715070==(16777215&canary);j_lm&&"Microsoft Internet Explorer"==navigatorAppName?(BigInteger.prototype.am=am2,dbits=30):j_lm&&"Netscape"!=navigatorAppName?(BigInteger.prototype.am=am1,dbits=26):(BigInteger.prototype.am=am3,dbits=28),BigInteger.prototype.DB=dbits,BigInteger.prototype.DM=(1<<dbits)-1,BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP),BigInteger.prototype.F1=BI_FP-dbits,BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=new Array,rr,vv;for(rr="0".charCodeAt(0),vv=0;9>=vv;++vv)BI_RC[rr++]=vv;for(rr="a".charCodeAt(0),vv=10;36>vv;++vv)BI_RC[rr++]=vv;for(rr="A".charCodeAt(0),vv=10;36>vv;++vv)BI_RC[rr++]=vv;Classic.prototype.convert=cConvert,Classic.prototype.revert=cRevert,Classic.prototype.reduce=cReduce,Classic.prototype.mulTo=cMulTo,Classic.prototype.sqrTo=cSqrTo,Montgomery.prototype.convert=montConvert,Montgomery.prototype.revert=montRevert,Montgomery.prototype.reduce=montReduce,Montgomery.prototype.mulTo=montMulTo,Montgomery.prototype.sqrTo=montSqrTo,BigInteger.prototype.copyTo=bnpCopyTo,BigInteger.prototype.fromInt=bnpFromInt,BigInteger.prototype.fromString=bnpFromString,BigInteger.prototype.clamp=bnpClamp,BigInteger.prototype.dlShiftTo=bnpDLShiftTo,BigInteger.prototype.drShiftTo=bnpDRShiftTo,BigInteger.prototype.lShiftTo=bnpLShiftTo,BigInteger.prototype.rShiftTo=bnpRShiftTo,BigInteger.prototype.subTo=bnpSubTo,BigInteger.prototype.multiplyTo=bnpMultiplyTo,BigInteger.prototype.squareTo=bnpSquareTo,BigInteger.prototype.divRemTo=bnpDivRemTo,BigInteger.prototype.invDigit=bnpInvDigit,BigInteger.prototype.isEven=bnpIsEven,BigInteger.prototype.exp=bnpExp,BigInteger.prototype.toString=bnToString,BigInteger.prototype.negate=bnNegate,BigInteger.prototype.abs=bnAbs,BigInteger.prototype.compareTo=bnCompareTo,BigInteger.prototype.bitLength=bnBitLength,BigInteger.prototype.mod=bnMod,BigInteger.prototype.modPowInt=bnModPowInt,BigInteger.ZERO=nbv(0),BigInteger.ONE=nbv(1),NullExp.prototype.convert=nNop,NullExp.prototype.revert=nNop,NullExp.prototype.mulTo=nMulTo,NullExp.prototype.sqrTo=nSqrTo,Barrett.prototype.convert=barrettConvert,Barrett.prototype.revert=barrettRevert,Barrett.prototype.reduce=barrettReduce,Barrett.prototype.mulTo=barrettMulTo,Barrett.prototype.sqrTo=barrettSqrTo;var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],lplim=(1<<26)/lowprimes[lowprimes.length-1];BigInteger.prototype.chunkSize=bnpChunkSize,BigInteger.prototype.toRadix=bnpToRadix,BigInteger.prototype.fromRadix=bnpFromRadix,BigInteger.prototype.fromNumber=bnpFromNumber,BigInteger.prototype.bitwiseTo=bnpBitwiseTo,BigInteger.prototype.changeBit=bnpChangeBit,BigInteger.prototype.addTo=bnpAddTo,BigInteger.prototype.dMultiply=bnpDMultiply,BigInteger.prototype.dAddOffset=bnpDAddOffset,BigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo,BigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo,BigInteger.prototype.modInt=bnpModInt,BigInteger.prototype.millerRabin=bnpMillerRabin,BigInteger.prototype.clone=bnClone,BigInteger.prototype.intValue=bnIntValue,BigInteger.prototype.byteValue=bnByteValue,BigInteger.prototype.shortValue=bnShortValue,BigInteger.prototype.signum=bnSigNum,BigInteger.prototype.toByteArray=bnToByteArray,BigInteger.prototype.equals=bnEquals,BigInteger.prototype.min=bnMin,BigInteger.prototype.max=bnMax,BigInteger.prototype.and=bnAnd,BigInteger.prototype.or=bnOr,BigInteger.prototype.xor=bnXor,BigInteger.prototype.andNot=bnAndNot,BigInteger.prototype.not=bnNot,BigInteger.prototype.shiftLeft=bnShiftLeft,BigInteger.prototype.shiftRight=bnShiftRight,BigInteger.prototype.getLowestSetBit=bnGetLowestSetBit,BigInteger.prototype.bitCount=bnBitCount,BigInteger.prototype.testBit=bnTestBit,BigInteger.prototype.setBit=bnSetBit,BigInteger.prototype.clearBit=bnClearBit,BigInteger.prototype.flipBit=bnFlipBit,BigInteger.prototype.add=bnAdd,BigInteger.prototype.subtract=bnSubtract,BigInteger.prototype.multiply=bnMultiply,BigInteger.prototype.divide=bnDivide,BigInteger.prototype.remainder=bnRemainder,BigInteger.prototype.divideAndRemainder=bnDivideAndRemainder,BigInteger.prototype.modPow=bnModPow,BigInteger.prototype.modInverse=bnModInverse,BigInteger.prototype.pow=bnPow,BigInteger.prototype.gcd=bnGCD,BigInteger.prototype.isProbablePrime=bnIsProbablePrime,BigInteger.prototype.square=bnSquare;(function(){var t,e,i,n,r,o,s,l,u,_,p,a,h,c,y,f,v,d,x,g,m,w,b,E,T,q,I,R,S,N,O,M,A,j,G,P,L,D,k,C,F,z,U,B,J,Y,H,V,W,K,Z,X,Q,$,tt,et,it,nt,rt,ot,st,lt,ut,_t,pt,at,ht,ct,yt,ft,vt,dt,xt,gt,mt,wt,bt,Et,Tt,qt,It,Rt,St,Nt,Ot,Mt,At,jt,Gt,Pt,Lt,Dt,kt,Ct,Ft,zt,Ut,Bt,Jt,Yt,Ht,Vt,Wt,Kt,Zt,Xt,Qt,$t,te,ee,ie,ne,re,oe,se,le,ue,_e,pe,ae,he=function(t,e){function i(){this.constructor=t}for(var n in e)ce.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},ce={}.hasOwnProperty;u=1,a=1e-5,c=0,y=1,A=0,M=1,O=2,S=8,N=9,R=3,I=31,z=function(t,e){return t>>R===e},g=0,f=1,x=0,q=1,s=0,l=1,T=0,h=1,m=0,b=1,v=0,P=1,L=0,p=1,j=2,w=3,E=2,_=4,G=5,K=0,X=1,ne=2,d=32,e=5,t=31,i=1,n=2,"undefined"!=typeof module&&null!==module&&(module.exports={EPSILON:a,GEOMETRY_CATEGORY_POINT:c,GEOMETRY_CATEGORY_SEGMENT:y,SOURCE_CATEGORY_SINGLE_POINT:A,SOURCE_CATEGORY_SEGMENT_START_POINT:M,SOURCE_CATEGORY_SEGMENT_END_POINT:O,SOURCE_CATEGORY_INITIAL_SEGMENT:S,SOURCE_CATEGORY_REVERSE_SEGMENT:N,SOURCE_CATEGORY_GEOMETRY_SHIFT:R,SOURCE_CATEGORY_BITMASK:I,belongs:z,LOW:g,HIGH:f,LEFT:x,RIGHT:q,CLOCKWISE:s,COUNTERCLOCKWISE:l,REVERSE:T,FORWARD:h,NEGATIVE:m,POSITIVE:b,HORIZONTAL:v,VERTICAL:P,WEST:L,EAST:p,SOUTH:j,NORTH:w,PROXIMAL:E,DOWN:_,UP:G,clockwise_winding:K,counterclockwise_winding:X,unknown_winding:ne,IS_INVERSE:d,BITS_SHIFT:e,BITS_MASK:t,BIT_IS_LINEAR:i,BIT_IS_PRIMARY:n}),null==u&&"undefined"!=typeof require&&null!==require&&(jt=require("./constants"),g=jt.LOW,v=jt.HORIZONTAL,L=jt.WEST),$=function(){function t(e){void 0!==e?"object"==typeof e?e instanceof t?this.val_=e.val_:e instanceof tt?this.val_=1&e.to_int():e instanceof et&&(this.val_=1&e.to_int()):"number"==typeof e&&(this.val_=e):this.val_=g}return t.prototype.val_=g,t.prototype.assign=function(t){this.val_=t.val_},t.prototype.equals=function(t){return Math.abs(this.val_-t.val_)<a},t.prototype.to_int=function(){return this.val_},t.prototype.backward=function(){return Math.abs(this.val_-g)<a?this.val_=f:this.val_=g,this},t.prototype.get_sign=function(){return 2*this.val_-1},t}(),Tt=function(){function t(e){void 0!==e?"object"==typeof e?e instanceof t?this.val_=e.val_:e instanceof tt&&(this.val_=e.to_int()>>1):"number"==typeof e&&(this.val_=e):this.val_=v}return t.prototype.val_=v,t.prototype.assign=function(t){this.val_=t.val_},t.prototype.equals=function(t){return Math.abs(this.val_-t.val_)<a},t.prototype.to_int=function(){return this.val_},t.prototype.turn_90=function(){Math.abs(this.val_-v)<a?this.val_=P:this.val_=v},t.prototype.get_perpendicular=function(){var e;return e=new t(this),e.turn_90(),e},t.prototype.get_direction=function(t){return new tt((val_<<1)+t.to_int())},t}(),tt=function(){function t(e){void 0!==e?"object"==typeof e?e instanceof t?this.val_=e.val_:e instanceof t&&(this.val_=1&e.to_int()):"number"==typeof e&&(this.val_=e):this.val_=L}return t.prototype.val_=L,t.prototype.assign=function(t){return this.val_=t.val_},t.prototype.equals=function(t){return Math.abs(this.val_-t.val_)<a},t.prototype.lessThan=function(t){return this.val_<t.val_},t.prototype.lessThanEqual=function(t){return this.val_<=t.val_},t.prototype.greaterThan=function(t){return this.val_>t.val_},t.prototype.greaterThanEqual=function(t){return this.val_>=t.val_},t.prototype.to_int=function(){return this.val_},t.prototype.backward=function(){var e;return e=new t,e.val_=1^this.val_,e},t.prototype.turn=function(e){var i;return i=new t,i.val_=3^this.val_^this.val_>>1^e.to_int(),i},t.prototype.left=function(){return this.turn(f)},t.prototype.right=function(){return this.turn(g)},t.prototype.is_positive=function(){return 1&this.val_},t.prototype.is_negative=function(){return!this.is_positive()},t.prototype.get_sign=function(){return(this.is_positive()<<1)-1},t}(),qt=function(){function t(e){void 0!==e?"object"==typeof e?e instanceof t?this.val_=e.val_:e instanceof Tt?this.val_=e.to_int():e instanceof tt?this.val_=e.to_int()>>1:e instanceof et&&(this.val_=e.to_int()>>1):"number"==typeof e&&(this.val_=e):this.val_=v}return t.prototype.val_=v,t.prototype.assign=function(t){this.val_=t.val_},t.prototype.equals=function(t){return Math.abs(this.val_-t.val_)<a},t.prototype.to_int=function(){return this.val_},t.prototype.get_direction=function(){throw new Error("orientation.get_direction, not implemented")},t}(),et=function(){function t(e){void 0!==e?"object"==typeof e?e instanceof t?this.val_=e.val_:e instanceof tt&&(this.val_=e.to_int()):"number"==typeof e&&(this.val_=e):this.val_=L}return t.prototype.val_=L,t.prototype.assign=function(t){this.val_=t.val_},t.prototype.equals=function(t){return Math.abs(this.val_-t.val_)<a},t.prototype.lessThan=function(t){return this.val_<t.val_},t.prototype.lessThanEqual=function(t){return this.val_<=t.val_},t.prototype.greaterThan=function(t){return this.val_>t.val_},t.prototype.greaterThanEqual=function(t){return this.val_>=t.val_},t.prototype.to_int=function(){return this.val_},t.prototype.backward=function(){return new t(1^this.val_)},t.prototype.is_positive=function(){return 1&this.val_},t.prototype.is_negative=function(){return!this.is_positive()},t.prototype.get_sign=function(){return(this.is_positive()<<1)-1},t}(),gt=function(){function t(t,e){null==e&&(e=null),this._owningList=t,this._value=e}return t.prototype.attr=[],t.prototype._owningList=null,t.prototype._prev=null,t.prototype._next=null,t.prototype._value=null,t.prototype.next=function(t){return void 0!==t?(this._next=t,this):this._next},t.prototype.prev=function(t){return void 0!==t?(this._prev=t,this):this._prev},t.prototype.owningList=function(t){return void 0!==t?(this._owningList=t,this):this._owningList},t.prototype.isFirst=function(){return null==this._prev},t.prototype.value=function(t){return void 0!==t?(this._value=t,this):this._value},t.prototype.clearConnections=function(){return this._prev=null,this._next=null,!0},t}(),xt=function(){function t(t,e,i){var n,r,o,s,l,u;if(null==t)return this._last=new gt(this),this;if(t instanceof Array){for(this._last=new gt(this),u=null!=e?e:0,n=null!=i?i:t.length,r=o=s=u,l=n;l>=s?l>o:o>l;r=l>=s?++o:--o)this.push(t[r]);return this}throw new Error("TODO: Implement create for these parameters")}return t.prototype._first=null,t.prototype._last=null,t.prototype._length=0,t.prototype.swap=function(t,e){var i,n,r,o;if(!this.contains(t)||!this.contains(e))throw new Error("items should belong to this list");if(t===this.end()||e===this.end())throw new Error("swapping reserved @end item is not allowed");n=t.prev(),i=t.next(),o=e.prev(),r=e.next(),t===o&&e===i?(t.prev(e),t.next(r),e.next(t),e.prev(n),null!=n&&n.next(e),null!=r&&r.prev(t)):t===r&&e===n?(t.next(e),t.prev(o),e.prev(t),e.next(i),null!=o&&o.next(t),null!=i&&i.prev(e)):(t.prev(o),e.next(i),t.next(r),e.prev(n),null!=n&&n.next(e),null!=i&&i.prev(e),null!=r&&r.prev(t),null!=o&&o.next(t)),null===t.prev()&&(this._first=t),null===e.prev()&&(this._first=e)},t.prototype.sort=function(t){var e,i,n;if(e=this.begin(),null!=e&&null!=e.next())for(;e!==this.end().prev();){for(i=e.next();i!==this.end();)t(e.value(),i.value())?i=i.next():(n=i.next(),this.swap(e,i),e=i,i=n);e=e.next()}},t.prototype.jsSort=function(t){var e,i,n,r,o,s,l,u;if(null!=this._first&&null!=this._first.next()){for(s=function(e,i){return t(e.value(),i.value())?-1:1},e=[],o=this.begin();o!==this.end();)e.push(o),o=o.next();for(e.sort(s),this._first=e[0],l=e[0],i=e[0],n=r=1,u=e.length;u>=1?u>r:r>u;n=u>=1?++r:--r)i=e[n],l._next=i,i._prev=l,l=i;i._next=this._last,this._last._prev=i}},t.prototype.print=function(){var t,e;for(t=this.begin(),e="[";t!==this.end();)e+=JSON.stringify(t.value()),t=t.next(),e+=t!==this.end()?", \n":"\n";e+="]",console.log(e)},t.prototype.to_json=function(){return{TODO:"list"}},t.prototype.unique=function(e){var i,n,r,o;if(0===this._length)return null;for(r=new t,o=new t,r.push(this.end().prev().value()),n=this.end().prev().value(),i=this.end().prev().prev();null!==i;)e(n,i.value())||(r.push(i.value()),n=i.value()),i=i.prev();for(i=r.end().prev();null!==i;)o.push(i.value()),i=i.prev();return o},t.prototype.uniqueWithTieBreaker=function(e,i){var n,r,o,s;if(0===this._length)return null;for(s=new t,r=this._first.value(),o=[this._first.value()],n=this._first.next();n!==this._last;)e(r,n.value())?o.push(n.value()):(s.push(o.sort(i)[0]),r=n.value(),o=[r]),n=n.next();return s.push(o.sort(i)[0]),s},t.prototype.clear=function(){return this._first=null,this._length=0},t.prototype.contains=function(t){return null!=t&&t.owningList()===this},t.prototype.erase=function(t){var e,i;if(null!=t&&!this.contains(t))throw new Error("item is null or not part of this list");return i=t.prev(),e=t.next(),null!=e&&e.prev(i),null!=i&&i.next(e),null==i&&(this._first=e),t.clearConnections(),t.owningList(null),this._length--,null},t.prototype.insert=function(t,e){var i,n;if(null!=t&&!this.contains(t))throw new Error("item1 is null or not part of this list");return e instanceof gt?(n=this.end().prev(),i=this.end(),null!=t&&(n=t.prev(),i=t),null!=e&&(e.next(i),e.prev(n),null!=i&&i.prev(e),null!=n&&n.next(e),null==n&&(this._first=e),this._length++),e):this.insert(t,new gt(this,e))},t.prototype.push=function(t){return this.insert(null,t)},t.prototype.begin=function(){return this._first},t.prototype.beginValue=function(){if(null!=this._first)return this._first.value();throw new Error("List is empty")},t.prototype.end=function(){return this._last},t.prototype.size=function(){return this._length},t.prototype.empty=function(){return this._length<=0},t.prototype.concat=function(t){throw new Error("List concat is not implemented")},t.prototype.at=function(t){var e,i;for(i=this.begin(),e=0;i!==this.end&&e<this._length;){if(e===t)return i;e++,i=i.next()}throw new Error("Index out of bound")},t}(),D=function(){function t(t){var e;if(null==(null!=t?t.strategy:void 0))throw"Must pass options.strategy, a strategy";if(null==(null!=t?t.comparator:void 0))throw"Must pass options.comparator, a comparator";this.priv=new t.strategy(t),this.length=(null!=t&&null!=(e=t.initialValues)?e.length:void 0)||0}return t.prototype.queue=function(t){return this.length++,void this.priv.queue(t)},t.prototype.dequeue=function(t){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},t.prototype.peek=function(t){if(!this.length)throw"Empty queue";return this.priv.peek()},t.prototype.clear=function(){return this.length=0,this.priv.clear()},t.prototype.empty=function(){return 0===this.length},t.prototype.print=function(){return this.priv.print()},t.prototype.to_json=function(){return this.priv.to_json()},t}(),U=function(t,e,i){var n,r,o;for(r=0,n=t.length;n>r;)o=r+n>>>1,i(t[o],e)?r=o+1:n=o;return r},k=function(){function t(t){var e;this.options=t,this.comparator=this.options.comparator,this.data=(null!=(e=this.options.initialValues)?e.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return t.prototype.queue=function(t){var e;return e=U(this.data,t,this.comparator),void this.data.splice(e,0,t)},t.prototype.dequeue=function(){return this.data.pop()},t.prototype.peek=function(){return this.data[this.data.length-1]},t.prototype.clear=function(){return void(this.data.length=0)},t.prototype.print=function(){var t,e;for(t=this.data.length-1,e="";t>=0;)null!=this.data[t].value&&null!=this.data[t].value().first&&null!=this.data[t].value().first.print&&(e+=this.data[t].value().first.print()+"\n"),t--;return e},t.prototype.to_json=function(){var t,e;for(e=[],t=this.data.length-1;t>=0;)null!=this.data[t].value&&null!=this.data[t].value().first&&null!=this.data[t].value().first.to_json&&e.push(this.data[t].value().first.to_json()),t--;return e},t}(),Mt=function(t){function e(t){t||(t={}),t.strategy||(t.strategy=k),t.comparator||(t.comparator=function(t,e){return(t||0)-(e||0)}),e.__super__.constructor.call(this,t)}return he(e,t),e}(D),Et=function(){function t(t){if(this.c_list_=new xt,this.c_=new Mt({comparator:function(e,i){return t(e.value(),i.value())}}),null==t)throw"comparator is not provided for ordered queue"}return t.prototype.c_list_=null,t.prototype.c_=null,t.prototype.empty=function(){return this.c_.empty()},t.prototype.top=function(){return this.c_.peek().value()},t.prototype.pop=function(){var t;return t=this.c_.peek(),this.c_.dequeue(),this.c_list_.erase(t)},t.prototype.push=function(t){return this.c_list_.push(t),this.c_.queue(this.c_list_.end().prev()),this.c_list_.end().prev().value()},t.prototype.clear=function(){return this.c_.clear(),this.c_list_.clear()},t.prototype.size=function(){return this.c_list_.size()},t.prototype.print=function(){return this.c_.print()},t.prototype.to_json=function(){return this.c_.to_json()},t}(),bt=function(){function t(t,e,i){null==e&&(e=null),null==i&&(i=null),this._owningMap=t,this._key=e,this._value=i}return t.prototype.attr=[],t.prototype._owningMap=null,t.prototype._prev=null,t.prototype._next=null,t.prototype._key=null,t.prototype._value=null,t.prototype.next=function(t){return void 0!==t?(this._next=t,this):this._next},t.prototype.prev=function(t){return void 0!==t?(this._prev=t,this):this._prev},t.prototype.owningMap=function(t){return void 0!==t?(this._owningMap=t,this):this._owningMap},t.prototype.isFirst=function(){return null==this._prev},t.prototype.key=function(t){return void 0!==t?(this._key=t,this):this._key},t.prototype.value=function(t){return void 0!==t?(this._value=t,this):this._value},t.prototype.clearConnections=function(){return this._prev=null,this._next=null,!0},t}(),wt=function(){function t(t){if(this._comparator=t,null==t)throw new Error("comparator should be defined for the map");this._last=new bt(this)}return t.prototype._first=null,t.prototype._last=null,t.prototype._length=0,t.prototype.insertBefore=function(t,e){var i,n;return n=this._last.prev(),i=this._last,null!=t&&(n=t.prev(),i=t),e.next(i),e.prev(n),null!=i&&i.prev(e),null!=n&&n.next(e),null==n&&(this._first=e),this._length++,e},t.prototype.insert=function(t,e){var i,n,r,o;if(t instanceof bt){for(n=t,i=this.begin();i!==this.end()&&null!==i;){if(n.key()===i.key())return i.value(n.value()),i;if(this._comparator(n.key(),i.key()))return this.insertBefore(i,n);i=i.next()}return this.insertBefore(null,n)}return r=t,o=e,this.insert(new bt(this,r,o))},t.prototype.lowerBound=function(t){var e;for(e=this.begin();e!==this.end();){if(!this._comparator(e.key(),t))return e;e=e.next()}return this.end()},t.prototype.swap=function(t,e){var i,n,r,o;if(!this.contains(t)||!this.contains(e))throw new Error("items should belong to this list");if(t===this.end()||e===this.end())throw new Error("swapping reserved @end item is not allowed");n=t.prev(),i=t.next(),o=e.prev(),r=e.next(),t===o&&e===i?(t.prev(e),t.next(r),e.next(t),e.prev(n),null!=n&&n.next(e),null!=r&&r.prev(t)):t===r&&e===n?(t.next(e),t.prev(o),e.prev(t),e.next(i),null!=o&&o.next(t),null!=i&&i.prev(e)):(t.prev(o),e.next(i),t.next(r),e.prev(n),null!=n&&n.next(e),null!=i&&i.prev(e),null!=r&&r.prev(t),null!=o&&o.next(t)),null===t.prev()&&(this._first=t),null===e.prev()&&(this._first=e)},t.prototype.print=function(){var t,e;for(t=this.begin(),e="as is: [";t!==this.end();)e+=JSON.stringify(t.key()),t=t.next(),e+=t!==this.end()?", ":"";for(e+="] reverse: [",t=this.end().prev();null!=t;)e+=JSON.stringify(t.key()),t=t.prev(),e+=null!=t?", ":"";e+="]",console.log(e)},t.prototype.clear=function(){return this._first=null,this._last.prev(null),this._length=0},t.prototype.contains=function(t){return null!=t&&t.owningMap()===this},t.prototype.erase=function(t){var e,i;if(null!=t&&!this.contains(t))throw new Error("item is null or not part of this list");return i=t.prev(),e=t.next(),null!=e&&e.prev(i),null!=i&&i.next(e),null==i&&(this._first=e),t.clearConnections(),t.owningMap(null),this._length--,null},t.prototype.begin=function(){return this._first},t.prototype.end=function(){return this._last},t.prototype.size=function(){return this._length},t.prototype.empty=function(){return this._length<=0},t.prototype.at=function(t){var e,i;for(i=this.begin(),e=0;i!==this.end()&&e<this._length;){if(e===t)return i;e++,i=i.next()}throw new Error("Index out of bound")},t}(),"undefined"!=typeof module&&null!==module&&(module.exports={list:xt,ordered_queue:Et,ordered_map:wt,list_item:gt}),at=function(t){return t>0},_t=function(t){return 0>t},yt=function(t){return 0===t},"undefined"!=typeof module&&null!==module&&(module.exports={is_neg:_t,is_pos:at,is_zero:yt}),null==u&&"undefined"!=typeof require&&null!==require?(a=require("./constants").EPSILON,Gt=require("./voronoi_structures"),Ht=Gt.site_event,B=Gt.circle_event,Rt=Gt.point_2d,Lt=require("./voronoi_ctypes"),yt=Lt.is_zero,_t=Lt.is_neg,at=Lt.is_pos,Dt=require("../thirdparty/jsbn"),o=Dt.BigIntegerFromInt,r=Dt.BigInteger):(r=bnBigInteger,o=bnBigIntegerFromInt),ie=function(t){return t>0?Math.floor(t):Math.ceil(t)},ee=function(t){return ie(t)},ft=function(t){return 0===t.compareTo(r.ZERO)},ht=function(t){return t.compareTo(r.ZERO)>0},pt=function(t){return t.compareTo(r.ZERO)<0},lt=Math.sqrt,ct=function(t,e){return null!=e?Math.abs(t.x()-e.x())<a:ct(t.point0(),t.point1())},Jt=function(t,e,i,n){return t*n-e*i},It={},It.RIGHT=-1,It.COLLINEAR=0,It.LEFT=1,It.eval=function(t,e,i,n){var r,o,s,l;return null!=n?It.eval(Jt(t,e,i,n)):null!=i?(r=ie(t.x())-ie(e.x()),o=ie(e.x())-ie(i.x()),s=ie(t.y())-ie(e.y()),l=ie(e.y())-ie(i.y()),It.eval(Jt(r,s,o,l))):yt(t)?It.COLLINEAR:_t(t)?It.RIGHT:It.LEFT},St=function(t,e){return Math.abs(t.x()-e.x())<a?t.y()<e.y():t.x()<e.x()},nt=function(t,e){if("site_event"===t.eventType()&&"site_event"===e.eventType())return Math.abs(t.x0()-e.x0())>a?t.x0()<e.x0():t.is_segment()?ct(e)?ct(t)?t.y0()<e.y0()&&Math.abs(t.y0()-e.y0())>a:!1:ct(t)?!0:Math.abs(t.y0()-e.y0())>a?t.y0()<e.y0():It.eval(t.point1(),t.point0(),e.point1())===It.LEFT:e.is_segment()?ct(e)?t.y0()<e.y0()||Math.abs(t.y0()-e.y0())<a:!0:t.y0()<e.y0()&&Math.abs(t.y0()-e.y0())>a;if("site_event"===t.eventType()&&"circle_event"===e.eventType())return t.x0()<e.lower_x()&&Math.abs(t.x0()-e.lower_x())>a;if("circle_event"===t.eventType()&&"site_event"===e.eventType())return t.lower_x()<e.x0()&&Math.abs(t.lower_x()-e.x0())>a;if("circle_event"===t.eventType()&&"circle_event"===e.eventType())return Math.abs(t.lower_x()-e.lower_x())>a?t.lower_x()<e.lower_x():t.y()<e.y()&&Math.abs(t.y()-e.y())>a;throw new Error("event_comparison_predicate should never reach here!")},vt={LESS:-1,UNDEFINED:0,MORE:1},it=function(t,e,i){return t.is_segment()?e.is_segment()?te(t,e,i):At(e,t,i,!0):e.is_segment()?At(t,e,i,!1):Ot(t,e,i)},Ot=function(t,e,i){var n,r,o,s;if(o=t.point0(),s=e.point0(),o.x()>s.x()){if(i.y()<=o.y())return!1}else{if(!(o.x()<s.x()))return o.y()+s.y()<2*i.y();if(i.y()>=s.y())return!0}return n=ot(t,i),r=ot(e,i),r>n},At=function(t,e,i,n){var r,o,s,l;return s=rt(t,e,i,n),s!==vt.UNDEFINED?s===vt.LESS:(r=ot(t,i),o=st(e,i),l=n^o>r,1===l)},te=function(t,e,i){var n,r;return t.sorted_index()===e.sorted_index()?It.eval(t.point0(),t.point1(),i)===It.LEFT:(n=st(t,i),r=st(e,i),r>n)},ot=function(t,e){var i,n;return i=t.x()-e.x(),n=t.y()-e.y(),(i*i+n*n)/(2*i)},st=function(t,e){var i,n,r,o,s;return ct(t)?(t.x()-e.x())/2:(o=t.point0(),s=t.point1(),i=s.x()-o.x(),n=s.y()-o.y(),r=Math.sqrt(i*i+n*n),r=_t(n)?(r-n)/(i*i):1/(n+r),r*Jt(ie(s.x())-ie(o.x()),ie(s.y())-ie(o.y()),ie(e.x())-ie(o.x()),ie(e.y())-ie(o.y())))},rt=function(t,e,i,n){var r,o,s,l,u,_,p,h,c,y;return y=t.point0(),c=e.point0(),h=e.point1(),It.eval(c,h,i)!==It.RIGHT?e.is_inverse()?vt.MORE:vt.LESS:(s=i.x()-y.x(),l=i.y()-y.y(),r=h.x()-c.x(),o=h.y()-c.y(),ct(e)?i.y()<y.y()&&!n?vt.MORE:i.y()>y.y()&&n?vt.LESS:vt.UNDEFINED:(p=It.eval(ie(h.x())-ie(c.x()),ie(h.y())-ie(c.y()),ie(i.x())-ie(y.x()),ie(i.y())-ie(y.y())),p===It.LEFT?e.is_inverse()?n?vt.UNDEFINED:vt.MORE:n?vt.LESS:vt.UNDEFINED:(u=r*(l+s)*(l-s),_=2*o*s*l,Math.abs(u-_)>a&&u>_^n?n?vt.LESS:vt.MORE:vt.UNDEFINED)))},mt=function(t,e){var i,n,r,o,s,l,u,_,p;return n=function(t){return t.left_site().sorted_index()>t.right_site().sorted_index()?t.left_site():t.right_site()},i=function(t){return St(t.point0(),t.point1())?t.point0():t.point1()},r=function(t,e){return null==e&&(e=!0),t.left_site().sorted_index()===t.right_site().sorted_index()?{first:t.left_site().y0(),second:0}:t.left_site().sorted_index()>t.right_site().sorted_index()?!e&&t.left_site().is_segment()&&ct(t.left_site())?{first:t.left_site().y0(),second:1}:{first:t.left_site().y1(),second:1}:{first:t.right_site().y0(),second:-1}},l=n(t),u=n(e),o=i(l),s=i(u),Math.abs(o.x()-s.x())<a?l.sorted_index()===u.sorted_index()?(_=r(t),p=r(e),_.first<p.first||_.first===p.first&&_.second<p.second):l.sorted_index()<u.sorted_index()?(_=r(t,!1),p=r(e,!0),_.first!==p.first?_.first<p.first:l.is_segment()?!1:_.second<0):(_=r(t,!0),p=r(e,!1),_.first!==p.first?_.first<p.first:u.is_segment()?!0:p.second>0):o.x()<s.x()?it(t.left_site(),t.right_site(),s):o.x()>s.x()?!it(e.left_site(),e.right_site(),o):void 0},J={ppp:function(t,e,i){return It.eval(t.point0(),e.point0(),i.point0())===It.RIGHT},pps:function(t,e,i,n){var r,o;if(2===n)return!i.point0().equals(t.point0())||!i.point1().equals(e.point0());if(r=It.eval(t.point0(),e.point0(),i.point0()),o=It.eval(t.point0(),e.point0(),i.point1()),1===n&&t.x0()>=e.x0()){if(r!==It.RIGHT)return!1}else if(3===n&&e.x0()>=t.x0()){if(o!==It.RIGHT)return!1}else if(r!==It.RIGHT&&o!==It.RIGHT)return!1;return!0},pss:function(t,e,i,n){if(e.sorted_index()===i.sorted_index())return!1;if(2===n){if(!e.is_inverse()&&i.is_inverse())return!1;if(e.is_inverse()===i.is_inverse()&&It.eval(e.point0(),t.point0(),i.point1())!==It.RIGHT)return!1}return!0},sss:function(t,e,i){return t.sorted_index()!==e.sorted_index()&&e.sorted_index()!==i.sorted_index()}},Vt={eval1:function(t,e){return t instanceof Array?t[0]*Math.sqrt(e[0]):t*Math.sqrt(e)},eval2:function(t,e,i,n){return t instanceof Array?Vt.eval2(t[0],e[0],t[1],e[1]):Vt.eval1(t,e)+Vt.eval1(i,n)},eval3:function(t,e,i,n,r,o){return t instanceof Array?Vt.eval3(t[0],e[0],t[1],e[1],t[2],e[2]):Vt.eval2(t,e,i,n)+Vt.eval1(r,o)},eval4:function(t,e,i,n,r,o,s,l){return t instanceof Array?Vt.eval4(t[0],e[0],t[1],e[1],t[2],e[2],t[3],e[3]):Vt.eval2(t,e,i,n)+Vt.eval2(r,o,s,l)}},Wt={eval1:function(t,e){var i,n,r,o;return i=t,r=e,t instanceof Array&&(i=t[0],r=e[0]),n=i.toDouble(),o=r.toDouble(),n*Math.sqrt(o)},eval2:function(t,e,i,n){var r,o;return t instanceof Array?Wt.eval2(t[0],e[0],t[1],e[1]):(r=Wt.eval1(t,e),o=Wt.eval1(i,n),!_t(r)&&!_t(o)||!at(r)&&!at(o)?r+o:t.multiply(t).multiply(e).subtract(i.multiply(i).multiply(n)).toDouble()/(r-o))},eval3:function(t,e,i,n,r,s){var l,u,_,p;return t instanceof Array?Wt.eval3(t[0],e[0],t[1],e[1],t[2],e[2]):(l=Wt.eval2(t,e,i,n),u=Wt.eval1(r,s),!_t(l)&&!_t(u)||!at(l)&&!at(u)?l+u:(_=[],p=[],_[0]=t.multiply(t).multiply(e).add(i.multiply(i).multiply(n)).subtract(r.multiply(r).multiply(s)),p[0]=o(1),_[1]=t.multiply(i).multiply(o(2)),p[1]=e.multiply(n),Wt.eval2(_,p)/(l-u)))},eval4:function(t,e,i,n,r,s,l,u){var _,p,a,h;return t instanceof Array?Wt.eval4(t[0],e[0],t[1],e[1],t[2],e[2],t[3],e[3]):(_=Wt.eval2(t,e,i,n),p=Wt.eval2(r,s,l,u),!_t(_)&&!_t(p)||!at(_)&&!at(p)?_+p:(a=[],h=[],a[0]=t.multiply(t).multiply(e).add(i.multiply(i).multiply(n)).subtract(r.multiply(r).multiply(s)).subtract(l.multiply(l).multiply(u)),h[0]=o(1),a[1]=t.multiply(i).multiply(o(2)),h[1]=e.multiply(n),a[2]=r.multiply(l).multiply(o(-2)),h[2]=s.multiply(u),Wt.eval3(a,h)/(_-p)))}},Xt=function(t,e){throw new Error("sqrt_expr_evaluator_pss4 should never be called")},$t=function(t,e){return t[3]+t[0]*Math.sqrt(e[0])+t[1]*Math.sqrt(e[1])+t[2]*Math.sqrt(e[3]*(Math.sqrt(e[0]*e[1])+e[2]))},Qt=function(t,e){var i,n,r,s,l;return i=[],n=[],ft(t[3])?(r=Wt.eval2(t,e),i[0]=o(1),n[0]=e[0].multiply(e[1]),i[1]=e[2],n[1]=o(1),l=Wt.eval1(t[2],e[3])*lt(Wt.eval2(i,n)),!_t(r)&&!_t(l)||!at(r)&&!at(l)?r+l:(i[0]=t[0].multiply(t[0]).multiply(e[0]).add(t[1].multiply(t[1]).multiply(e[1])).subtract(t[2].multiply(t[2]).multiply(e[3]).multiply(e[2])),n[0]=o(1),i[1]=t[0].multiply(t[1]).multiply(o(2)).subtract(t[2].multiply(t[2]).multiply(e[3])),n[1]=e[0].multiply(e[1]),s=Wt.eval2(i,n),s/(r-l))):(i[0]=o(1),n[0]=e[0].multiply(e[1]),i[1]=e[2],n[1]=o(1),l=Wt.eval1(t[2],e[3])*lt(Wt.eval2(i,n)),i[0]=t[0],n[0]=e[0],i[1]=t[1],n[1]=e[1],i[2]=t[3],n[2]=o(1),r=Wt.eval3(i,n),!_t(r)&&!_t(l)||!at(r)&&!at(l)?r+l:(i[0]=t[3].multiply(t[0]).multiply(o(2)),i[1]=t[3].multiply(t[1]).multiply(o(2)),i[2]=t[0].multiply(t[0]).multiply(e[0]).add(t[1].multiply(t[1]).multiply(e[1])).add(t[3].multiply(t[3])).subtract(t[2].multiply(t[2]).multiply(e[2]).multiply(e[3])),i[3]=t[0].multiply(t[1]).multiply(o(2)).subtract(t[2].multiply(t[2]).multiply(e[3])),n[3]=e[0].multiply(e[1]),s=Zt(i,n),s/(r-l)))},Kt=function(t,e){throw new Error("sqrt_expr_evaluator_pss3 should never be called")},Zt=function(t,e){var i,n,r,s,l;return i=[],n=[],r=Wt.eval2(t[0],e[0],t[1],e[1]),l=Wt.eval2(t[2],e[2],t[3],e[3]),!_t(r)&&!_t(l)||!at(r)&&!at(l)?r+l:(i[0]=t[0].multiply(t[0]).multiply(e[0]).add(t[1].multiply(t[1]).multiply(e[1])).subtract(t[2].multiply(t[2])).subtract(t[3].multiply(t[3]).multiply(e[0]).multiply(e[1])),n[0]=o(1),i[1]=t[0].multiply(t[1]).subtract(t[2].multiply(t[3])).multiply(o(2)),n[1]=e[3],s=Wt.eval2(i,n),s/(r-l))},Y={ppp:function(t,e,i,n,r,o,s){var l,u,_,p,a,h,c,y,f,v,d,x,g;null==r&&(r=!0),null==o&&(o=!0),null==s&&(s=!0),_=[],p=[],x=[],g=[],_[0]=ie(t.x())-ie(e.x()),_[1]=ie(e.x())-ie(i.x()),_[2]=ie(t.x())-ie(i.x()),p[0]=ie(t.y())-ie(e.y()),p[1]=ie(e.y())-ie(i.y()),p[2]=ie(t.y())-ie(i.y()),x[0]=ie(t.x())+ie(e.x()),x[1]=ie(e.x())+ie(i.x()),g[0]=ie(t.y())+ie(e.y()),g[1]=ie(e.y())+ie(i.y()),a=.5/ee(_[0]*p[1]-_[1]*p[0]),y=_[0]*x[0]+p[0]*g[0],f=_[1]*x[1]+p[1]*g[1],(r||s)&&(l=y*p[1]-f*p[0],n.x(l*a),s&&(d=(_[0]*_[0]+p[0]*p[0])*(_[1]*_[1]+p[1]*p[1])*(_[2]*_[2]+p[2]*p[2]),v=lt(d),_t(n.x())?(c=l*l-d,h=c*a/(l+v),n.lower_x(h)):_t(a)?n.lower_x(n.x()-v*a):n.lower_x(n.x()+v*a))),o&&(u=f*_[0]-y*_[1],n.y(u*a))},pps:function(t,e,i,n,r,o,s,l){var u,_,p,a,h,c,y,f,v,d,x,g,m,w,b,E,T,q,I,R;return null==o&&(o=!0),null==s&&(s=!0),null==l&&(l=!0),p=[],a=[],x=ie(i.y1())-ie(i.y0()),g=ie(i.x0())-ie(i.x1()),w=x*x+g*g,I=ie(e.y())-ie(t.y()),R=ie(t.x())-ie(e.x()),E=ie(t.x())+ie(e.x()),T=ie(t.y())+ie(e.y()),q=x*I+g*R,h=I*g-R*x,y=ie(i.y1())-ie(t.y()),f=ie(t.x())-ie(i.x1()),u=x*f-g*y,y=ie(i.y1())-ie(e.y()),f=ie(e.x())-ie(i.x1()),_=x*f-g*y,b=u+_,yt(h)?(m=q*q-b*b,h=q*b,p[0]=h*E*2+m*I,a[0]=w,p[1]=h*b*2+m*q,a[1]=1,p[2]=h*T*2+m*R,v=1/h,o&&r.x(.25*p[0]*v),s&&r.y(.25*p[2]*v),void(l&&r.lower_x(.25*Vt.eval2(p,a)*v/lt(w)))):(c=(q*q+h*h)*u*_*4,d=1/h,d*=d,(o||l)&&(p[0]=E*h*h+q*b*I,a[0]=1,p[1]=2===n?-I:I,a[1]=c,o&&r.x(.5*Vt.eval2(p,a)*d)),(s||l)&&(p[2]=T*h*h+q*b*R,a[2]=1,p[3]=2===n?-R:R,a[3]=c,s&&r.y(.5*Vt.eval2(p[2],a[2],p[3],a[3])*d)),l?(a[0]=a[0]*w,a[1]=a[1]*w,p[2]=b*(h*h+q*q),a[2]=1,p[3]=2===n?-q:q,a[3]=c,r.lower_x(.5*Vt.eval4(p,a)*d/lt(w))):void 0)},pss:function(t,e,i,n,r,o,s,l){var u,_,p,a,h,c,y,f,v,d,x,g,m,w,b,E,T,q,I,R,S,N;return null==o&&(o=!0),null==s&&(s=!0),null==l&&(l=!0),u=[],_=[],p=[],a=[],h=[],I=e.point1(),T=e.point0(),R=i.point0(),q=i.point1(),u[0]=ie(T.x())-ie(I.x()),_[0]=ie(T.y())-ie(I.y()),u[1]=ie(q.x())-ie(R.x()),_[1]=ie(q.y())-ie(R.y()),E=u[1]*_[0]-u[0]*_[1],yt(E)?(d=2*ee(u[0]*u[0]+_[0]*_[0]),p[0]=_[0]*(ie(R.x())-ie(I.x()))-u[0]*(ie(R.y())-ie(I.y())),x=u[0]*(ie(t.y())-ie(I.y()))-_[0]*(ie(t.x())-ie(I.x())),g=_[0]*(ie(t.x())-ie(R.x()))-u[0]*(ie(t.y())-ie(R.y())),h[0]=x*g,h[1]=1,s&&(a[0]=_[0]*(2===n?2:-2),a[1]=u[0]*u[0]*(ie(I.y())+ie(R.y()))-u[0]*_[0]*(ie(I.x())+ie(R.x())-2*ie(t.x()))+_[0]*_[0]*(2*ie(t.y())),y=Vt.eval2(a,h),r.y(y/d)),void((o||l)&&(a[0]=u[0]*(2===n?2:-2),a[1]=_[0]*_[0]*(ie(I.x())+ie(R.x()))-u[0]*_[0]*(ie(I.y())+ie(R.y())-2*ie(t.y()))+u[0]*u[0]*(2*ie(t.x())),o&&(c=Vt.eval2(a,h),r.x(c/d)),l&&(a[2]=_t(p[0])?-p[0]:p[0],h[2]=u[0]*u[0]+_[0]*_[0],b=Vt.eval3(a,h),r.lower_x(b/d))))):(p[0]=_[0]*T.x()-u[0]*T.y(),p[1]=u[1]*q.y()-_[1]*q.x(),m=u[0]*p[1]+u[1]*p[0],w=_[0]*p[1]+_[1]*p[0],x=m-E*t.x(),g=w-E*t.y(),yt(x)&&yt(g)?(d=E,c=m/d,y=w/d,r.x(c),r.y(y),void r.lower_x(c)):(S=(2===n?1:-1)*(_t(E)?1:-1),a[0]=u[1]*-x+_[1]*-g,a[1]=u[0]*-x+_[0]*-g,a[2]=S,a[3]=0,h[0]=u[0]*u[0]+_[0]*_[0],h[1]=u[1]*u[1]+_[1]*_[1],h[2]=u[0]*u[1]+_[0]*_[1],h[3]=(u[0]*g-_[0]*x)*(u[1]*g-_[1]*x)*-2,N=$t(a,h),d=N*E,s&&(a[0]=_[1]*(x*x+g*g)-w*(x*u[1]+g*_[1]),a[1]=_[0]*(x*x+g*g)-w*(x*u[0]+g*_[0]),a[2]=w*S,v=$t(a,h),r.y(v/d)),(o||l)&&(a[0]=u[1]*(x*x+g*g)-m*(x*u[1]+g*_[1]),a[1]=u[0]*(x*x+g*g)-m*(x*u[0]+g*_[0]),a[2]=m*S,o&&(f=$t(a,h),r.x(f/d)),l)?(a[3]=E*(x*x+g*g)*(_t(N)?-1:1),b=$t(a,h),r.lower_x(b/d)):void 0))},sss:function(t,e,i,n,r,o,s){var l,u,_,p,a,h,c,y,f,v,d,x,g,m,w,b;for(null==r&&(r=!0),null==o&&(o=!0),null==s&&(s=!0),l=[],u=[],_=[],p=[],a=[],l[0]=ie(t.x1())-ie(t.x0()),l[1]=ie(e.x1())-ie(e.x0()),l[2]=ie(i.x1())-ie(i.x0()),u[0]=ie(t.y1())-ie(t.y0()),u[1]=ie(e.y1())-ie(e.y0()),u[2]=ie(i.y1())-ie(i.y0()),_[0]=ie(t.x0())*ie(t.y1())-ie(t.y0())*ie(t.x1()),_[1]=ie(e.x0())*ie(e.y1())-ie(e.y0())*ie(e.x1()),_[2]=ie(i.x0())*ie(i.y1())-ie(i.y0())*ie(i.x1()),f=x=0;3>x;f=++x)a[f]=l[f]*l[f]+u[f]*u[f];for(f=m=0;3>m;f=++m)v=(f+1)%3,d=(f+2)%3,p[f]=l[v]*u[d]-l[d]*u[v];if(y=Vt.eval3(p,a),o){for(f=w=0;3>w;f=++w)v=(f+1)%3,d=(f+2)%3,p[f]=u[v]*_[d]-u[d]*_[v];c=Vt.eval3(p,a),n.y(c/y)}if(r||s){for(p[3]=0,f=b=0;3>b;f=++b)v=(f+1)%3,d=(f+2)%3,p[f]=l[v]*_[d]-l[d]*_[v],s&&(p[3]=p[3]+p[f]*u[f]);if(r&&(h=Vt.eval3(p,a),n.x(h/y)),s)return a[3]=1,g=Vt.eval4(p,a),n.lower_x(g/y)}}},H={ppp:function(t,e,i,n,r,s,l){var u,_,p,a,h,c,y,f,v,d,x,g,m;null==r&&(r=!0),null==s&&(s=!0),null==l&&(l=!0),p=[],a=[],g=[],m=[],p[0]=o(ie(t.x())-ie(e.x())),p[1]=o(ie(e.x())-ie(i.x())),p[2]=o(ie(t.x())-ie(i.x())),a[0]=o(ie(t.y())-ie(e.y())),a[1]=o(ie(e.y())-ie(i.y())),a[2]=o(ie(t.y())-ie(i.y())),g[0]=o(ie(t.x())+ie(e.x())),g[1]=o(ie(e.x())+ie(i.x())),m[0]=o(ie(t.y())+ie(e.y())),m[1]=o(ie(e.y())+ie(i.y())),h=.5/p[0].multiply(a[1]).subtract(p[1].multiply(a[0])).toDouble(),f=p[0].multiply(g[0]).add(a[0].multiply(m[0])),v=p[1].multiply(g[1]).add(a[1].multiply(m[1])),(r||l)&&(u=f.multiply(a[1]).subtract(v.multiply(a[0])),n.x(u.toDouble()*h),l&&(x=p[0].multiply(p[0]).add(a[0].multiply(a[0])).multiply(p[1].multiply(p[1]).add(a[1].multiply(a[1]))).multiply(p[2].multiply(p[2]).add(a[2].multiply(a[2]))),d=lt(x.toDouble()),_t(n.x())?(y=u.multiply(u).subtract(x),c=y.toDouble()*h/(u.toDouble()+d),n.lower_x(c)):_t(h)?n.lower_x(n.x()-d*h):n.lower_x(n.x()+d*h))),s&&(_=v.multiply(p[0]).subtract(f.multiply(p[1])),n.y(_.toDouble()*h))},pps:function(t,e,i,n,r,s,l,u){var _,p,a,h,c,y,f,v,d,x,g,m,w,b,E,T,q,I,R,S;return null==s&&(s=!0),null==l&&(l=!0),null==u&&(u=!0),a=[],h=[],g=o(ie(i.y1())-ie(i.y0())),m=o(ie(i.x0())-ie(i.x1())),b=g.multiply(g).add(m.multiply(m)),R=o(ie(e.y())-ie(t.y())),S=o(ie(t.x())-ie(e.x())),T=o(ie(t.x())+ie(e.x())),q=o(ie(t.y())+ie(e.y())),I=g.multiply(R).add(m.multiply(S)),c=R.multiply(m).subtract(S.multiply(g)),f=o(ie(i.y1())-ie(t.y())),v=o(ie(t.x())-ie(i.x1())),_=g.multiply(v).subtract(m.multiply(f)),f=o(ie(i.y1())-ie(e.y())),v=o(ie(e.x())-ie(i.x1())),p=g.multiply(v).subtract(m.multiply(f)),E=_.add(p),ft(c)?(w=I.multiply(I).subtract(E.multiply(E)),c=I.multiply(E),a[0]=c.multiply(T).multiply(o(2)).add(w.multiply(R)),h[0]=b,a[1]=c.multiply(E).multiply(o(2)).add(w.multiply(I)),h[1]=o(1),a[2]=c.multiply(q).multiply(o(2)).add(w.multiply(S)),d=1/c.toDouble(),s&&r.x(.25*a[0].toDouble()*d),l&&r.y(.25*a[2].toDouble()*d),void(u&&r.lower_x(.25*Wt.eval2(a,h)*d/lt(b.toDouble())))):(y=I.multiply(I).add(c.multiply(c)).multiply(_).multiply(p).multiply(o(4)),x=1/c.toDouble(),x*=x,(s||u)&&(a[0]=T.multiply(c).multiply(c).add(I.multiply(E).multiply(R)),h[0]=o(1),a[1]=2===n?R.negate():R,h[1]=y,s&&r.x(.5*Wt.eval2(a,h)*x)),(l||u)&&(a[2]=q.multiply(c).multiply(c).add(I.multiply(E).multiply(S)),h[2]=o(1),a[3]=2===n?S.negate():S,h[3]=y,l&&r.y(.5*Wt.eval2(a[2],h[2],a[3],h[3])*x)),u?(h[0]=h[0].multiply(b),h[1]=h[1].multiply(b),a[2]=E.multiply(c.multiply(c).add(I.multiply(I))),h[2]=o(1),a[3]=2===n?I.negate():I,h[3]=y,r.lower_x(.5*Wt.eval4(a,h)*x/lt(b.toDouble()))):void 0)},pss:function(t,e,i,n,r,s,l,u){var _,p,a,h,c,y,f,v,d,x,g,m,w,b,E,T,q,I,R,S,N,O;return null==s&&(s=!0),null==l&&(l=!0),null==u&&(u=!0),_=[],p=[],a=[],h=[],c=[],R=e.point1(),
q=e.point0(),S=i.point0(),I=i.point1(),_[0]=o(ie(q.x())-ie(R.x())),p[0]=o(ie(q.y())-ie(R.y())),_[1]=o(ie(I.x())-ie(S.x())),p[1]=o(ie(I.y())-ie(S.y())),T=_[1].multiply(p[0]).subtract(_[0].multiply(p[1])),ft(T)?(x=2*_[0].multiply(_[0]).add(p[0].multiply(p[0])).toDouble(),a[0]=p[0].multiply(o(ie(S.x())-ie(R.x()))).subtract(_[0].multiply(o(ie(S.y())-ie(R.y())))),g=_[0].multiply(o(ie(t.y())-ie(R.y()))).subtract(p[0].multiply(o(ie(t.x())-ie(R.x())))),m=p[0].multiply(o(ie(t.x())-ie(S.x()))).subtract(_[0].multiply(o(ie(t.y())-ie(S.y())))),c[0]=g.multiply(m),c[1]=o(1),l&&(h[0]=p[0].multiply(o(2===n?2:-2)),h[1]=_[0].multiply(_[0]).multiply(o(ie(R.y())+ie(S.y()))).subtract(_[0].multiply(p[0]).multiply(o(ie(R.x())+ie(S.x())-2*ie(t.x())))).add(p[0].multiply(p[0]).multiply(o(2*ie(t.y())))),f=Wt.eval2(h,c),r.y(f/x)),void((s||u)&&(h[0]=_[0].multiply(o(2===n?2:-2)),h[1]=p[0].multiply(p[0]).multiply(o(ie(R.x())+ie(S.x()))).subtract(_[0].multiply(p[0]).multiply(o(ie(R.y())+ie(S.y())-2*ie(t.y())))).add(_[0].multiply(_[0]).multiply(o(2*ie(t.x())))),s&&(y=Wt.eval2(h,c),r.x(y/x)),u&&(h[2]=pt(a[0])?a[0].negate():a[0],c[2]=_[0].multiply(_[0]).add(p[0].multiply(p[0])),E=Wt.eval3(h,c),r.lower_x(E/x))))):(a[0]=p[0].multiply(o(q.x())).subtract(_[0].multiply(o(q.y()))),a[1]=_[1].multiply(o(I.y())).subtract(p[1].multiply(o(I.x()))),w=_[0].multiply(a[1]).add(_[1].multiply(a[0])),b=p[0].multiply(a[1]).add(p[1].multiply(a[0])),g=w.subtract(T.multiply(o(t.x()))),m=b.subtract(T.multiply(o(t.y()))),ft(g)&&ft(m)?(x=T.toDouble(),y=w.toDouble()/x,f=b.toDouble()/x,r.x(y),r.y(f),void r.lower_x(y)):(N=o((2===n?1:-1)*(pt(T)?1:-1)),h[0]=_[1].multiply(g.negate()).add(p[1].multiply(m.negate())),h[1]=_[0].multiply(g.negate()).add(p[0].multiply(m.negate())),h[2]=N,h[3]=o(0),c[0]=_[0].multiply(_[0]).add(p[0].multiply(p[0])),c[1]=_[1].multiply(_[1]).add(p[1].multiply(p[1])),c[2]=_[0].multiply(_[1]).add(p[0].multiply(p[1])),c[3]=_[0].multiply(m).subtract(p[0].multiply(g)).multiply(_[1].multiply(m).subtract(p[1].multiply(g))).multiply(o(-2)),O=Qt(h,c),x=O*T.toDouble(),l&&(h[0]=p[1].multiply(g.multiply(g).add(m.multiply(m))).subtract(b.multiply(g.multiply(_[1]).add(m.multiply(p[1])))),h[1]=p[0].multiply(g.multiply(g).add(m.multiply(m))).subtract(b.multiply(g.multiply(_[0]).add(m.multiply(p[0])))),h[2]=b.multiply(N),d=Qt(h,c),r.y(d/x)),void((s||u)&&(h[0]=_[1].multiply(g.multiply(g).add(m.multiply(m))).subtract(w.multiply(g.multiply(_[1]).add(m.multiply(p[1])))),h[1]=_[0].multiply(g.multiply(g).add(m.multiply(m))).subtract(w.multiply(g.multiply(_[0]).add(m.multiply(p[0])))),h[2]=w.multiply(N),s&&(v=Qt(h,c),r.x(v/x)),u&&(h[3]=T.multiply(g.multiply(g).add(m.multiply(m))).multiply(o(_t(O)?-1:1)),E=Qt(h,c),r.lower_x(E/x))))))},sss:function(t,e,i,n,r,s,l){var u,_,p,a,h,c,y,f,v,d,x,g,m,w,b,E;for(null==r&&(r=!0),null==s&&(s=!0),null==l&&(l=!0),u=[],_=[],p=[],a=[],h=[],u[0]=o(ie(t.x1())-ie(t.x0())),u[1]=o(ie(e.x1())-ie(e.x0())),u[2]=o(ie(i.x1())-ie(i.x0())),_[0]=o(ie(t.y1())-ie(t.y0())),_[1]=o(ie(e.y1())-ie(e.y0())),_[2]=o(ie(i.y1())-ie(i.y0())),p[0]=o(ie(t.x0())*ie(t.y1())-ie(t.y0())*ie(t.x1())),p[1]=o(ie(e.x0())*ie(e.y1())-ie(e.y0())*ie(e.x1())),p[2]=o(ie(i.x0())*ie(i.y1())-ie(i.y0())*ie(i.x1())),v=g=0;3>g;v=++g)h[v]=u[v].multiply(u[v]).add(_[v].multiply(_[v]));for(v=w=0;3>w;v=++w)d=(v+1)%3,x=(v+2)%3,a[v]=u[d].multiply(_[x]).subtract(u[x].multiply(_[d]));if(f=Wt.eval3(a,h),s){for(v=b=0;3>b;v=++b)d=(v+1)%3,x=(v+2)%3,a[v]=_[d].multiply(p[x]).subtract(_[x].multiply(p[d]));y=Wt.eval3(a,h),n.y(y/f)}if(r||l){for(a[3]=o(0),v=E=0;3>E;v=++E)d=(v+1)%3,x=(v+2)%3,a[v]=u[d].multiply(p[x]).subtract(u[x].multiply(p[d])),l&&(a[3]=a[3].add(a[v].multiply(_[v])));r&&(c=Wt.eval3(a,h),n.x(c/f)),l&&(h[3]=o(1),m=Wt.eval4(a,h),n.lower_x(m/f))}}},dt={ppp:function(t,e,i,n){throw new Error("lazy_circle_formation_functor should never get called, disabled")},pps:function(t,e,i,n,r){throw new Error("lazy_circle_formation_functor should never get called, disabled")},pss:function(t,e,i,n,r){throw new Error("lazy_circle_formation_functor should never get called, disabled")},sss:function(t,e,i,n){throw new Error("lazy_circle_formation_functor should never get called, disabled")}},V=function(t,e,i,n){var r;if(r=function(t,e){var i,n;return e.is_segment()&&ct(e)?(i=e.is_inverse()?e.y1():e.y0(),n=e.is_inverse()?e.y0():e.y1(),i-t.y()>a||t.y()-n>a):!1},t.is_segment())if(e.is_segment())if(i.is_segment()){if(!J.sss(t,e,i))return!1;Y.sss(t,e,i,n)}else{if(!J.pss(i,t,e,3))return!1;Y.pss(i,t,e,3,n)}else if(i.is_segment()){if(!J.pss(e,t,i,2))return!1;Y.pss(e,t,i,2,n)}else{if(!J.pps(e,i,t,1))return!1;Y.pps(e,i,t,1,n)}else if(e.is_segment())if(i.is_segment()){if(!J.pss(t,e,i,1))return!1;Y.pss(t,e,i,1,n)}else{if(!J.pps(t,i,e,2))return!1;Y.pps(t,i,e,2,n)}else if(i.is_segment()){if(!J.pps(t,e,i,3))return!1;Y.pps(t,e,i,3,n)}else{if(!J.ppp(t,e,i))return!1;Y.ppp(t,e,i,n)}return r(n,t)||r(n,e)||r(n,i)?!1:!0},W=function(t,e,i,n){var r;if(r=function(t,e){var i,n;return e.is_segment()&&ct(e)?(i=e.is_inverse()?e.y1():e.y0(),n=e.is_inverse()?e.y0():e.y1(),i-t.y()>a||t.y()-n>a):!1},t.is_segment())if(e.is_segment())if(i.is_segment()){if(!J.sss(t,e,i))return!1;H.sss(t,e,i,n)}else{if(!J.pss(i,t,e,3))return!1;H.pss(i,t,e,3,n)}else if(i.is_segment()){if(!J.pss(e,t,i,2))return!1;H.pss(e,t,i,2,n)}else{if(!J.pps(e,i,t,1))return!1;H.pps(e,i,t,1,n)}else if(e.is_segment())if(i.is_segment()){if(!J.pss(t,e,i,1))return!1;H.pss(t,e,i,1,n)}else{if(!J.pps(t,i,e,2))return!1;H.pps(t,i,e,2,n)}else if(i.is_segment()){if(!J.pps(t,e,i,3))return!1;H.pps(t,e,i,3,n)}else{if(!J.ppp(t,e,i))return!1;H.ppp(t,e,i,n)}return r(n,t)||r(n,e)||r(n,i)?!1:!0},"undefined"!=typeof module&&null!==module&&(module.exports={node_comparison_predicate:mt,distance_predicate:it,event_comparison_predicate:nt,point_comparison_predicate:St,circle_formation_predicate:V,circle_formation_predicate_big:W,is_vertical:ct}),null==u&&"undefined"!=typeof require&&null!==require&&(kt=require("./constants"),a=kt.EPSILON,I=kt.SOURCE_CATEGORY_BITMASK,d=kt.IS_INVERSE),Rt=function(){function t(e,i){null!=e?"object"==typeof e?e instanceof t&&(this.x_=e.x_,this.y_=e.y_):"number"==typeof e&&(this.x_=e,this.y_=i):(this.x_=0,this.y_=0)}return t.prototype.x_=0,t.prototype.y_=0,t.prototype.assign=function(t){this.x_=t.x_,this.y_=t.y_},t.prototype.equals=function(t){return Math.abs(this.x_-t.x_)<a&&Math.abs(this.y_-t.y_)<a},t.prototype.print=function(){return"("+this.x_+", "+this.y_+")"},t.prototype.to_json=function(){return{x:this.x_,y:this.y_}},t.prototype.x=function(){return this.x_},t.prototype.y=function(){return this.y_},t}(),Ht=function(){function t(e,i,n,r){if(null!=e)if("object"==typeof e){if(e instanceof Rt)null!=i?(this.point0_=new Rt(e),this.point1_=new Rt(i)):(this.point0_=new Rt(e),this.point1_=new Rt(e));else if(e instanceof t)return this.point0_=new Rt(e.point0()),this.point1_=new Rt(e.point1()),this.sorted_index_=e.sorted_index_,this.flags_=e.flags_,void(this.initial_index_=e.initial_index_)}else"number"==typeof e&&(null!=n?(this.point0_=new Rt(e,i),this.point1_=new Rt(n,r)):(this.point0_=new Rt(e,i),this.point1_=new Rt(e,i)));else this.point0_=new Rt(0,0),this.point1_=new Rt(0,0);this.sorted_index_=0,this.flags_=0}return t.prototype.point0_=null,t.prototype.point1_=null,t.prototype.sorted_index_=0,t.prototype.initial_index_=0,t.prototype.flags_=0,t.prototype.eventType=function(){return"site_event"},t.prototype.equals=function(t){return this.point0_.equals(t.point0_)&&this.point1_.equals(t.point1_)},t.prototype.x=function(){return this.point0_.x()},t.prototype.y=function(){return this.point0_.y()},t.prototype.x0=function(){return this.point0_.x()},t.prototype.y0=function(){return this.point0_.y()},t.prototype.x1=function(){return this.point1_.x()},t.prototype.y1=function(){return this.point1_.y()},t.prototype.point0=function(){return this.point0_},t.prototype.point1=function(){return this.point1_},t.prototype.sorted_index=function(t){return void 0!==t?(this.sorted_index_=t,this):this.sorted_index_},t.prototype.initial_index=function(t){return void 0!==t?(this.initial_index_=t,this):this.initial_index_},t.prototype.is_inverse=function(){return(this.flags_&d)>0},t.prototype.inverse=function(){var t;return t=this.point1_,this.point1_=new Rt(this.point0_),this.point0_=new Rt(t),this.flags_^=d,this},t.prototype.source_category=function(t){return void 0!==t?(this.flags_|=t,this):this.flags_&I},t.prototype.is_point=function(){return this.point0_.equals(this.point1_)},t.prototype.is_segment=function(){return!this.is_point()},t.prototype.print=function(){return"site_event { p0: "+this.point0_.print()+", p1: "+this.point1_.print()+", params: s-"+this.sorted_index_+" i-"+this.initial_index_+" f-"+this.flags_+" }"},t.prototype.to_json=function(){return{p0:{x:this.point0_.x(),y:this.point0_.y()},p1:{x:this.point1_.x(),y:this.point1_.y()},params:"s-"+this.sorted_index_+" i-"+this.initial_index_+" f-"+this.flags_}},t}(),B=function(){function t(t,e,i){null!=t&&(this.center_x_=t,this.center_y_=e,this.lower_x_=i,this.is_active=!0)}return t.prototype.center_x_=0,t.prototype.center_y_=0,t.prototype.lower_x_=0,t.prototype.is_active_=!0,t.prototype.eventType=function(){return"circle_event"},t.prototype.x=function(t){return void 0!==t?(this.center_x_=t,this):this.center_x_},t.prototype.y=function(t){return void 0!==t?(this.center_y_=t,this):this.center_y_},t.prototype.lower_x=function(t){return void 0!==t?(this.lower_x_=t,this):this.lower_x_},t.prototype.lower_y=function(){return this.center_y_},t.prototype.is_active=function(){return this.is_active_},t.prototype.deactivate=function(){return this.is_active_=!1,this},t.prototype.print=function(){return"circle_event { c_x: "+this.center_x_+" c_y: "+this.center_y_+" lower_x: "+this.lower_x_+" is_active: "+(this.is_active_?1:"0 }")},t.prototype.to_json=function(){return{c_x:parseFloat(this.center_x_.toFixed(6)),c_y:parseFloat(this.center_y_.toFixed(6)),lower_x:parseFloat(this.lower_x_.toFixed(6)),is_active:this.is_active_?1:0}},t}(),F=function(){function t(t,e){null!=e?(this.left_site_=new Ht(t),this.right_site_=new Ht(e)):(this.left_site_=new Ht(t),this.right_site_=new Ht(t))}return t.prototype.left_site_=null,t.prototype.right_site_=null,t.prototype.left_site=function(t){return void 0!==t?(this.left_site_=t,this):this.left_site_},t.prototype.right_site=function(t){return void 0!==t?(this.right_site_=t,this):this.right_site_},t.prototype.print=function(){return"beach_node_key { left_site: "+this.left_site_.print()+" right_site: "+this.right_site_.print()+" }"},t.prototype.to_json=function(){return{left_site:this.left_site_.to_json(),right_site:this.right_site_.to_json()}},t}(),C=function(){function t(t){this.circle_event_=null,this.edge_=t}return t.prototype.circle_event_=null,t.prototype.edge_=null,t.prototype.circle_event=function(t){return void 0!==t?(this.circle_event_=t,this):this.circle_event_},t.prototype.edge=function(t){return void 0!==t?(this.edge_=t,this):this.edge_},t.prototype.print=function(){return"beach_line_node_data { circle_event: "+(null!==this.circle_event_?this.circle_event_.print():"NULL ")+" edge: TODO}"},t.prototype.to_json=function(){return{circle_event:null!==this.circle_event_?this.circle_event_.to_json():null,edge:null!==this.edge_?this.edge_.to_json():null}},t}(),"undefined"!=typeof module&&null!==module&&(module.exports={beach_line_node_data:C,beach_line_node_key:F,circle_event:B,site_event:Ht,point_2d:Rt}),null==u&&"undefined"!=typeof require&&null!==require&&(Ct=require("./constants"),i=Ct.BIT_IS_LINEAR,n=Ct.BIT_IS_PRIMARY,a=Ct.EPSILON,e=Ct.BITS_SHIFT),se=function(){function i(t,e){this.source_index_=t,this.incident_edge_=null,this.color_=e}return i.prototype.source_index_=0,i.prototype.incident_edge_=null,i.prototype.color_=0,i.prototype.contains_point=function(){var t;return t=this.source_category(),z(t,c)},i.prototype.contains_segment=function(){var t;return t=this.source_category(),z(t,y)},i.prototype.source_index=function(){return this.source_index_},i.prototype.source_category=function(){return this.color_&I},i.prototype.is_generate=function(){return null===this.incident_edge_},i.prototype.incident_edge=function(t){return void 0!==t?void(this.incident_edge_=t):this.incident_edge_},i.prototype.color=function(i){return void 0!==i?(this.color_&=t,void(this.color_|=i<<e)):this.color_>>e},i}(),pe=function(){function i(t,e){this.x_=t,this.y_=e,this.incident_edge_=null,this.color_=0}return i.prototype.x_=0,i.prototype.y_=0,i.prototype.x=function(){return this.x_},i.prototype.y=function(){return this.y_},i.prototype.is_degenerate=function(){return null===this.incident_edge_},i.prototype.incident_edge=function(t){return void 0!==t?void(this.incident_edge_=t):this.incident_edge_},i.prototype.color=function(i){return void 0!==i?(this.color_&=t,void(this.color_|=i<<e)):this.color_>>e},i.prototype.to_json=function(){return{x:parseFloat(this.x_.toFixed(6)),y:parseFloat(this.y_.toFixed(6))}},i}(),_e=function(){function r(t,e){t&&(this.color_|=i),e&&(this.color_|=n)}return r.prototype.cell_=null,r.prototype.vertex_=null,r.prototype.twin_=null,r.prototype.next_=null,r.prototype.prev_=null,r.prototype.color_=0,r.prototype.cell=function(t){return void 0!==t?void(this.cell_=t):this.cell_},r.prototype.vertex0=function(t){return void 0!==t?void(this.vertex_=t):this.vertex_},r.prototype.vertex1=function(){return this.twin_.vertex0()},r.prototype.twin=function(t){return void 0!==t?void(this.twin_=t):this.twin_},r.prototype.next=function(t){return void 0!==t?void(this.next_=t):this.next_},r.prototype.prev=function(t){return void 0!==t?void(this.prev_=t):this.prev_},r.prototype.rot_next=function(){return this.prev_.twin()},r.prototype.rot_prev=function(){return this.twin_.next()},r.prototype.is_finite=function(){return null!=this.vertex0()&&null!=this.vertex1()},r.prototype.is_infinite=function(){return null==this.vertex0()||null==this.vertex1()},r.prototype.is_linear=function(){return(this.color_&i)>0},r.prototype.is_curved=function(){return 0===(this.color_&i)},r.prototype.is_primary=function(){return(this.color_&n)>0},r.prototype.is_secondary=function(){return 0===(this.color_&n)},r.prototype.color=function(i){return void 0!==i?(this.color_&=t,void(this.color_|=i<<e)):this.color_>>e},r.prototype.prev_primary=function(){var t;for(t=this.prev_;null!=t?t.is_secondary():void 0;)t=t.twin().prev();return t!==this.twin_?t:void 0},r.prototype.next_primary=function(){var t;for(t=this.next_;null!=t?t.is_secondary():void 0;)t=t.twin().next();return t!==this.twin_?t:void 0},r.prototype.to_json=function(){return{is_finite:this.is_finite(),is_linear:this.is_linear(),is_primary:this.is_primary(),color:this.color(),vertex0:null===this.vertex0()?null:{x:parseFloat(this.vertex0().x().toFixed(6)),y:parseFloat(this.vertex0().y().toFixed(6))},vertex1:null===this.vertex1()?null:{x:parseFloat(this.vertex1().x().toFixed(6)),y:parseFloat(this.vertex1().y().toFixed(6))}}},r}(),re=function(t,e){return Math.abs(t.x()-e.x())<a&&Math.abs(t.y()-e.y())<a},ue=function(){function t(){this.cells_=[],this.vertices_=[],this.edges_=[]}return t.prototype.cells_=[],t.prototype.vertices_=[],t.prototype.edges_=[],t.prototype.clear=function(){return this.cells_=[],this.vertices_=[],this.edges_=[]},t.prototype.cells=function(){return this.cells_},t.prototype.vertices=function(){return this.vertices_},t.prototype.edges=function(){return this.edges_},t.prototype.num_cells=function(){return this.cells_.length},t.prototype.num_edges=function(){return this.edges_.length},t.prototype.num_vertices=function(){return this.vertices_.length},t.prototype._reserve=function(t){},t.prototype._process_single_site=function(t){return this.cells_.push(new se(t.initial_index(),t.source_category()))},t.prototype._insert_new_edge=function(t,e,i,n,r){var o,s,l,u,_,p,a,h,c,y,f,v,d,x,g,m,w;return null==i?(d=t,x=e,m=d.sorted_index(),w=x.sorted_index(),h=this.is_linear_edge(d,x),c=this.is_primary_edge(d,x),this.edges_.push(new _e(h,c)),u=this.edges_[this.edges_.length-1],this.edges_.push(new _e(h,c)),p=this.edges_[this.edges_.length-1],0===this.cells_.length&&this.cells_.push(new se(d.initial_index(),d.source_category())),this.cells_.push(new se(x.initial_index(),x.source_category())),u.cell(this.cells_[m]),p.cell(this.cells_[w]),u.twin(p),p.twin(u),{first:u,second:p}):(d=t,g=e,o=i,s=n,l=r,_=s,a=l,this.vertices_.push(new pe(o.x(),o.y())),v=this.vertices_[this.vertices_.length-1],_.vertex0(v),a.vertex0(v),h=this.is_linear_edge(d,g),c=this.is_primary_edge(d,g),this.edges_.push(new _e(h,c)),y=this.edges_[this.edges_.length-1],y.cell(this.cells_[d.sorted_index()]),this.edges_.push(new _e(h,c)),f=this.edges_[this.edges_.length-1],f.cell(this.cells_[g.sorted_index()]),y.twin(f),f.twin(y),f.vertex0(v),_.prev(y),y.next(_),_.twin().next(a),a.prev(_.twin()),a.twin().next(f),f.prev(a.twin()),{first:y,second:f})},t.prototype._build=function(){var t,e,i,n,r,o,s,l,u,_,p,a,h,c,y,f,v,d,x,g,m,w,b,E,T,q,I;for(p=0,u=_=0,x=this.edges_.length;x>_;u=_+=2)q=this.edges_[u].vertex0(),I=this.edges_[u].vertex1(),null!=q&&null!=I&&re(q,I)?this.remove_edge(this.edges_[u]):(u!==p&&(this.edges_[p]=this.edges_[u],this.edges_[p+1]=this.edges_[u+1],i=this.edges_[p],n=this.edges_[p+1],i.twin(n),n.twin(i),null!=i.prev()&&(i.prev().next(i),n.next().prev(n)),null!=n.prev()&&(i.next().prev(i),n.prev().next(n))),p+=2);for(this.edges_.splice(p,this.edges_.length-p),g=this.edges_,f=0,c=g.length;c>f;f++)r=g[f],r.cell().incident_edge(r),null!=r.vertex0()&&r.vertex0().incident_edge(r);if(a=0,this.vertices_.length>0)for(u=v=0,m=this.vertices_.length-1;m>=0?m>v:v>m;u=m>=0?++v:--v)if(null!=this.vertices_[u].incident_edge()){if(u!==a)for(this.vertices_[a]=this.vertices_[u],T=this.vertices_[a],e=T.incident_edge();;)if(e.vertex0(T),e=e.rot_next(),e===T.incident_edge())break;++a}if(this.vertices_.splice(a,this.vertices_.length-a),0===this.vertices_.length){if(0!==this.edges_.length){for(l=0,o=this.edges_[l],o.next(o),o.prev(o),++l,o=this.edges_[l],++l;l<=this.edges_.length-1;)s=this.edges_[l],++l,o.next(s),o.prev(s),s.next(o),s.prev(o),o=this.edges_[l],++l;return o.next(o),o.prev(o)}for(w=this.cells_,b=[],d=0,y=w.length;y>d;d++)if(t=w[d],!t.is_degenerate()){for(h=t.incident_edge();null!=h.prev()&&(h=h.prev(),h!==t.incident_edge()););if(null==h.prev()){for(E=t.incident_edge();null!=E.next();)E=E.next();h.prev(E),b.push(E.next(h))}}return b}},t.prototype.is_primary_edge=function(t,e){var i,n;return i=t.is_segment(),n=e.is_segment(),i&&!n?!t.point0().equals(e.point0())&&!t.point1().equals(e.point0()):!i&&n?!e.point0().equals(t.point0())&&!e.point1().equals(t.point0()):!0},t.prototype.is_linear_edge=function(t,e){return this.is_primary_edge(t,e)?!(t.is_segment()^e.is_segment()):!0},t.prototype.remove_edge=function(t){var e,i,n,r,o,s,l,u;for(u=t.vertex0(),l=t.twin().rot_next();l!==t.twin();)l.vertex0(u),l=l.rot_next();return e=t,r=t.twin(),n=e.rot_prev(),i=e.rot_next(),s=r.rot_prev(),o=r.rot_next(),i.twin().next(s),s.prev(i.twin()),n.prev(o.twin()),o.twin().next(n)},t}(),"undefined"!=typeof module&&null!==module&&(module.exports={voronoi_diagram:ue}),null==u&&"undefined"!=typeof require&&null!==require&&(Ft=require("./constants"),A=Ft.SOURCE_CATEGORY_SINGLE_POINT,M=Ft.SOURCE_CATEGORY_SEGMENT_START_POINT,O=Ft.SOURCE_CATEGORY_SEGMENT_END_POINT,N=Ft.SOURCE_CATEGORY_REVERSE_SEGMENT,S=Ft.SOURCE_CATEGORY_INITIAL_SEGMENT,zt=require("./collections"),Et=zt.ordered_queue,wt=zt.ordered_map,xt=zt.list,Ut=require("./voronoi_predicates"),mt=Ut.node_comparison_predicate,St=Ut.point_comparison_predicate,nt=Ut.event_comparison_predicate,W=Ut.circle_formation_predicate_big,V=Ut.circle_formation_predicate,ct=Ut.is_vertical,Bt=require("./voronoi_structures"),Ht=Bt.site_event,B=Bt.circle_event,Rt=Bt.point_2d,F=Bt.beach_line_node_key,C=Bt.beach_line_node_data),oe=function(){function t(){this.index_=0,this.circle_events_=new Et(this.event_comparison),this.end_points_=new Et(this.end_point_comparison),this.beach_line_=new wt(mt),this.site_events_=new xt}return t.prototype.event_comparison=function(t,e){return nt(e.first,t.first)},t.prototype.end_point_comparison=function(t,e){return St(e.first,t.first)},t.prototype.point_comparison_=function(t,e){return St(t,e)},t.prototype.site_events_=null,t.prototype.site_event_iterator_=null,t.prototype.end_points_=null,t.prototype.circle_events_=null,t.prototype.beach_line_=null,t.prototype.index_=0,t.prototype.number_type={INTEGERS:0,BIG_INTEGERS:1},t.prototype.insert_point=function(t,e){var i;return i=new Ht(t,e),this.site_events_.push(i),i.initial_index(this.index_),i.source_category(A),this.index_++},t.prototype.insert_segment=function(t,e,i,n){var r,o,s,l,u;return r=new Rt(t,e),l=new Ht(r),this.site_events_.push(l),l.initial_index(this.index_),l.source_category(M),o=new Rt(i,n),u=new Ht(o),this.site_events_.push(u),u.initial_index(this.index_),u.source_category(O),s=null,this.point_comparison_(r,o)?(s=new Ht(r,o),this.site_events_.push(s),s.source_category(S)):(s=new Ht(o,r),this.site_events_.push(s),s.source_category(N)),s.initial_index(this.index_),this.index_++},t.prototype.print_beachline=function(){var t,e;for(e="beach_line: \n",t=this.beach_line_.begin();t!==this.beach_line_.end();)e+="    ",e+=t.key().print(),e+="  -  ",null!=t.value()&&(e+=t.value().print()),e+="\n",t=t.next();return e+="\n"},t.prototype.print_site_events=function(){var t,e;for(e="site_events:\n",t=this.site_events_.begin();t!==this.site_events_.end();)e+=t===this.site_event_iterator_?" >> ":"    ",e+=t.value().print(),t===this.site_event_iterator_&&(e+=" << "),t=t.next(),e+="\n";return e+="\n"},t.prototype.print_current_end_point_top=function(){var t;return t="end_points("+this.end_points_.size()+"):\n",this.end_points_.size()>0&&(t+="    ",t+=this.end_points_.top().first.print(),t+="  -  ",t+=this.end_points_.top().second.key().print(),t+="\n"),t},t.prototype.print_circle_events=function(){return"circle_events: \n"+this.circle_events_.print()},t.prototype.site_events_to_json=function(){var t,e,i;for(e=[],i=this.site_events_.begin();i!==this.site_events_.end();)t=i.value().to_json(),t.current=i===this.site_event_iterator_,e.push(t),i=i.next();return e},t.prototype.beachline_to_json=function(){var t,e,i;if(e=[],0===this.beach_line_.size())return e;for(i=this.beach_line_.begin();i!==this.beach_line_.end();)t={},t.key=i.key().to_json(),t.value=null!=i.value()?i.value().to_json():null,i=i.next(),e.push(t);return e},t.prototype.output_to_json=function(t){var e,i,n,r,o,s,l,u,_,p;for(i=[],p=[],l=t.edges_,n=0,r=l.length;r>n;n++)e=l[n],i.push(e.to_json());for(u=t.vertices_,s=0,o=u.length;o>s;s++)_=u[s],p.push(_.to_json());return{edges:i,vertices:p,cells:"TODO"}},t.prototype.generate_iteration_json_node=function(t,e){return{iteration:t,beachline:this.beachline_to_json(),site_events:this.site_events_to_json(),circle_events:this.circle_events_.to_json(),end_points:this.end_points_.to_json(),diagram:this.output_to_json(e)}},t.prototype.construct=function(t,e,i){var n;for(null==i&&(i=null),t._reserve(this.site_events_.size()),this.init_sites_queue(),null!=i&&i.push(this.generate_iteration_json_node("AFTER init_sites_queue",t)),this.init_beach_line(t),null!=i&&i.push(this.generate_iteration_json_node("AFTER init_beach_line",t)),n=0;!this.circle_events_.empty()||this.site_event_iterator_!==this.site_events_.end();)for(n++,this.circle_events_.empty()?(this.process_site_event(t,e),null!=i&&i.push(this.generate_iteration_json_node("AFTER top process_site_event ITERATION: "+n,t))):this.site_event_iterator_===this.site_events_.end()?(this.process_circle_event(t,e),null!=i&&i.push(this.generate_iteration_json_node("AFTER top process_circle_event ITERATION: "+n,t))):nt(this.site_event_iterator_.value(),this.circle_events_.top().first)?(this.process_site_event(t,e),null!=i&&i.push(this.generate_iteration_json_node("AFTER bottom process_site_event ITERATION: "+n,t))):(this.process_circle_event(t,e),null!=i&&i.push(this.generate_iteration_json_node("AFTER bottom process_circle_event ITERATION: "+n,t)));!this.circle_events_.empty()&&!this.circle_events_.top().first.is_active();)this.circle_events_.pop(),null!=i&&i.push(this.generate_iteration_json_node("AFTER circle_events_.pop() ITERATION: "+n,t));return this.beach_line_.clear(),t._build()},t.prototype.clear=function(){return this.index_=0,this.site_events_.clear()},t.prototype.init_sites_queue=function(){var t,e,i;for(this.site_events_.jsSort(nt),this.site_events_=this.site_events_.uniqueWithTieBreaker(function(t,e){return t.equals(e)},function(t,e){return t.initial_index_-e.initial_index_}),t=e=0,i=this.site_events_.size();i>=0?i>e:e>i;t=i>=0?++e:--e)this.site_events_.at(t).value().sorted_index(t);this.site_event_iterator_=this.site_events_.begin()},t.prototype.init_beach_line=function(t){var e;if(!this.site_events_.empty())if(1===this.site_events_.size())t._process_single_site(this.site_events_.begin().value()),this.site_event_iterator_=this.site_event_iterator_.next();else{for(e=0;this.site_event_iterator_!==this.site_events_.end()&&ct(this.site_event_iterator_.value().point0(),this.site_events_.begin().value().point0())&&ct(this.site_event_iterator_.value());)this.site_event_iterator_=this.site_event_iterator_.next(),++e;1===e?this.init_beach_line_default(t):this.init_beach_line_collinear_sites(t)}},t.prototype.init_beach_line_default=function(t){var e,i;e=this.site_events_.begin(),i=this.site_events_.begin(),i=i.next(),this.insert_new_arc(e.value(),e.value(),i.value(),this.beach_line_.end(),t),this.site_event_iterator_=this.site_event_iterator_.next()},t.prototype.init_beach_line_collinear_sites=function(t){var e,i,n,r;for(i=this.site_events_.begin(),n=this.site_events_.begin(),n=n.next();n!==this.site_event_iterator_;)r=new F(i.value(),n.value()),e=t._insert_new_edge(i.value(),n.value()).first,this.beach_line_.insert(r,new C(e)),i=i.next(),n=n.next()},t.prototype.deactivate_circle_event=function(t){null!=t.circle_event()&&(t.circle_event().deactivate(),t.circle_event(null))},t.prototype.process_site_event=function(t,e){var i,n,r,o,s,l,u,_,p,a,h,c;if(c=new Ht(this.site_event_iterator_.value()),n=this.site_event_iterator_.next(),c.is_segment())for(;n!==this.site_events_.end()&&n.value().is_segment()&&n.value().point0().equals(c.point0());)n=n.next();else for(;!this.end_points_.empty()&&this.end_points_.top().first.equals(c.point0());)i=this.end_points_.top().second,this.end_points_.pop(),this.beach_line_.erase(i);for(o=new F(this.site_event_iterator_.value()),l=this.beach_line_.lowerBound(o);this.site_event_iterator_!==n;)c=new Ht(this.site_event_iterator_.value()),r=l,l===this.beach_line_.end()?(r=r.prev(),p=r.key().right_site(),l=this.insert_new_arc(p,p,c,l,t),this.activate_circle_event(r.key().left_site(),r.key().right_site(),c,l,e)):l===this.beach_line_.begin()?(p=l.key().left_site(),r=this.insert_new_arc(p,p,c,l,t),c.is_segment()&&c.inverse(),this.activate_circle_event(c,l.key().left_site(),l.key().right_site(),l,e),l=r):(h=l.key().left_site(),_=l.key().right_site(),this.deactivate_circle_event(l.value()),r=r.prev(),a=r.key().right_site(),u=r.key().left_site(),s=this.insert_new_arc(a,h,c,l,t),this.activate_circle_event(u,a,c,s,e),c.is_segment()&&c.inverse(),this.activate_circle_event(c,h,_,l,e),l=s),this.site_event_iterator_=this.site_event_iterator_.next()},t.prototype.process_circle_event=function(t,e){var i,n,r,o,s,l,u,_,p,a;o=this.circle_events_.top(),r=o.first,s=o.second,l=s,_=s.key().right_site(),n=s.value().edge(),s=s.prev(),i=s.value().edge(),u=s.key().left_site(),!u.is_segment()&&_.is_segment()&&_.point1().equals(u.point0())&&_.inverse(),s.key().right_site(_),s.value().edge(t._insert_new_edge(u,_,r,i,n).first),this.beach_line_.erase(l),l=s,this.circle_events_.pop(),s!==this.beach_line_.begin()&&(this.deactivate_circle_event(s.value()),s=s.prev(),p=s.key().left_site(),this.activate_circle_event(p,u,_,l,e)),l=l.next(),l!==this.beach_line_.end()&&(this.deactivate_circle_event(l.value()),a=l.key().right_site(),this.activate_circle_event(u,_,a,l,e))},t.prototype.insert_new_arc=function(t,e,i,n,r){var o,s,l,u;return s=new F(t,i),u=new F(i,e),i.is_segment()&&u.left_site().inverse(),o=r._insert_new_edge(e,i),n=this.beach_line_.insert(u,new C(o.second)),i.is_segment()&&(l=new F(i,i),l.right_site().inverse(),n=this.beach_line_.insert(l,new C(null)),this.end_points_.push({first:i.point1(),second:n})),n=this.beach_line_.insert(s,new C(o.first))},t.prototype.activate_circle_event=function(t,e,i,n,r){var o,s;o=new B,r===this.number_type.INTEGERS&&V(t,e,i,o)?(s=this.circle_events_.push({first:o,second:n}),n.value().circle_event(s.first)):r===this.number_type.BIG_INTEGERS&&W(t,e,i,o)&&(s=this.circle_events_.push({first:o,second:n}),n.value().circle_event(s.first))},t.prototype.test_end_points_datastructure=function(){var t,e,i,n,r;for(t={},e=new Rt(2,3),i=new Rt(3,1),n=new Rt(2,2),this.end_points_.push({first:e,second:t}),this.end_points_.push({first:i,second:t}),this.end_points_.push({first:n,second:t}),console.log("### test_end_points_datastructure ###"),console.log("    expected: (2, 2), (2, 3), (3, 1) ordering"),r=[];!this.end_points_.empty();)console.log("    "+this.end_points_.top().first.print()),r.push(this.end_points_.pop());return r},t}(),"undefined"!=typeof module&&null!==module&&(module.exports={voronoi_builder:oe}),Nt=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.x=0,t.prototype.y=0,t.prototype.assign=function(t){return this.x=t.x,this.y=t.y},t.prototype.equals=function(t){return Math.abs(t.x-this.x)<a&&Math.abs(t.y-this.y)<a},t.prototype.get=function(t){return t===v?this.x:this.y},t.prototype.set=function(t,e){t===v?this.x=e:this.y=e},t.prototype.lessThan=function(t){return this.x<t.x||Math.abs(this.x-t.x)<a&&this.y<t.y},t.prototype.lessThanEqual=function(t){return lessThan(t)},t.prototype.greaterThan=function(t){return!lessThan(t)},t.prototype.greaterTHanEqual=function(t){return!lessThan(t)},t}(),"undefined"!=typeof module&&null!==module&&(module.exports={point_data:Nt}),Yt=function(){function t(t,e){this.lowPt=t,this.highPt=e}return t.prototype.lowPt=null,t.prototype.highPt=null,t.prototype.assign=function(t){return this.lowPt=Nt(t.lowPt.x,t.lowPt.y),this.highPt=Nt(t.highPt.x,t.highPt.y)},t.prototype.equals=function(t){return this.lowPt.equals(t.lowPt)&&this.highPt.equals(t.hightPt)},t.prototype.get=function(t){return t===g?this.lowPt:this.highPt},t.prototype.set=function(t,e){return t===g?this.lowPt.assign(e):this.highPt.assign(e)},t.prototype.low=function(){return this.lowPt},t.prototype.high=function(){return this.highPt},t.prototype.lessThan=function(t){return this.lowPt.equals(t.lowPt)?this.highPt.lessThan(t.highPt):this.lowPt.lessThan(t.lowPt)},t.prototype.lessThanEqual=function(t){return lessThan(t)},t.prototype.greaterThan=function(t){return!lessThan(t)},t.prototype.greaterThanEqual=function(t){return!lessThan(t)},t}(),"undefined"!=typeof module&&null!==module&&(module.exports={segment_data:Yt}),null==u&&"undefined"!=typeof require&&null!==require&&(oe=require("./voronoi_builder").voronoi_builder,Nt=require("./point_data").point_data,Yt=require("./segment_data").segment_data),ut=function(t,e){var i,n,r,o;if(t instanceof Nt)return e.insert_point(t.x,t.y);if(t instanceof Yt)return e.insert_segment(t.low().x,t.low().y,t.high().x,t.high().y);if(Array.isArray(t)){for(o=[],n=0,r=t.length;r>n;n++)i=t[n],o.push(ut(i,e));return o}},Z=function(t,e,i,n,r){var o;return null==r&&(r=null),o=new oe,ut(t,o),ut(e,o),o.construct(i,n,r)},"undefined"!=typeof module&&null!==module&&(module.exports={construct_voronoi:Z}),null==u&&"undefined"!=typeof require&&null!==require&&(ie=require("./voronoi_predicates").static_cast_int),ae=function(){function t(){}return t.prototype.cast=ie,t.prototype.discretize=function(t,e,i,n){var r,o,s,l,u,_,p,a,h,c,y,f,v,d,x,g,m,w,b,E,T,q;if(E=this.cast(e.high().x)-this.cast(e.low().x),T=this.cast(e.high().y)-this.cast(e.low().y),q=E*E+T*T,m=q*this.get_point_projection(n[0],e),g=q*this.get_point_projection(n[1],e),d=this.cast(t.x)-this.cast(e.low().x),x=this.cast(t.y)-this.cast(e.low().y),
w=E*d+T*x,b=E*x-T*d,0===b)return l="Invalid parabola detected: \npoint: "+JSON.stringify(t)+"\nsegment: "+JSON.stringify(e)+"\ndiscretization: "+JSON.stringify(n),void console.error(l);for(p=n[1],n.pop(),v=[],v.unshift(g),r=m,o=this.parabola_y(r,w,b),a=i*i*q;v.length>0;)y=v[0],f=this.parabola_y(y,w,b),h=(f-o)/(y-r)*b+w,c=this.parabola_y(h,w,b),s=(f-o)*(h-r)-(y-r)*(c-o),s=s*s/((f-o)*(f-o)+(y-r)*(y-r)),a>=s?(v.shift(),u=(E*y-T*f)/q+this.cast(e.low().x),_=(E*f+T*y)/q+this.cast(e.low().y),n.push(new Nt(u,_)),r=y,o=f):v.unshift(h);return n[n.length-1]=p},t.prototype.discretize2=function(t,e,i,n){var r,o,s,l,u,_,p,a,h,c,y,f,v,d,x,g,m,w,b,E,T,q,I,R,S,N;if(R=this.cast(e.high().x)-this.cast(e.low().x),S=this.cast(e.high().y)-this.cast(e.low().y),N=R*R+S*S,b=N*this.get_point_projection(n[0],e),g=N*this.get_point_projection(n[1],e),v=this.cast(t.x)-this.cast(e.low().x),d=this.cast(t.y)-this.cast(e.low().y),q=R*v+S*d,I=R*d-S*v,0===I)return l="Invalid parabola detected: \npoint: "+JSON.stringify(t)+"\nsegment: "+JSON.stringify(e)+"\ndiscretization: "+JSON.stringify(n),void console.error(l);if(T=b>g,w=Math.min(b,g),m=Math.max(b,g),s=i*Math.sqrt(N),x=[],q>=w&&m>=q){for(r=q,o=I/2;r>w;)x.unshift({x:r,y:o}),o+=s,r=this.parabola_x_low(o,q,I);for(r=q,o=I/2,u=!0;m>r;)u||x.push({x:r,y:o}),o+=s,r=this.parabola_x_high(o,q,I),u=!1}else if(w>q)for(r=w,o=this.parabola_y(r,q,I),u=!0;m>r;)u||x.push({x:r,y:o}),o+=s,r=this.parabola_x_high(o,q,I),u=!1;else if(q>m)for(r=w,o=this.parabola_y(r,q,I),u=!0;m>r&&(u||x.push({x:r,y:o}),o-=s,!(I/2>o));)r=this.parabola_x_low(o,q,I),u=!1;for(h=n[1],n.pop(),T&&x.reverse(),a=0,c=x.length;c>a;a++)E=x[a],y=E.x,f=E.y,_=(R*y-S*f)/N+this.cast(e.low().x),p=(R*f+S*y)/N+this.cast(e.low().y),n.push(new Nt(_,p));return n.push(h)},t.prototype.discretize_central_angle=function(t,e,i,n){var r,o,s,l,u,_,p,a,h,c,y,f,v,d,x,g,m,w,b,E,T,q,I,R,S,N,O,M,A;if(I=this.cast(e.high().x)-this.cast(e.low().x),R=this.cast(e.high().y)-this.cast(e.low().y),S=I*I+R*R,E=S*this.get_point_projection(n[0],e),b=S*this.get_point_projection(n[1],e),m=this.cast(t.x)-this.cast(e.low().x),w=this.cast(t.y)-this.cast(e.low().y),T=I*m+R*w,q=I*w-R*m,0===q)return p="Invalid parabola detected: \npoint: "+JSON.stringify(t)+"\nsegment: "+JSON.stringify(e)+"\ndiscretization: "+JSON.stringify(n),void console.error(p);for(c=n[1],n.pop(),g=[],g.unshift(b),l=E,u=this.parabola_y(l,T,q),o=T,s=q;g.length>0;)d=g[0],x=this.parabola_y(d,T,q),f=(x-u)/(d-l)*q+T,v=this.parabola_y(f,T,q),N=d-o,O=x-s,M=l-o,A=u-s,y=Math.sqrt((N*N+O*O)*(M*M+A*A)),0===y?(console.error("Division by zero!"),r=0):(_=(N*M+O*A)/y,r=Math.acos(_)),i>=r?(g.shift(),a=(I*d-R*x)/S+this.cast(e.low().x),h=(I*x+R*d)/S+this.cast(e.low().y),n.push(new Nt(a,h)),l=d,u=x):g.unshift(f);return n[n.length-1]=c},t.prototype.discretize_point_point=function(t,e,i,n){var r,o,s,l,u,_,p,a,h,c,y,f;for(_=function(t,e,i,n){var r,o;return r=t-i,o=e-n,Math.sqrt(r*r+o*o)},p=n[1],n.pop(),f=[],f.unshift(p),r=n[0].x,o=n[0].y;f.length>0;)c=f[0].x,y=f[0].y,a=(r+c)/2,h=(o+y)/2,s=_(r,o,t.x,t.y),l=_(a,h,t.x,t.y),u=_(c,y,t.x,t.y),Math.abs(s-u)<=i&&Math.abs(s-l)<=i?(f.shift(),n.push(new Nt(c,y)),r=c,o=y):f.unshift({x:a,y:h});return n.push(p)},t.prototype.parabola_y=function(t,e,i){return((t-e)*(t-e)+i*i)/(i+i)},t.prototype.parabola_x_low=function(t,e,i){var n,r;return r=2*i*t-i*i,0>r?(console.error("can't discretisize! trying to get a square root of a negative number !!"),null):(n=Math.sqrt(r),e-n)},t.prototype.parabola_x_high=function(t,e,i){var n,r;return r=2*i*t-i*i,0>r?(console.error("can't discretisize! trying to get a square root of a negative number !!"),null):(n=Math.sqrt(r),e+n)},t.prototype.get_point_projection=function(t,e){var i,n,r,o,s,l;return r=this.cast(e.high().x)-this.cast(e.low().x),o=this.cast(e.high().y)-this.cast(e.low().y),i=t.x-this.cast(e.low().x),n=t.y-this.cast(e.low().y),s=r*r+o*o,l=r*i+o*n,l/s},t}(),le=function(){function t(t,e,i,n){this.path=t,this.holes=e,this.filtering_angle=i,this.debug_flags=n}return t.prototype.showErrorAndDumpData=function(t){var e;return e="Invalid medial axis detected!\n",null!=t&&(e+="Possible cause: "+t+"\n"),e+="Input data: \n",e+="  path: "+JSON.stringify(this.path)+"\n",e+="  holes: "+JSON.stringify(this.holes)+"\n",e+="  filtering_angle: "+JSON.stringify(this.filtering_angle)+"\n",e+="  debug_flags: "+JSON.stringify(this.debug_flags)+"\n",console.error(e)},t.prototype.isNaNEdge=function(t){return isNaN(t.vertex0().x())||isNaN(t.vertex0().y())||isNaN(t.vertex1().x())||isNaN(t.vertex1().y())?(this.showErrorAndDumpData("Self intersecting polygon?"),!0):!1},t.prototype.isInvalidPrimaryEdge=function(t){return t.is_primary()&&null!=t.vertex0()&&null!=t.vertex1()?!1:(this.showErrorAndDumpData("Not a primary edge"),!0)},t}(),Q=function(){function t(){}return t.prototype.equal_points=function(t,e){return Math.abs(t.x-e.x)<a&&Math.abs(t.y-e.y)<a},t.prototype.input_data=function(t){var e,i,n,r,o,s;for(s="",e=i=0,o=t.length-1;o>=0?o>i:i>o;e=o>=0?++i:--i)n=t[e],r=t[e+1],s+="addTwoPoints("+Math.round(n.x)+", "+Math.round(n.y)+", "+Math.round(r.x)+", "+Math.round(r.y)+", points, segments);\n";return this.equal_points(t[0],t[t.length-1])||(n=t[t.length-1],r=t[0],s+="addTwoPoints("+Math.round(n.x)+", "+Math.round(n.y)+", "+Math.round(r.x)+", "+Math.round(r.y)+", points, segments);\n"),s},t.prototype.generate=function(t,e){var i,n,r,o;for(o="",o+=this.input_data(t),i=0,n=e.length;n>i;i++)r=e[i],o+=this.input_data(r);return o},t}(),"undefined"!=typeof module&&null!==module&&(module.exports={cppgen:Q}),null==u&&"undefined"!=typeof require&&null!==require&&(Pt=require("./constants"),a=Pt.EPSILON,A=Pt.SOURCE_CATEGORY_SINGLE_POINT,Q=require("./cppgen"),Nt=require("./point_data").point_data,Yt=require("./segment_data").segment_data,ue=require("./voronoi_diagram").voronoi_diagram,Z=require("./voronoi").construct_voronoi),this.JSPoly={points_:[],segments_:[],colors:{unclassified:11,secondary:1,outer_primary:2,inner_primary:3,hole_primary:4},parabola_discretization_method:{ERROR_2D:0,RADIUS:1,CENTRAL_ANGLE:2},number_type:{INTEGERS:0,BIG_INTEGERS:1},point_in_poly:function(t,e){var i,n,r,o,s;for(n=!1,i=0,r=e.length-1;i<e.length;)o=e[i],s=e[r],o.y-t.y>a!=s.y-t.y>a&&(s.x-o.x)*(t.y-o.y)/(s.y-o.y)+o.x-t.x>a&&(n=!n),r=i++;return n},clear:function(){return this.points_=[],this.segments_=[]},equals:function(t,e){return Math.abs(t-e)<a},equal_points:function(t,e){return this.equals(t.x,e.x)&&this.equals(t.y,e.y)},generate_points_and_segments:function(t,e){var i,n,r,o,s,l,u,_,p;if(s=[],p=[],0===t.length)return{points:s,segments:p};for(l=new Nt(t[0].x,t[0].y),n=l,n.is_hole=e,r=o=1,u=t.length;u>=1?u>o:o>u;r=u>=1?++o:--o)i=new Nt(t[r].x,t[r].y),i.is_hole=e,_=new Yt(l,i),_.is_hole=e,p.push(_),l=i;return this.equal_points(t[0],t[t.length-1])||(_=new Yt(l,n),_.is_hole=e,p.push(_)),{points:s,segments:p}},construct_voronoi_diagram_for_rounded_data:function(t,e,i,n){var r,o,s,l,u;for(null==n&&(n=null),this.clear(),l=this.generate_points_and_segments(t,!1),this.points_=this.points_.concat(l.points),this.segments_=this.segments_.concat(l.segments),o=0,s=e.length;s>o;o++)r=e[o],l=this.generate_points_and_segments(r,!0),this.points_=this.points_.concat(l.points),this.segments_=this.segments_.concat(l.segments);return u=new ue,Z(this.points_,this.segments_,u,i,n),u},construct_voronoi_diagram:function(t,e,i,n){var r;return null==i&&(i=this.number_type.INTEGERS),null==n&&(n=null),r=this.round_input_data(t,e),t=r.boundary,e=r.holes,this.construct_voronoi_diagram_for_rounded_data(t,e,i,n)},construct_voronoi_diagram_with_edge_classification:function(t,e,i,n){var r,o;return null==i&&(i=this.number_type.INTEGERS),null==n&&(n=null),r=this.round_input_data(t,e),t=r.boundary,e=r.holes,o=this.construct_voronoi_diagram_for_rounded_data(t,e,i),this.classify_edges(o,t,e,n),o},create_edge_json_data_for_testing:function(t){var e,i,n,r,o,s,l;for(n=[],l=t.edges(),r=0,o=l.length;o>r;r++)i=l[r],e={},e.is_finite=i.is_finite(),e.is_infinite=i.is_infinite(),e.is_primary=i.is_primary(),e.is_secondary=i.is_secondary(),e.is_linear=i.is_linear(),e.is_curved=i.is_curved(),null===i.vertex0()?e.vertex0=null:(s={},s.x=i.vertex0().x(),s.y=i.vertex0().y(),e.vertex0=s),null===i.vertex1()?e.vertex1=null:(s={},s.x=i.vertex1().x(),s.y=i.vertex1().y(),e.vertex1=s),e.color=i.color(),n.push(e);return n},retrieve_point:function(t){var e,i;return i=t.source_index(),e=t.source_category(),e===A?this.points_[i]:(i-=this.points_.length,e===M?this.segments_[i].low():this.segments_[i].high())},retrieve_segment:function(t){var e;return e=t.source_index()-this.points_.length,this.segments_[e]},get_cells_angle:function(t){var e,i,n;return e=function(t,e,i){var n;return n=(t.x-e.x)*(i.x-e.x)+(i.y-e.y)*(t.y-e.y),Math.acos(n/(Math.hypot(t.x-e.x,t.y-e.y)*Math.hypot(i.x-e.x,i.y-e.y)))},t.cell().contains_point()||t.twin().cell().contains_point()?null:(i=this.retrieve_segment(t.cell()),n=this.retrieve_segment(t.twin().cell()),i.low().equals(n.low())?e(i.high(),i.low(),n.high()):i.high().equals(n.low())?e(i.low(),i.high(),n.high()):i.low().equals(n.high())?e(i.high(),i.low(),n.low()):i.high().equals(n.high())?e(i.low(),i.high(),n.low()):null)},distance_to_point:function(t,e){return Math.hypot(t.x-e.x,t.y-e.y)},distance_to_segment:function(t,e){var i,n,r,o;return i=e.low().x,r=e.low().y,n=e.high().x,o=e.high().y,Math.abs((o-r)*t.x-(n-i)*t.y+n*r-o*i)/Math.hypot(r-o,i-n)},create_output_segments:function(t,e,i,n,r,o,s,l){var u,_,p,a,h,c,y,f,v,d,x,g,m,w,b;if(null==o&&(o=.1),null==s&&(s=this.parabola_discretization_method.ERROR_2D),null==l&&(l=-1),m=[],m.push(new Nt(t.vertex0().x(),t.vertex0().y())),m.push(new Nt(t.vertex1().x(),t.vertex1().y())),t.is_curved())for(y=t.cell().contains_point()?this.retrieve_point(t.cell()):this.retrieve_point(t.twin().cell()),w=t.cell().contains_point()?this.retrieve_segment(t.twin().cell()):this.retrieve_segment(t.cell()),s===this.parabola_discretization_method.RADIUS?n||(new ae).discretize2(y,w,o,m):s===this.parabola_discretization_method.ERROR_2D?n||(new ae).discretize(y,w,o,m):s===this.parabola_discretization_method.CENTRAL_ANGLE&&(n||(new ae).discretize_central_angle(y,w,o,m)),_=0,p=m.length;p>_;_++)g=m[_],g.radius=this.distance_to_point(y,g),r&&(g.sites=[{type:"point",site:{x:y.x,y:y.y}},{type:"segment",site:{x1:w.low().x,y1:w.low().y,x2:w.high().x,y2:w.high().y}}]);else if(t.cell().contains_point()&&t.twin().cell().contains_point())for(y=this.retrieve_point(t.cell()),-1!==l&&(new ae).discretize_point_point(y,w,l,m),h=0,a=m.length;a>h;h++)g=m[h],g.radius=this.distance_to_point(y,g),r&&(f=this.retrieve_point(t.twin().cell()),g.sites=[{type:"point",site:{x:y.x,y:y.y}},{type:"point",site:{x:f.x,y:f.y}}]);else{if(t.cell().contains_point()||t.twin().cell().contains_point())return!1;w=this.retrieve_segment(t.cell()),m[0].radius=this.distance_to_segment(m[0],w),m[1].radius=this.distance_to_segment(m[1],w),r&&(b=this.retrieve_segment(t.twin().cell()),m[0].sites=[{type:"segment",site:{x1:w.low().x,y1:w.low().y,x2:w.high().x,y2:w.high().y}},{type:"segment",site:{x1:b.low().x,y1:b.low().y,x2:b.high().x,y2:b.high().y}}],m[1].sites=[{type:"segment",site:{x1:w.low().x,y1:w.low().y,x2:w.high().x,y2:w.high().y}},{type:"segment",site:{x1:b.low().x,y1:b.low().y,x2:b.high().x,y2:b.high().y}}])}for(d=m[0],u=c=1,x=m.length;x>=1?x>c:c>x;u=x>=1?++c:--c)v=m[u],i.push({point0:{x:d.x,y:d.y,radius:d.radius},point1:{x:v.x,y:v.y,radius:v.radius},sites:r?d.sites:void 0}),d=v;return!0},cppgen:Q,colorPrimaryEdges:function(t,e,i,n){var r,o,s,l;for(l=[t],s=0,null!=i&&n({twinEdges:l.length,iteration:s});l.length>0&&!(null!=i&&s>i);){for(o=l[0],l.splice(0,1),s++,null!=i&&n({twinEdges:l.length,iteration:s}),o.color(e),r=o.next_primary();r!==o&&null!=r&&r.color()===this.colors.unclassified&&(r.twin().color()===this.colors.unclassified&&l.unshift(r.twin()),!(null!=i&&s>i));)r.color(e),r=r.next_primary(),s++,null!=i&&n({twinEdges:l.length,iteration:s});l=l.filter(function(t){return t.color()===JSPoly.colors.unclassified})}null!=i&&n({twinEdges:l.length,iteration:s})},get_non_border_point:function(t){var e,i,n,r,o;if(o=function(t){return{x:t.x(),y:t.y()}},i=o(t.vertex0()),n=o(t.vertex1()),t.cell().contains_point()){if(e=this.retrieve_point(t.cell()),!this.equal_points(i,e))return i}else if(r=this.retrieve_segment(t.cell()),!this.equal_points(i,r.low())&&!this.equal_points(i,r.high()))return i;return n},classify_edges:function(t,e,i,n,r,o){var s,l,u,_,p,a,h,c,y,f,v,d,x,g,m,w;for(null==n&&(n=new le([],[])),null==r&&(r=null),null==o&&(o=function(){}),w=[],m=t.edges(),l=0,u=m.length;u>l;l++)s=m[l],s.is_primary()?s.is_infinite()?s.color(this.colors.outer_primary):(s.color(this.colors.unclassified),w.push(s)):s.color(this.colors.secondary);for(x=[].concat([e],i),f={x:0,y:0},d=[f],h=0,_=x.length;_>h;h++)if(v=x[h],0!==v.length){for(c=0,p=v.length;p>c;c++)g=v[c],d.push(g);this.equal_points(v[0],v[v.length-1])||d.push(v[0]),d.push(f)}for(y=0,a=w.length;a>y;y++)s=w[y],s.color()!==this.colors.inner_primary&&(g=this.get_non_border_point(s),this.point_in_poly(g,d)&&(s.color(this.colors.inner_primary),s.twin().color(this.colors.inner_primary)));return t.edges()},dump:function(t,e,i){return null==i&&(i=""),console.error(i+JSON.stringify({boundary:t,holes:e}))},round_input_data:function(t,e){return{boundary:t.map(function(t){return{x:Math.round(t.x),y:Math.round(t.y)}}),holes:e.map(function(t){return t.map(function(t){return{x:Math.round(t.x),y:Math.round(t.y)}})})}},construct_medial_axis:function(t,e,i,n,r,o,s,l,u){var _,p,a,h,c,y,f,v,d,x,g,m,w,b,E,T,q,I,R,S,N,O,M,A;for(null==i&&(i=.1),null==n&&(n=this.parabola_discretization_method.CENTRAL_ANGLE),null==r&&(r=3*Math.PI/4),null==o&&(o=-1),null==s&&(s=this.number_type.INTEGERS),null==l&&(l={no_parabola:!1,show_sites:!1}),null==u&&(u=null),p=new le(t,e,r,l),E=l.no_parabola,O=l.show_sites,N=this.round_input_data(t,e),t=N.boundary,e=N.holes,A=this.construct_voronoi_diagram_for_rounded_data(t,e,s,u),c=this.classify_edges(A,t,e,p).filter(function(t){return t.color()===JSPoly.colors.inner_primary}),x=!1,I=[],h=new Set(c);h.size>0;){for(g=0,m=I.length;m>g;g++)q=I[g],h["delete"](q.twin());if(0===h.size)break;for(y=h.values(),f=y.next(),a=f.value;!f.done;){for(d=f.value,S=d.prev();null!=S&&S.is_secondary()&&S!==d;)S=S.twin().prev();if(!h.has(S)){a=d;break}f=y.next()}for(;h.has(a);){for(I.push(a),_=a.next(),T=a;null!=_&&_.is_secondary()&&T!==_;)_=_.twin().next();h["delete"](a),a=_}}for(v=I.filter(function(t){var e;return e=JSPoly.get_cells_angle(t),null!=e&&e>r?!1:!0}),R=[],b=0,w=v.length;w>b;b++)if(a=v[b],a.color()===this.colors.inner_primary){if(p.isInvalidPrimaryEdge(a)||p.isNaNEdge(a))return this.dump(t,e,"Medial axis generation failed: found an edge either invalid primary or values containing NaN \n"),[];if(!(this.equals(a.vertex0().x(),a.vertex1().x())&&this.equals(a.vertex0().y(),a.vertex1().y())||(M=this.create_output_segments(a,A,R,E,O,i,n,o))))return this.dump(t,e,"Medial axis generation failed: invalid edge found, the edge should be either curved or linear \n"),[]}return R}},"undefined"!=typeof module&&null!==module&&(module.exports={jspoly:this.JSPoly})}).call(this);